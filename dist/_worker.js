var Lc=Object.defineProperty;var os=t=>{throw TypeError(t)};var Pc=(t,e,r)=>e in t?Lc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var G=(t,e,r)=>Pc(t,typeof e!="symbol"?e+"":e,r),Wr=(t,e,r)=>e.has(t)||os("Cannot "+r);var A=(t,e,r)=>(Wr(t,e,"read from private field"),r?r.call(t):e.get(t)),Q=(t,e,r)=>e.has(t)?os("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Z=(t,e,r,a)=>(Wr(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),ae=(t,e,r)=>(Wr(t,e,"access private method"),r);var cs=(t,e,r,a)=>({set _(n){Z(t,e,n,r)},get _(){return A(t,e,a)}});import Ir from"buffer";import Mn from"stream";import Mr from"util";import Bn from"crypto";function wo(t,e){for(var r=0;r<e.length;r++){const a=e[r];if(typeof a!="string"&&!Array.isArray(a)){for(const n in a)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(a,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>a[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var _o={Stringify:1},Ee=(t,e)=>{const r=new String(t);return r.isEscaped=!0,r.callbacks=e,r},Oc=/[&<>'"]/,Eo=async(t,e)=>{let r="";e||(e=[]);const a=await Promise.all(t);for(let n=a.length-1;r+=a[n],n--,!(n<0);n--){let s=a[n];typeof s=="object"&&e.push(...s.callbacks||[]);const o=s.isEscaped;if(s=await(typeof s=="object"?s.toString():s),typeof s=="object"&&e.push(...s.callbacks||[]),s.isEscaped??o)r+=s;else{const c=[r];Ye(s,c),r=c[0]}}return Ee(r,e)},Ye=(t,e)=>{const r=t.search(Oc);if(r===-1){e[0]+=t;return}let a,n,s=0;for(n=r;n<t.length;n++){switch(t.charCodeAt(n)){case 34:a="&quot;";break;case 39:a="&#39;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}e[0]+=t.substring(s,n)+a,s=n+1}e[0]+=t.substring(s,n)},So=t=>{const e=t.callbacks;if(!(e!=null&&e.length))return t;const r=[t],a={};return e.forEach(n=>n({phase:_o.Stringify,buffer:r,context:a})),r[0]},No=async(t,e,r,a,n)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const s=t.callbacks;return s!=null&&s.length?(n?n[0]+=t:n=[t],Promise.all(s.map(c=>c({phase:e,buffer:n,context:a}))).then(c=>Promise.all(c.filter(Boolean).map(l=>No(l,e,!1,a,n))).then(()=>n[0]))):Promise.resolve(t)},$c=(t,...e)=>{const r=[""];for(let a=0,n=t.length-1;a<n;a++){r[0]+=t[a];const s=Array.isArray(e[a])?e[a].flat(1/0):[e[a]];for(let o=0,c=s.length;o<c;o++){const l=s[o];if(typeof l=="string")Ye(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const u=l.toString();u instanceof Promise?r.unshift("",u):r[0]+=u}else l instanceof Promise?r.unshift("",l):Ye(l.toString(),r)}}}return r[0]+=t.at(-1),r.length===1?"callbacks"in r?Ee(So(Ee(r[0],r.callbacks))):Ee(r[0]):Eo(r,r.callbacks)},qn=Symbol("RENDERER"),Nn=Symbol("ERROR_HANDLER"),ce=Symbol("STASH"),To=Symbol("INTERNAL"),jc=Symbol("MEMO"),Rr=Symbol("PERMALINK"),ls=t=>(t[To]=!0,t),ko=t=>({value:e,children:r})=>{if(!r)return;const a={children:[{tag:ls(()=>{t.push(e)}),props:{}}]};Array.isArray(r)?a.children.push(...r.flat()):a.children.push(r),a.children.push({tag:ls(()=>{t.pop()}),props:{}});const n={tag:"",props:a,type:""};return n[Nn]=s=>{throw t.pop(),s},n},Io=t=>{const e=[t],r=ko(e);return r.values=e,r.Provider=r,It.push(r),r},It=[],Fn=t=>{const e=[t],r=a=>{e.push(a.value);let n;try{n=a.children?(Array.isArray(a.children)?new Lo("",{},a.children):a.children).toString():""}finally{e.pop()}return n instanceof Promise?n.then(s=>Ee(s,s.callbacks)):Ee(n)};return r.values=e,r.Provider=r,r[qn]=ko(e),It.push(r),r},jt=t=>t.values.at(-1),br={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},Tn={},vr="data-precedence",sr=t=>Array.isArray(t)?t:[t],ds=new WeakMap,us=(t,e,r,a)=>({buffer:n,context:s})=>{if(!n)return;const o=ds.get(s)||{};ds.set(s,o);const c=o[t]||(o[t]=[]);let l=!1;const u=br[t];if(u.length>0){e:for(const[,d]of c)for(const h of u)if(((d==null?void 0:d[h])??null)===(r==null?void 0:r[h])){l=!0;break e}}if(l?n[0]=n[0].replaceAll(e,""):u.length>0?c.push([e,r,a]):c.unshift([e,r,a]),n[0].indexOf("</head>")!==-1){let d;if(a===void 0)d=c.map(([h])=>h);else{const h=[];d=c.map(([p,,E])=>{let v=h.indexOf(E);return v===-1&&(h.push(E),v=h.length-1),[p,v]}).sort((p,E)=>p[1]-E[1]).map(([p])=>p)}d.forEach(h=>{n[0]=n[0].replaceAll(h,"")}),n[0]=n[0].replace(/(?=<\/head>)/,d.join(""))}},ir=(t,e,r)=>Ee(new Ie(t,r,sr(e??[])).toString()),or=(t,e,r,a)=>{if("itemProp"in r)return ir(t,e,r);let{precedence:n,blocking:s,...o}=r;n=a?n??"":void 0,a&&(o[vr]=n);const c=new Ie(t,o,sr(e||[])).toString();return c instanceof Promise?c.then(l=>Ee(c,[...l.callbacks||[],us(t,l,o,n)])):Ee(c,[us(t,c,o,n)])},Dc=({children:t,...e})=>{const r=Un();if(r){const a=jt(r);if(a==="svg"||a==="head")return new Ie("title",e,sr(t??[]))}return or("title",t,e,!1)},Mc=({children:t,...e})=>{const r=Un();return["src","async"].some(a=>!e[a])||r&&jt(r)==="head"?ir("script",t,e):or("script",t,e,!1)},Bc=({children:t,...e})=>["href","precedence"].every(r=>r in e)?(e["data-href"]=e.href,delete e.href,or("style",t,e,!0)):ir("style",t,e),qc=({children:t,...e})=>["onLoad","onError"].some(r=>r in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?ir("link",t,e):or("link",t,e,"precedence"in e),Fc=({children:t,...e})=>{const r=Un();return r&&jt(r)==="head"?ir("meta",t,e):or("meta",t,e,!1)},Ro=(t,{children:e,...r})=>new Ie(t,r,sr(e??[])),Uc=t=>(typeof t.action=="function"&&(t.action=Rr in t.action?t.action[Rr]:void 0),Ro("form",t)),Ao=(t,e)=>(typeof e.formAction=="function"&&(e.formAction=Rr in e.formAction?e.formAction[Rr]:void 0),Ro(t,e)),Hc=t=>Ao("input",t),zc=t=>Ao("button",t);const Zr=Object.freeze(Object.defineProperty({__proto__:null,button:zc,form:Uc,input:Hc,link:qc,meta:Fc,script:Mc,style:Bc,title:Dc},Symbol.toStringTag,{value:"Module"}));var Gc=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),Ar=t=>Gc.get(t)||t,Co=(t,e)=>{for(const[r,a]of Object.entries(t)){const n=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`);e(n,a==null?null:typeof a=="number"?n.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${a}`:`${a}px`:a)}},Zt=void 0,Un=()=>Zt,Vc=t=>/[A-Z]/.test(t)&&t.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Wc=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Zc=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Hn=(t,e)=>{for(let r=0,a=t.length;r<a;r++){const n=t[r];if(typeof n=="string")Ye(n,e);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof Ie?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?e[0]+=n:n instanceof Promise?e.unshift("",n):Hn(n,e)}}},Ie=class{constructor(t,e,r){G(this,"tag");G(this,"props");G(this,"key");G(this,"children");G(this,"isEscaped",!0);G(this,"localContexts");this.tag=t,this.props=e,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var e,r;const t=[""];(e=this.localContexts)==null||e.forEach(([a,n])=>{a.values.push(n)});try{this.toStringToBuffer(t)}finally{(r=this.localContexts)==null||r.forEach(([a])=>{a.values.pop()})}return t.length===1?"callbacks"in t?So(Ee(t[0],t.callbacks)).toString():t[0]:Eo(t,t.callbacks)}toStringToBuffer(t){const e=this.tag,r=this.props;let{children:a}=this;t[0]+=`<${e}`;const n=Zt&&jt(Zt)==="svg"?s=>Vc(Ar(s)):s=>Ar(s);for(let[s,o]of Object.entries(r))if(s=n(s),s!=="children"){if(s==="style"&&typeof o=="object"){let c="";Co(o,(l,u)=>{u!=null&&(c+=`${c?";":""}${l}:${u}`)}),t[0]+=' style="',Ye(c,t),t[0]+='"'}else if(typeof o=="string")t[0]+=` ${s}="`,Ye(o,t),t[0]+='"';else if(o!=null)if(typeof o=="number"||o.isEscaped)t[0]+=` ${s}="${o}"`;else if(typeof o=="boolean"&&Zc.includes(s))o&&(t[0]+=` ${s}=""`);else if(s==="dangerouslySetInnerHTML"){if(a.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");a=[Ee(o.__html)]}else if(o instanceof Promise)t[0]+=` ${s}="`,t.unshift('"',o);else if(typeof o=="function"){if(!s.startsWith("on")&&s!=="ref")throw new Error(`Invalid prop '${s}' of type 'function' supplied to '${e}'.`)}else t[0]+=` ${s}="`,Ye(o.toString(),t),t[0]+='"'}if(Wc.includes(e)&&a.length===0){t[0]+="/>";return}t[0]+=">",Hn(a,t),t[0]+=`</${e}>`}},Kr=class extends Ie{toStringToBuffer(t){const{children:e}=this,r=this.tag.call(null,{...this.props,children:e.length<=1?e[0]:e});if(!(typeof r=="boolean"||r==null))if(r instanceof Promise)if(It.length===0)t.unshift("",r);else{const a=It.map(n=>[n,n.values.at(-1)]);t.unshift("",r.then(n=>(n instanceof Ie&&(n.localContexts=a),n)))}else r instanceof Ie?r.toStringToBuffer(t):typeof r=="number"||r.isEscaped?(t[0]+=r,r.callbacks&&(t.callbacks||(t.callbacks=[]),t.callbacks.push(...r.callbacks))):Ye(r,t)}},Lo=class extends Ie{toStringToBuffer(t){Hn(this.children,t)}},fs=(t,e,...r)=>{e??(e={}),r.length&&(e.children=r.length===1?r[0]:r);const a=e.key;delete e.key;const n=wr(t,e,r);return n.key=a,n},hs=!1,wr=(t,e,r)=>{if(!hs){for(const a in Tn)Zr[a][qn]=Tn[a];hs=!0}return typeof t=="function"?new Kr(t,e,r):Zr[t]?new Kr(Zr[t],e,r):t==="svg"||t==="head"?(Zt||(Zt=Fn("")),new Ie(t,e,[new Kr(Zt,{value:t},r)])):new Ie(t,e,r)},Kc=({children:t})=>new Lo("",{children:t},Array.isArray(t)?t:t?[t]:[]);function i(t,e,r){let a;if(!e||!("children"in e))a=wr(t,e,[]);else{const n=e.children;a=Array.isArray(n)?wr(t,e,n):wr(t,e,[n])}return a.key=r,a}var ms=(t,e,r)=>(a,n)=>{let s=-1;return o(0);async function o(c){if(c<=s)throw new Error("next() called multiple times");s=c;let l,u=!1,d;if(t[c]?(d=t[c][0][0],a.req.routeIndex=c):d=c===t.length&&n||void 0,d)try{l=await d(a,()=>o(c+1))}catch(h){if(h instanceof Error&&e)a.error=h,l=await e(h,a),u=!0;else throw h}else a.finalized===!1&&r&&(l=await r(a));return l&&(a.finalized===!1||u)&&(a.res=l),a}},Yc=Symbol(),Jc=async(t,e=Object.create(null))=>{const{all:r=!1,dot:a=!1}=e,s=(t instanceof Do?t.raw.headers:t.headers).get("Content-Type");return s!=null&&s.startsWith("multipart/form-data")||s!=null&&s.startsWith("application/x-www-form-urlencoded")?Xc(t,{all:r,dot:a}):{}};async function Xc(t,e){const r=await t.formData();return r?Qc(r,e):{}}function Qc(t,e){const r=Object.create(null);return t.forEach((a,n)=>{e.all||n.endsWith("[]")?el(r,n,a):r[n]=a}),e.dot&&Object.entries(r).forEach(([a,n])=>{a.includes(".")&&(tl(r,a,n),delete r[a])}),r}var el=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:e.endsWith("[]")?t[e]=[r]:t[e]=r},tl=(t,e,r)=>{let a=t;const n=e.split(".");n.forEach((s,o)=>{o===n.length-1?a[s]=r:((!a[s]||typeof a[s]!="object"||Array.isArray(a[s])||a[s]instanceof File)&&(a[s]=Object.create(null)),a=a[s])})},Po=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},rl=t=>{const{groups:e,path:r}=al(t),a=Po(r);return nl(a,e)},al=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,a)=>{const n=`@${a}`;return e.push([n,r]),n}),{groups:e,path:t}},nl=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[a]=e[r];for(let n=t.length-1;n>=0;n--)if(t[n].includes(a)){t[n]=t[n].replace(a,e[r][1]);break}}return t},pr={},sl=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const a=`${t}#${e}`;return pr[a]||(r[2]?pr[a]=e&&e[0]!==":"&&e[0]!=="*"?[a,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:pr[a]=[t,r[1],!0]),pr[a]}return null},Br=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},il=t=>Br(t,decodeURI),Oo=t=>{const e=t.url,r=e.indexOf("/",e.indexOf(":")+4);let a=r;for(;a<e.length;a++){const n=e.charCodeAt(a);if(n===37){const s=e.indexOf("?",a),o=e.slice(r,s===-1?void 0:s);return il(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(n===63)break}return e.slice(r,a)},ol=t=>{const e=Oo(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},yt=(t,e,...r)=>(r.length&&(e=yt(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),$o=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;const e=t.split("/"),r=[];let a="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))a+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&a===""?r.push("/"):r.push(a);const s=n.replace("?","");a+="/"+s,r.push(a)}else a+="/"+n}),r.filter((n,s,o)=>o.indexOf(n)===s)},Yr=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?Br(t,zn):t):t,jo=(t,e,r)=>{let a;if(!r&&e&&!/[%+]/.test(e)){let o=t.indexOf(`?${e}`,8);for(o===-1&&(o=t.indexOf(`&${e}`,8));o!==-1;){const c=t.charCodeAt(o+e.length+1);if(c===61){const l=o+e.length+2,u=t.indexOf("&",l);return Yr(t.slice(l,u===-1?void 0:u))}else if(c==38||isNaN(c))return"";o=t.indexOf(`&${e}`,o+1)}if(a=/[%+]/.test(t),!a)return}const n={};a??(a=/[%+]/.test(t));let s=t.indexOf("?",8);for(;s!==-1;){const o=t.indexOf("&",s+1);let c=t.indexOf("=",s);c>o&&o!==-1&&(c=-1);let l=t.slice(s+1,c===-1?o===-1?void 0:o:c);if(a&&(l=Yr(l)),s=o,l==="")continue;let u;c===-1?u="":(u=t.slice(c+1,o===-1?void 0:o),a&&(u=Yr(u))),r?(n[l]&&Array.isArray(n[l])||(n[l]=[]),n[l].push(u)):n[l]??(n[l]=u)}return e?n[e]:n},cl=jo,ll=(t,e)=>jo(t,e,!0),zn=decodeURIComponent,ps=t=>Br(t,zn),Et,_e,qe,Mo,Bo,kn,He,fo,Do=(fo=class{constructor(t,e="/",r=[[]]){Q(this,qe);G(this,"raw");Q(this,Et);Q(this,_e);G(this,"routeIndex",0);G(this,"path");G(this,"bodyCache",{});Q(this,He,t=>{const{bodyCache:e,raw:r}=this,a=e[t];if(a)return a;const n=Object.keys(e)[0];return n?e[n].then(s=>(n==="json"&&(s=JSON.stringify(s)),new Response(s)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,Z(this,_e,r),Z(this,Et,{})}param(t){return t?ae(this,qe,Mo).call(this,t):ae(this,qe,Bo).call(this)}query(t){return cl(this.url,t)}queries(t){return ll(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,a)=>{e[a]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await Jc(this,t))}json(){return A(this,He).call(this,"text").then(t=>JSON.parse(t))}text(){return A(this,He).call(this,"text")}arrayBuffer(){return A(this,He).call(this,"arrayBuffer")}blob(){return A(this,He).call(this,"blob")}formData(){return A(this,He).call(this,"formData")}addValidatedData(t,e){A(this,Et)[t]=e}valid(t){return A(this,Et)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[Yc](){return A(this,_e)}get matchedRoutes(){return A(this,_e)[0].map(([[,t]])=>t)}get routePath(){return A(this,_e)[0].map(([[,t]])=>t)[this.routeIndex].path}},Et=new WeakMap,_e=new WeakMap,qe=new WeakSet,Mo=function(t){const e=A(this,_e)[0][this.routeIndex][1][t],r=ae(this,qe,kn).call(this,e);return r&&/\%/.test(r)?ps(r):r},Bo=function(){const t={},e=Object.keys(A(this,_e)[0][this.routeIndex][1]);for(const r of e){const a=ae(this,qe,kn).call(this,A(this,_e)[0][this.routeIndex][1][r]);a!==void 0&&(t[r]=/\%/.test(a)?ps(a):a)}return t},kn=function(t){return A(this,_e)[1]?A(this,_e)[1][t]:t},He=new WeakMap,fo),dl="text/plain; charset=UTF-8",Jr=(t,e)=>({"Content-Type":t,...e}),Qt,er,$e,St,je,ge,tr,Nt,Tt,lt,rr,ar,ze,bt,ho,ul=(ho=class{constructor(t,e){Q(this,ze);Q(this,Qt);Q(this,er);G(this,"env",{});Q(this,$e);G(this,"finalized",!1);G(this,"error");Q(this,St);Q(this,je);Q(this,ge);Q(this,tr);Q(this,Nt);Q(this,Tt);Q(this,lt);Q(this,rr);Q(this,ar);G(this,"render",(...t)=>(A(this,Nt)??Z(this,Nt,e=>this.html(e)),A(this,Nt).call(this,...t)));G(this,"setLayout",t=>Z(this,tr,t));G(this,"getLayout",()=>A(this,tr));G(this,"setRenderer",t=>{Z(this,Nt,t)});G(this,"header",(t,e,r)=>{this.finalized&&Z(this,ge,new Response(A(this,ge).body,A(this,ge)));const a=A(this,ge)?A(this,ge).headers:A(this,lt)??Z(this,lt,new Headers);e===void 0?a.delete(t):r!=null&&r.append?a.append(t,e):a.set(t,e)});G(this,"status",t=>{Z(this,St,t)});G(this,"set",(t,e)=>{A(this,$e)??Z(this,$e,new Map),A(this,$e).set(t,e)});G(this,"get",t=>A(this,$e)?A(this,$e).get(t):void 0);G(this,"newResponse",(...t)=>ae(this,ze,bt).call(this,...t));G(this,"body",(t,e,r)=>ae(this,ze,bt).call(this,t,e,r));G(this,"text",(t,e,r)=>!A(this,lt)&&!A(this,St)&&!e&&!r&&!this.finalized?new Response(t):ae(this,ze,bt).call(this,t,e,Jr(dl,r)));G(this,"json",(t,e,r)=>ae(this,ze,bt).call(this,JSON.stringify(t),e,Jr("application/json",r)));G(this,"html",(t,e,r)=>{const a=n=>ae(this,ze,bt).call(this,n,e,Jr("text/html; charset=UTF-8",r));return typeof t=="object"?No(t,_o.Stringify,!1,{}).then(a):a(t)});G(this,"redirect",(t,e)=>{const r=String(t);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,e??302)});G(this,"notFound",()=>(A(this,Tt)??Z(this,Tt,()=>new Response),A(this,Tt).call(this,this)));Z(this,Qt,t),e&&(Z(this,je,e.executionCtx),this.env=e.env,Z(this,Tt,e.notFoundHandler),Z(this,ar,e.path),Z(this,rr,e.matchResult))}get req(){return A(this,er)??Z(this,er,new Do(A(this,Qt),A(this,ar),A(this,rr))),A(this,er)}get event(){if(A(this,je)&&"respondWith"in A(this,je))return A(this,je);throw Error("This context has no FetchEvent")}get executionCtx(){if(A(this,je))return A(this,je);throw Error("This context has no ExecutionContext")}get res(){return A(this,ge)||Z(this,ge,new Response(null,{headers:A(this,lt)??Z(this,lt,new Headers)}))}set res(t){if(A(this,ge)&&t){t=new Response(t.body,t);for(const[e,r]of A(this,ge).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const a=A(this,ge).headers.getSetCookie();t.headers.delete("set-cookie");for(const n of a)t.headers.append("set-cookie",n)}else t.headers.set(e,r)}Z(this,ge,t),this.finalized=!0}get var(){return A(this,$e)?Object.fromEntries(A(this,$e)):{}}},Qt=new WeakMap,er=new WeakMap,$e=new WeakMap,St=new WeakMap,je=new WeakMap,ge=new WeakMap,tr=new WeakMap,Nt=new WeakMap,Tt=new WeakMap,lt=new WeakMap,rr=new WeakMap,ar=new WeakMap,ze=new WeakSet,bt=function(t,e,r){const a=A(this,ge)?new Headers(A(this,ge).headers):A(this,lt)??new Headers;if(typeof e=="object"&&"headers"in e){const s=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(const[o,c]of s)o.toLowerCase()==="set-cookie"?a.append(o,c):a.set(o,c)}if(r)for(const[s,o]of Object.entries(r))if(typeof o=="string")a.set(s,o);else{a.delete(s);for(const c of o)a.append(s,c)}const n=typeof e=="number"?e:(e==null?void 0:e.status)??A(this,St);return new Response(t,{status:n,headers:a})},ho),ue="ALL",fl="all",hl=["get","post","put","delete","options","patch"],qo="Can not add a route since the matcher is already built.",Fo=class extends Error{},ml="__COMPOSED_HANDLER",pl=t=>t.text("404 Not Found",404),gs=(t,e)=>{if("getResponse"in t){const r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},Ne,fe,Ho,Te,ot,_r,Er,mo,Uo=(mo=class{constructor(e={}){Q(this,fe);G(this,"get");G(this,"post");G(this,"put");G(this,"delete");G(this,"options");G(this,"patch");G(this,"all");G(this,"on");G(this,"use");G(this,"router");G(this,"getPath");G(this,"_basePath","/");Q(this,Ne,"/");G(this,"routes",[]);Q(this,Te,pl);G(this,"errorHandler",gs);G(this,"onError",e=>(this.errorHandler=e,this));G(this,"notFound",e=>(Z(this,Te,e),this));G(this,"fetch",(e,...r)=>ae(this,fe,Er).call(this,e,r[1],r[0],e.method));G(this,"request",(e,r,a,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,a,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${yt("/",e)}`,r),a,n)));G(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(ae(this,fe,Er).call(this,e.request,e,void 0,e.request.method))})});[...hl,fl].forEach(s=>{this[s]=(o,...c)=>(typeof o=="string"?Z(this,Ne,o):ae(this,fe,ot).call(this,s,A(this,Ne),o),c.forEach(l=>{ae(this,fe,ot).call(this,s,A(this,Ne),l)}),this)}),this.on=(s,o,...c)=>{for(const l of[o].flat()){Z(this,Ne,l);for(const u of[s].flat())c.map(d=>{ae(this,fe,ot).call(this,u.toUpperCase(),A(this,Ne),d)})}return this},this.use=(s,...o)=>(typeof s=="string"?Z(this,Ne,s):(Z(this,Ne,"*"),o.unshift(s)),o.forEach(c=>{ae(this,fe,ot).call(this,ue,A(this,Ne),c)}),this);const{strict:a,...n}=e;Object.assign(this,n),this.getPath=a??!0?e.getPath??Oo:ol}route(e,r){const a=this.basePath(e);return r.routes.map(n=>{var o;let s;r.errorHandler===gs?s=n.handler:(s=async(c,l)=>(await ms([],r.errorHandler)(c,()=>n.handler(c,l))).res,s[ml]=n.handler),ae(o=a,fe,ot).call(o,n.method,n.path,s)}),this}basePath(e){const r=ae(this,fe,Ho).call(this);return r._basePath=yt(this._basePath,e),r}mount(e,r,a){let n,s;a&&(typeof a=="function"?s=a:(s=a.optionHandler,a.replaceRequest===!1?n=l=>l:n=a.replaceRequest));const o=s?l=>{const u=s(l);return Array.isArray(u)?u:[u]}:l=>{let u;try{u=l.executionCtx}catch{}return[l.env,u]};n||(n=(()=>{const l=yt(this._basePath,e),u=l==="/"?0:l.length;return d=>{const h=new URL(d.url);return h.pathname=h.pathname.slice(u)||"/",new Request(h,d)}})());const c=async(l,u)=>{const d=await r(n(l.req.raw),...o(l));if(d)return d;await u()};return ae(this,fe,ot).call(this,ue,yt(e,"*"),c),this}},Ne=new WeakMap,fe=new WeakSet,Ho=function(){const e=new Uo({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,Z(e,Te,A(this,Te)),e.routes=this.routes,e},Te=new WeakMap,ot=function(e,r,a){e=e.toUpperCase(),r=yt(this._basePath,r);const n={basePath:this._basePath,path:r,method:e,handler:a};this.router.add(e,r,[a,n]),this.routes.push(n)},_r=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},Er=function(e,r,a,n){if(n==="HEAD")return(async()=>new Response(null,await ae(this,fe,Er).call(this,e,r,a,"GET")))();const s=this.getPath(e,{env:a}),o=this.router.match(n,s),c=new ul(e,{path:s,matchResult:o,env:a,executionCtx:r,notFoundHandler:A(this,Te)});if(o[0].length===1){let u;try{u=o[0][0][0][0](c,async()=>{c.res=await A(this,Te).call(this,c)})}catch(d){return ae(this,fe,_r).call(this,d,c)}return u instanceof Promise?u.then(d=>d||(c.finalized?c.res:A(this,Te).call(this,c))).catch(d=>ae(this,fe,_r).call(this,d,c)):u??A(this,Te).call(this,c)}const l=ms(o[0],this.errorHandler,A(this,Te));return(async()=>{try{const u=await l(c);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return ae(this,fe,_r).call(this,u,c)}})()},mo),Cr="[^/]+",Vt=".*",Wt="(?:|/.*)",vt=Symbol(),gl=new Set(".\\+*[^]$()");function xl(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===Vt||t===Wt?1:e===Vt||e===Wt?-1:t===Cr?1:e===Cr?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var dt,ut,ke,po,In=(po=class{constructor(){Q(this,dt);Q(this,ut);Q(this,ke,Object.create(null))}insert(e,r,a,n,s){if(e.length===0){if(A(this,dt)!==void 0)throw vt;if(s)return;Z(this,dt,r);return}const[o,...c]=e,l=o==="*"?c.length===0?["","",Vt]:["","",Cr]:o==="/*"?["","",Wt]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(l){const d=l[1];let h=l[2]||Cr;if(d&&l[2]&&(h===".*"||(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))))throw vt;if(u=A(this,ke)[h],!u){if(Object.keys(A(this,ke)).some(p=>p!==Vt&&p!==Wt))throw vt;if(s)return;u=A(this,ke)[h]=new In,d!==""&&Z(u,ut,n.varIndex++)}!s&&d!==""&&a.push([d,A(u,ut)])}else if(u=A(this,ke)[o],!u){if(Object.keys(A(this,ke)).some(d=>d.length>1&&d!==Vt&&d!==Wt))throw vt;if(s)return;u=A(this,ke)[o]=new In}u.insert(c,r,a,n,s)}buildRegExpStr(){const r=Object.keys(A(this,ke)).sort(xl).map(a=>{const n=A(this,ke)[a];return(typeof A(n,ut)=="number"?`(${a})@${A(n,ut)}`:gl.has(a)?`\\${a}`:a)+n.buildRegExpStr()});return typeof A(this,dt)=="number"&&r.unshift(`#${A(this,dt)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},dt=new WeakMap,ut=new WeakMap,ke=new WeakMap,po),Dr,nr,go,yl=(go=class{constructor(){Q(this,Dr,{varIndex:0});Q(this,nr,new In)}insert(t,e,r){const a=[],n=[];for(let o=0;;){let c=!1;if(t=t.replace(/\{[^}]+\}/g,l=>{const u=`@\\${o}`;return n[o]=[u,l],o++,c=!0,u}),!c)break}const s=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){const[c]=n[o];for(let l=s.length-1;l>=0;l--)if(s[l].indexOf(c)!==-1){s[l]=s[l].replace(c,n[o][1]);break}}return A(this,nr).insert(s,e,a,A(this,Dr),r),a}buildRegExp(){let t=A(this,nr).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],a=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,s,o)=>s!==void 0?(r[++e]=Number(s),"$()"):(o!==void 0&&(a[Number(o)]=++e),"")),[new RegExp(`^${t}`),r,a]}},Dr=new WeakMap,nr=new WeakMap,go),zo=[],bl=[/^$/,[],Object.create(null)],Sr=Object.create(null);function Go(t){return Sr[t]??(Sr[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function vl(){Sr=Object.create(null)}function wl(t){var u;const e=new yl,r=[];if(t.length===0)return bl;const a=t.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,h],[p,E])=>d?1:p?-1:h.length-E.length),n=Object.create(null);for(let d=0,h=-1,p=a.length;d<p;d++){const[E,v,b]=a[d];E?n[v]=[b.map(([y])=>[y,Object.create(null)]),zo]:h++;let I;try{I=e.insert(v,h,E)}catch(y){throw y===vt?new Fo(v):y}E||(r[h]=b.map(([y,w])=>{const _=Object.create(null);for(w-=1;w>=0;w--){const[k,j]=I[w];_[k]=j}return[y,_]}))}const[s,o,c]=e.buildRegExp();for(let d=0,h=r.length;d<h;d++)for(let p=0,E=r[d].length;p<E;p++){const v=(u=r[d][p])==null?void 0:u[1];if(!v)continue;const b=Object.keys(v);for(let I=0,y=b.length;I<y;I++)v[b[I]]=c[v[b[I]]]}const l=[];for(const d in o)l[d]=r[o[d]];return[s,l,n]}function pt(t,e){if(t){for(const r of Object.keys(t).sort((a,n)=>n.length-a.length))if(Go(r).test(e))return[...t[r]]}}var Ge,Ve,$t,Vo,Wo,xo,_l=(xo=class{constructor(){Q(this,$t);G(this,"name","RegExpRouter");Q(this,Ge);Q(this,Ve);Z(this,Ge,{[ue]:Object.create(null)}),Z(this,Ve,{[ue]:Object.create(null)})}add(t,e,r){var c;const a=A(this,Ge),n=A(this,Ve);if(!a||!n)throw new Error(qo);a[t]||[a,n].forEach(l=>{l[t]=Object.create(null),Object.keys(l[ue]).forEach(u=>{l[t][u]=[...l[ue][u]]})}),e==="/*"&&(e="*");const s=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const l=Go(e);t===ue?Object.keys(a).forEach(u=>{var d;(d=a[u])[e]||(d[e]=pt(a[u],e)||pt(a[ue],e)||[])}):(c=a[t])[e]||(c[e]=pt(a[t],e)||pt(a[ue],e)||[]),Object.keys(a).forEach(u=>{(t===ue||t===u)&&Object.keys(a[u]).forEach(d=>{l.test(d)&&a[u][d].push([r,s])})}),Object.keys(n).forEach(u=>{(t===ue||t===u)&&Object.keys(n[u]).forEach(d=>l.test(d)&&n[u][d].push([r,s]))});return}const o=$o(e)||[e];for(let l=0,u=o.length;l<u;l++){const d=o[l];Object.keys(n).forEach(h=>{var p;(t===ue||t===h)&&((p=n[h])[d]||(p[d]=[...pt(a[h],d)||pt(a[ue],d)||[]]),n[h][d].push([r,s-u+l+1]))})}}match(t,e){vl();const r=ae(this,$t,Vo).call(this);return this.match=(a,n)=>{const s=r[a]||r[ue],o=s[2][n];if(o)return o;const c=n.match(s[0]);if(!c)return[[],zo];const l=c.indexOf("",1);return[s[1][l],c]},this.match(t,e)}},Ge=new WeakMap,Ve=new WeakMap,$t=new WeakSet,Vo=function(){const t=Object.create(null);return Object.keys(A(this,Ve)).concat(Object.keys(A(this,Ge))).forEach(e=>{t[e]||(t[e]=ae(this,$t,Wo).call(this,e))}),Z(this,Ge,Z(this,Ve,void 0)),t},Wo=function(t){const e=[];let r=t===ue;return[A(this,Ge),A(this,Ve)].forEach(a=>{const n=a[t]?Object.keys(a[t]).map(s=>[s,a[t][s]]):[];n.length!==0?(r||(r=!0),e.push(...n)):t!==ue&&e.push(...Object.keys(a[ue]).map(s=>[s,a[ue][s]]))}),r?wl(e):null},xo),We,De,yo,El=(yo=class{constructor(t){G(this,"name","SmartRouter");Q(this,We,[]);Q(this,De,[]);Z(this,We,t.routers)}add(t,e,r){if(!A(this,De))throw new Error(qo);A(this,De).push([t,e,r])}match(t,e){if(!A(this,De))throw new Error("Fatal error");const r=A(this,We),a=A(this,De),n=r.length;let s=0,o;for(;s<n;s++){const c=r[s];try{for(let l=0,u=a.length;l<u;l++)c.add(...a[l]);o=c.match(t,e)}catch(l){if(l instanceof Fo)continue;throw l}this.match=c.match.bind(c),Z(this,We,[c]),Z(this,De,void 0);break}if(s===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(A(this,De)||A(this,We).length!==1)throw new Error("No active router has been determined yet.");return A(this,We)[0]}},We=new WeakMap,De=new WeakMap,yo),Ft=Object.create(null),Ze,me,ft,kt,he,Me,ct,bo,Zo=(bo=class{constructor(t,e,r){Q(this,Me);Q(this,Ze);Q(this,me);Q(this,ft);Q(this,kt,0);Q(this,he,Ft);if(Z(this,me,r||Object.create(null)),Z(this,Ze,[]),t&&e){const a=Object.create(null);a[t]={handler:e,possibleKeys:[],score:0},Z(this,Ze,[a])}Z(this,ft,[])}insert(t,e,r){Z(this,kt,++cs(this,kt)._);let a=this;const n=rl(e),s=[];for(let o=0,c=n.length;o<c;o++){const l=n[o],u=n[o+1],d=sl(l,u),h=Array.isArray(d)?d[0]:l;if(h in A(a,me)){a=A(a,me)[h],d&&s.push(d[1]);continue}A(a,me)[h]=new Zo,d&&(A(a,ft).push(d),s.push(d[1])),a=A(a,me)[h]}return A(a,Ze).push({[t]:{handler:r,possibleKeys:s.filter((o,c,l)=>l.indexOf(o)===c),score:A(this,kt)}}),a}search(t,e){var c;const r=[];Z(this,he,Ft);let n=[this];const s=Po(e),o=[];for(let l=0,u=s.length;l<u;l++){const d=s[l],h=l===u-1,p=[];for(let E=0,v=n.length;E<v;E++){const b=n[E],I=A(b,me)[d];I&&(Z(I,he,A(b,he)),h?(A(I,me)["*"]&&r.push(...ae(this,Me,ct).call(this,A(I,me)["*"],t,A(b,he))),r.push(...ae(this,Me,ct).call(this,I,t,A(b,he)))):p.push(I));for(let y=0,w=A(b,ft).length;y<w;y++){const _=A(b,ft)[y],k=A(b,he)===Ft?{}:{...A(b,he)};if(_==="*"){const V=A(b,me)["*"];V&&(r.push(...ae(this,Me,ct).call(this,V,t,A(b,he))),Z(V,he,k),p.push(V));continue}const[j,P,M]=_;if(!d&&!(M instanceof RegExp))continue;const L=A(b,me)[j],z=s.slice(l).join("/");if(M instanceof RegExp){const V=M.exec(z);if(V){if(k[P]=V[0],r.push(...ae(this,Me,ct).call(this,L,t,A(b,he),k)),Object.keys(A(L,me)).length){Z(L,he,k);const N=((c=V[0].match(/\//))==null?void 0:c.length)??0;(o[N]||(o[N]=[])).push(L)}continue}}(M===!0||M.test(d))&&(k[P]=d,h?(r.push(...ae(this,Me,ct).call(this,L,t,k,A(b,he))),A(L,me)["*"]&&r.push(...ae(this,Me,ct).call(this,A(L,me)["*"],t,k,A(b,he)))):(Z(L,he,k),p.push(L)))}}n=p.concat(o.shift()??[])}return r.length>1&&r.sort((l,u)=>l.score-u.score),[r.map(({handler:l,params:u})=>[l,u])]}},Ze=new WeakMap,me=new WeakMap,ft=new WeakMap,kt=new WeakMap,he=new WeakMap,Me=new WeakSet,ct=function(t,e,r,a){const n=[];for(let s=0,o=A(t,Ze).length;s<o;s++){const c=A(t,Ze)[s],l=c[e]||c[ue],u={};if(l!==void 0&&(l.params=Object.create(null),n.push(l),r!==Ft||a&&a!==Ft))for(let d=0,h=l.possibleKeys.length;d<h;d++){const p=l.possibleKeys[d],E=u[l.score];l.params[p]=a!=null&&a[p]&&!E?a[p]:r[p]??(a==null?void 0:a[p]),u[l.score]=!0}}return n},bo),ht,vo,Sl=(vo=class{constructor(){G(this,"name","TrieRouter");Q(this,ht);Z(this,ht,new Zo)}add(t,e,r){const a=$o(e);if(a){for(let n=0,s=a.length;n<s;n++)A(this,ht).insert(t,a[n],r);return}A(this,ht).insert(t,e,r)}match(t,e){return A(this,ht).search(t,e)}},ht=new WeakMap,vo),Dt=class extends Uo{constructor(t={}){super(t),this.router=t.router??new El({routers:[new _l,new Sl]})}},Kt="_hp",Nl={Change:"Input",DoubleClick:"DblClick"},Tl={svg:"2000/svg",math:"1998/Math/MathML"},Yt=[],Rn=new WeakMap,Rt=void 0,kl=()=>Rt,Oe=t=>"t"in t,Xr={onClick:["click",!1]},xs=t=>{if(!t.startsWith("on"))return;if(Xr[t])return Xr[t];const e=t.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(e){const[,r,a]=e;return Xr[t]=[(Nl[r]||r).toLowerCase(),!!a]}},ys=(t,e)=>Rt&&t instanceof SVGElement&&/[A-Z]/.test(e)&&(e in t.style||e.match(/^(?:o|pai|str|u|ve)/))?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Il=(t,e,r)=>{var a;e||(e={});for(let n in e){const s=e[n];if(n!=="children"&&(!r||r[n]!==s)){n=Ar(n);const o=xs(n);if(o){if((r==null?void 0:r[n])!==s&&(r&&t.removeEventListener(o[0],r[n],o[1]),s!=null)){if(typeof s!="function")throw new Error(`Event handler for "${n}" is not a function`);t.addEventListener(o[0],s,o[1])}}else if(n==="dangerouslySetInnerHTML"&&s)t.innerHTML=s.__html;else if(n==="ref"){let c;typeof s=="function"?c=s(t)||(()=>s(null)):s&&"current"in s&&(s.current=t,c=()=>s.current=null),Rn.set(t,c)}else if(n==="style"){const c=t.style;typeof s=="string"?c.cssText=s:(c.cssText="",s!=null&&Co(s,c.setProperty.bind(c)))}else{if(n==="value"){const l=t.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(t.value=s==null||s===!1?null:s,l==="TEXTAREA"){t.textContent=s;continue}else if(l==="SELECT"){t.selectedIndex===-1&&(t.selectedIndex=0);continue}}}else(n==="checked"&&t.nodeName==="INPUT"||n==="selected"&&t.nodeName==="OPTION")&&(t[n]=s);const c=ys(t,n);s==null||s===!1?t.removeAttribute(c):s===!0?t.setAttribute(c,""):typeof s=="string"||typeof s=="number"?t.setAttribute(c,s):t.setAttribute(c,s.toString())}}}if(r)for(let n in r){const s=r[n];if(n!=="children"&&!(n in e)){n=Ar(n);const o=xs(n);o?t.removeEventListener(o[0],s,o[1]):n==="ref"?(a=Rn.get(t))==null||a():t.removeAttribute(ys(t,n))}}},Rl=(t,e)=>{e[ce][0]=0,Yt.push([t,e]);const r=e.tag[qn]||e.tag,a=r.defaultProps?{...r.defaultProps,...e.props}:e.props;try{return[r.call(null,a)]}finally{Yt.pop()}},Ko=(t,e,r,a,n)=>{var s,o;(s=t.vR)!=null&&s.length&&(a.push(...t.vR),delete t.vR),typeof t.tag=="function"&&((o=t[ce][1][Qo])==null||o.forEach(c=>n.push(c))),t.vC.forEach(c=>{var l;if(Oe(c))r.push(c);else if(typeof c.tag=="function"||c.tag===""){c.c=e;const u=r.length;if(Ko(c,e,r,a,n),c.s){for(let d=u;d<r.length;d++)r[d].s=!0;c.s=!1}}else r.push(c),(l=c.vR)!=null&&l.length&&(a.push(...c.vR),delete c.vR)})},Al=t=>{for(;;t=t.tag===Kt||!t.vC||!t.pP?t.nN:t.vC[0]){if(!t)return null;if(t.tag!==Kt&&t.e)return t.e}},Yo=t=>{var e,r,a,n,s,o;Oe(t)||((r=(e=t[ce])==null?void 0:e[1][Qo])==null||r.forEach(c=>{var l;return(l=c[2])==null?void 0:l.call(c)}),(a=Rn.get(t.e))==null||a(),t.p===2&&((n=t.vC)==null||n.forEach(c=>c.p=2)),(s=t.vC)==null||s.forEach(Yo)),t.p||((o=t.e)==null||o.remove(),delete t.e),typeof t.tag=="function"&&(zt.delete(t),Nr.delete(t),delete t[ce][3],t.a=!0)},Jo=(t,e,r)=>{t.c=e,Xo(t,e,r)},bs=(t,e)=>{if(e){for(let r=0,a=t.length;r<a;r++)if(t[r]===e)return r}},vs=Symbol(),Xo=(t,e,r)=>{var u;const a=[],n=[],s=[];Ko(t,e,a,n,s),n.forEach(Yo);const o=r?void 0:e.childNodes;let c,l=null;if(r)c=-1;else if(!o.length)c=0;else{const d=bs(o,Al(t.nN));d!==void 0?(l=o[d],c=d):c=bs(o,(u=a.find(h=>h.tag!==Kt&&h.e))==null?void 0:u.e)??-1,c===-1&&(r=!0)}for(let d=0,h=a.length;d<h;d++,c++){const p=a[d];let E;if(p.s&&p.e)E=p.e,p.s=!1;else{const v=r||!p.e;Oe(p)?(p.e&&p.d&&(p.e.textContent=p.t),p.d=!1,E=p.e||(p.e=document.createTextNode(p.t))):(E=p.e||(p.e=p.n?document.createElementNS(p.n,p.tag):document.createElement(p.tag)),Il(E,p.props,p.pP),Xo(p,E,v))}p.tag===Kt?c--:r?E.parentNode||e.appendChild(E):o[c]!==E&&o[c-1]!==E&&(o[c+1]===E?e.appendChild(o[c]):e.insertBefore(E,l||o[c]||null))}if(t.pP&&delete t.pP,s.length){const d=[],h=[];s.forEach(([,p,,E,v])=>{p&&d.push(p),E&&h.push(E),v==null||v()}),d.forEach(p=>p()),h.length&&requestAnimationFrame(()=>{h.forEach(p=>p())})}},Cl=(t,e)=>!!(t&&t.length===e.length&&t.every((r,a)=>r[1]===e[a][1])),Nr=new WeakMap,An=(t,e,r)=>{var s,o,c,l,u,d;const a=!r&&e.pC;r&&(e.pC||(e.pC=e.vC));let n;try{r||(r=typeof e.tag=="function"?Rl(t,e):sr(e.props.children)),((s=r[0])==null?void 0:s.tag)===""&&r[0][Nn]&&(n=r[0][Nn],t[5].push([t,n,e]));const h=a?[...e.pC]:e.vC?[...e.vC]:void 0,p=[];let E;for(let v=0;v<r.length;v++){Array.isArray(r[v])&&r.splice(v,1,...r[v].flat());let b=Ll(r[v]);if(b){typeof b.tag=="function"&&!b.tag[To]&&(It.length>0&&(b[ce][2]=It.map(y=>[y,y.values.at(-1)])),(o=t[5])!=null&&o.length&&(b[ce][3]=t[5].at(-1)));let I;if(h&&h.length){const y=h.findIndex(Oe(b)?w=>Oe(w):b.key!==void 0?w=>w.key===b.key&&w.tag===b.tag:w=>w.tag===b.tag);y!==-1&&(I=h[y],h.splice(y,1))}if(I)if(Oe(b))I.t!==b.t&&(I.t=b.t,I.d=!0),b=I;else{const y=I.pP=I.props;if(I.props=b.props,I.f||(I.f=b.f||e.f),typeof b.tag=="function"){const w=I[ce][2];I[ce][2]=b[ce][2]||[],I[ce][3]=b[ce][3],!I.f&&((I.o||I)===b.o||(l=(c=I.tag)[jc])!=null&&l.call(c,y,I.props))&&Cl(w,I[ce][2])&&(I.s=!0)}b=I}else if(!Oe(b)&&Rt){const y=jt(Rt);y&&(b.n=y)}if(!Oe(b)&&!b.s&&(An(t,b),delete b.f),p.push(b),E&&!E.s&&!b.s)for(let y=E;y&&!Oe(y);y=(u=y.vC)==null?void 0:u.at(-1))y.nN=b;E=b}}e.vR=a?[...e.vC,...h||[]]:h||[],e.vC=p,a&&delete e.pC}catch(h){if(e.f=!0,h===vs){if(n)return;throw h}const[p,E,v]=((d=e[ce])==null?void 0:d[3])||[];if(E){const b=()=>Tr([0,!1,t[2]],v),I=Nr.get(v)||[];I.push(b),Nr.set(v,I);const y=E(h,()=>{const w=Nr.get(v);if(w){const _=w.indexOf(b);if(_!==-1)return w.splice(_,1),b()}});if(y){if(t[0]===1)t[1]=!0;else if(An(t,v,[y]),(E.length===1||t!==p)&&v.c){Jo(v,v.c,!1);return}throw vs}}throw h}finally{n&&t[5].pop()}},Ll=t=>{if(!(t==null||typeof t=="boolean")){if(typeof t=="string"||typeof t=="number")return{t:t.toString(),d:!0};if("vR"in t&&(t={tag:t.tag,props:t.props,key:t.key,f:t.f,type:t.tag,ref:t.props.ref,o:t.o||t}),typeof t.tag=="function")t[ce]=[0,[]];else{const e=Tl[t.tag];e&&(Rt||(Rt=Io("")),t.props.children=[{tag:Rt,props:{value:t.n=`http://www.w3.org/${e}`,children:t.props.children}}])}return t}},ws=(t,e)=>{var r,a;(r=e[ce][2])==null||r.forEach(([n,s])=>{n.values.push(s)});try{An(t,e,void 0)}catch{return}if(e.a){delete e.a;return}(a=e[ce][2])==null||a.forEach(([n])=>{n.values.pop()}),(t[0]!==1||!t[1])&&Jo(e,e.c,!1)},zt=new WeakMap,_s=[],Tr=async(t,e)=>{t[5]||(t[5]=[]);const r=zt.get(e);r&&r[0](void 0);let a;const n=new Promise(s=>a=s);if(zt.set(e,[a,()=>{t[2]?t[2](t,e,s=>{ws(s,e)}).then(()=>a(e)):(ws(t,e),a(e))}]),_s.length)_s.at(-1).add(e);else{await Promise.resolve();const s=zt.get(e);s&&(zt.delete(e),s[1]())}return n},Pl=(t,e,r)=>({tag:Kt,props:{children:t},key:r,e,p:1}),Qr=0,Qo=1,ea=2,ta=3,ra=new WeakMap,ec=(t,e)=>!t||!e||t.length!==e.length||e.some((r,a)=>r!==t[a]),Ol=void 0,Es=[],$l=t=>{var o;const e=()=>typeof t=="function"?t():t,r=Yt.at(-1);if(!r)return[e(),()=>{}];const[,a]=r,n=(o=a[ce][1])[Qr]||(o[Qr]=[]),s=a[ce][0]++;return n[s]||(n[s]=[e(),c=>{const l=Ol,u=n[s];if(typeof c=="function"&&(c=c(u[0])),!Object.is(c,u[0]))if(u[0]=c,Es.length){const[d,h]=Es.at(-1);Promise.all([d===3?a:Tr([d,!1,l],a),h]).then(([p])=>{if(!p||!(d===2||d===3))return;const E=p.vC;requestAnimationFrame(()=>{setTimeout(()=>{E===p.vC&&Tr([d===3?1:0,!1,l],p)})})})}else Tr([0,!1,l],a)}])},Gn=(t,e)=>{var c;const r=Yt.at(-1);if(!r)return t;const[,a]=r,n=(c=a[ce][1])[ea]||(c[ea]=[]),s=a[ce][0]++,o=n[s];return ec(o==null?void 0:o[1],e)?n[s]=[t,e]:t=n[s][0],t},jl=t=>{const e=ra.get(t);if(e){if(e.length===2)throw e[1];return e[0]}throw t.then(r=>ra.set(t,[r]),r=>ra.set(t,[void 0,r])),t},Dl=(t,e)=>{var c;const r=Yt.at(-1);if(!r)return t();const[,a]=r,n=(c=a[ce][1])[ta]||(c[ta]=[]),s=a[ce][0]++,o=n[s];return ec(o==null?void 0:o[1],e)&&(n[s]=[t(),e]),n[s][0]},Ml=Io({pending:!1,data:null,method:null,action:null}),Ss=new Set,Bl=t=>{Ss.add(t),t.finally(()=>Ss.delete(t))},Vn=(t,e)=>Dl(()=>r=>{let a;t&&(typeof t=="function"?a=t(r)||(()=>{t(null)}):t&&"current"in t&&(t.current=r,a=()=>{t.current=null}));const n=e(r);return()=>{n==null||n(),a==null||a()}},[t]),gt=Object.create(null),gr=Object.create(null),cr=(t,e,r,a,n)=>{if(e!=null&&e.itemProp)return{tag:t,props:e,type:t,ref:e.ref};const s=document.head;let{onLoad:o,onError:c,precedence:l,blocking:u,...d}=e,h=null,p=!1;const E=br[t];let v;if(E.length>0){const w=s.querySelectorAll(t);e:for(const _ of w)for(const k of br[t])if(_.getAttribute(k)===e[k]){h=_;break e}if(!h){const _=E.reduce((k,j)=>e[j]===void 0?k:`${k}-${j}-${e[j]}`,t);p=!gr[_],h=gr[_]||(gr[_]=(()=>{const k=document.createElement(t);for(const j of E)e[j]!==void 0&&k.setAttribute(j,e[j]),e.rel&&k.setAttribute("rel",e.rel);return k})())}}else v=s.querySelectorAll(t);l=a?l??"":void 0,a&&(d[vr]=l);const b=Gn(w=>{if(E.length>0){let _=!1;for(const k of s.querySelectorAll(t)){if(_&&k.getAttribute(vr)!==l){s.insertBefore(w,k);return}k.getAttribute(vr)===l&&(_=!0)}s.appendChild(w)}else if(v){let _=!1;for(const k of v)if(k===w){_=!0;break}_||s.insertBefore(w,s.contains(v[0])?v[0]:s.querySelector(t)),v=void 0}},[l]),I=Vn(e.ref,w=>{var j;const _=E[0];if(r===2&&(w.innerHTML=""),(p||v)&&b(w),!c&&!o)return;let k=gt[j=w.getAttribute(_)]||(gt[j]=new Promise((P,M)=>{w.addEventListener("load",P),w.addEventListener("error",M)}));o&&(k=k.then(o)),c&&(k=k.catch(c)),k.catch(()=>{})});if(n&&u==="render"){const w=br[t][0];if(e[w]){const _=e[w],k=gt[_]||(gt[_]=new Promise((j,P)=>{b(h),h.addEventListener("load",j),h.addEventListener("error",P)}));jl(k)}}const y={tag:t,type:t,props:{...d,ref:I},ref:I};return y.p=r,h&&(y.e=h),Pl(y,s)},ql=t=>{const e=kl(),r=e&&jt(e);return r!=null&&r.endsWith("svg")?{tag:"title",props:t,type:"title",ref:t.ref}:cr("title",t,void 0,!1,!1)},Fl=t=>!t||["src","async"].some(e=>!t[e])?{tag:"script",props:t,type:"script",ref:t.ref}:cr("script",t,1,!1,!0),Ul=t=>!t||!["href","precedence"].every(e=>e in t)?{tag:"style",props:t,type:"style",ref:t.ref}:(t["data-href"]=t.href,delete t.href,cr("style",t,2,!0,!0)),Hl=t=>!t||["onLoad","onError"].some(e=>e in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?{tag:"link",props:t,type:"link",ref:t.ref}:cr("link",t,1,"precedence"in t,!0),zl=t=>cr("meta",t,void 0,!1,!1),tc=Symbol(),Gl=t=>{const{action:e,...r}=t;typeof e!="function"&&(r.action=e);const[a,n]=$l([null,!1]),s=Gn(async u=>{const d=u.isTrusted?e:u.detail[tc];if(typeof d!="function")return;u.preventDefault();const h=new FormData(u.target);n([h,!0]);const p=d(h);p instanceof Promise&&(Bl(p),await p),n([null,!0])},[]),o=Vn(t.ref,u=>(u.addEventListener("submit",s),()=>{u.removeEventListener("submit",s)})),[c,l]=a;return a[1]=!1,{tag:Ml,props:{value:{pending:c!==null,data:c,method:c?"post":null,action:c?e:null},children:{tag:"form",props:{...r,ref:o},type:"form",ref:o}},f:l}},rc=(t,{formAction:e,...r})=>{if(typeof e=="function"){const a=Gn(n=>{n.preventDefault(),n.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[tc]:e}}))},[]);r.ref=Vn(r.ref,n=>(n.addEventListener("click",a),()=>{n.removeEventListener("click",a)}))}return{tag:t,props:r,type:t,ref:r.ref}},Vl=t=>rc("input",t),Wl=t=>rc("button",t);Object.assign(Tn,{title:ql,script:Fl,style:Ul,link:Hl,meta:zl,form:Gl,input:Vl,button:Wl});Fn(null);new TextEncoder;var Zl=Fn(null),Kl=(t,e,r,a)=>(n,s)=>{const o="<!DOCTYPE html>",c=r?fs(u=>r(u,t),{Layout:e,...s},n):n,l=$c`${Ee(o)}${fs(Zl.Provider,{value:t},c)}`;return t.html(l)},Yl=(t,e)=>function(a,n){const s=a.getLayout()??Kc;return t&&a.setLayout(o=>t({...o,Layout:s},a)),a.setRenderer(Kl(a,s,t)),n()};const Jl=Yl(({children:t})=>i("html",{children:[i("head",{children:i("link",{href:"/static/style.css",rel:"stylesheet"})}),i("body",{children:t})]}));function ac(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Xl(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kr={exports:{}},Ql=kr.exports,Ns;function ed(){return Ns||(Ns=1,(function(t){/**
 * @license bcrypt.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/bcrypt.js for details
 */(function(e,r){typeof Xl=="function"&&t&&t.exports?t.exports=r():(e.dcodeIO=e.dcodeIO||{}).bcrypt=r()})(Ql,function(){var e={},r=null;function a(N){if(t&&t.exports)try{return require("crypto").randomBytes(N)}catch{}try{var T;return(self.crypto||self.msCrypto).getRandomValues(T=new Uint32Array(N)),Array.prototype.slice.call(T)}catch{}if(!r)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return r(N)}var n=!1;try{a(1),n=!0}catch{}r=null,e.setRandomFallback=function(N){r=N},e.genSaltSync=function(N,T){if(N=N||b,typeof N!="number")throw Error("Illegal arguments: "+typeof N+", "+typeof T);N<4?N=4:N>31&&(N=31);var g=[];return g.push("$2a$"),N<10&&g.push("0"),g.push(N.toString()),g.push("$"),g.push(h(a(v),v)),g.join("")},e.genSalt=function(N,T,g){if(typeof T=="function"&&(g=T,T=void 0),typeof N=="function"&&(g=N,N=void 0),typeof N>"u")N=b;else if(typeof N!="number")throw Error("illegal arguments: "+typeof N);function m(f){o(function(){try{f(null,e.genSaltSync(N))}catch(x){f(x)}})}if(g){if(typeof g!="function")throw Error("Illegal callback: "+typeof g);m(g)}else return new Promise(function(f,x){m(function(S,O){if(S){x(S);return}f(O)})})},e.hashSync=function(N,T){if(typeof T>"u"&&(T=b),typeof T=="number"&&(T=e.genSaltSync(T)),typeof N!="string"||typeof T!="string")throw Error("Illegal arguments: "+typeof N+", "+typeof T);return V(N,T)},e.hash=function(N,T,g,m){function f(x){typeof N=="string"&&typeof T=="number"?e.genSalt(T,function(S,O){V(N,O,x,m)}):typeof N=="string"&&typeof T=="string"?V(N,T,x,m):o(x.bind(this,Error("Illegal arguments: "+typeof N+", "+typeof T)))}if(g){if(typeof g!="function")throw Error("Illegal callback: "+typeof g);f(g)}else return new Promise(function(x,S){f(function(O,C){if(O){S(O);return}x(C)})})};function s(N,T){for(var g=0,m=0,f=0,x=N.length;f<x;++f)N.charCodeAt(f)===T.charCodeAt(f)?++g:++m;return g<0?!1:m===0}e.compareSync=function(N,T){if(typeof N!="string"||typeof T!="string")throw Error("Illegal arguments: "+typeof N+", "+typeof T);return T.length!==60?!1:s(e.hashSync(N,T.substr(0,T.length-31)),T)},e.compare=function(N,T,g,m){function f(x){if(typeof N!="string"||typeof T!="string"){o(x.bind(this,Error("Illegal arguments: "+typeof N+", "+typeof T)));return}if(T.length!==60){o(x.bind(this,null,!1));return}e.hash(N,T.substr(0,29),function(S,O){S?x(S):x(null,s(O,T))},m)}if(g){if(typeof g!="function")throw Error("Illegal callback: "+typeof g);f(g)}else return new Promise(function(x,S){f(function(O,C){if(O){S(O);return}x(C)})})},e.getRounds=function(N){if(typeof N!="string")throw Error("Illegal arguments: "+typeof N);return parseInt(N.split("$")[2],10)},e.getSalt=function(N){if(typeof N!="string")throw Error("Illegal arguments: "+typeof N);if(N.length!==60)throw Error("Illegal hash length: "+N.length+" != 60");return N.substring(0,29)};var o=typeof process<"u"&&process&&typeof process.nextTick=="function"?typeof setImmediate=="function"?setImmediate:process.nextTick:setTimeout;function c(N){var T=[],g=0;return E.encodeUTF16toUTF8(function(){return g>=N.length?null:N.charCodeAt(g++)},function(m){T.push(m)}),T}var l="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1],d=String.fromCharCode;function h(N,T){var g=0,m=[],f,x;if(T<=0||T>N.length)throw Error("Illegal len: "+T);for(;g<T;){if(f=N[g++]&255,m.push(l[f>>2&63]),f=(f&3)<<4,g>=T){m.push(l[f&63]);break}if(x=N[g++]&255,f|=x>>4&15,m.push(l[f&63]),f=(x&15)<<2,g>=T){m.push(l[f&63]);break}x=N[g++]&255,f|=x>>6&3,m.push(l[f&63]),m.push(l[x&63])}return m.join("")}function p(N,T){var g=0,m=N.length,f=0,x=[],S,O,C,D,U,F;if(T<=0)throw Error("Illegal len: "+T);for(;g<m-1&&f<T&&(F=N.charCodeAt(g++),S=F<u.length?u[F]:-1,F=N.charCodeAt(g++),O=F<u.length?u[F]:-1,!(S==-1||O==-1||(U=S<<2>>>0,U|=(O&48)>>4,x.push(d(U)),++f>=T||g>=m)||(F=N.charCodeAt(g++),C=F<u.length?u[F]:-1,C==-1)||(U=(O&15)<<4>>>0,U|=(C&60)>>2,x.push(d(U)),++f>=T||g>=m)));)F=N.charCodeAt(g++),D=F<u.length?u[F]:-1,U=(C&3)<<6>>>0,U|=D,x.push(d(U)),++f;var X=[];for(g=0;g<f;g++)X.push(x[g].charCodeAt(0));return X}var E=(function(){var N={};return N.MAX_CODEPOINT=1114111,N.encodeUTF8=function(T,g){var m=null;for(typeof T=="number"&&(m=T,T=function(){return null});m!==null||(m=T())!==null;)m<128?g(m&127):m<2048?(g(m>>6&31|192),g(m&63|128)):m<65536?(g(m>>12&15|224),g(m>>6&63|128),g(m&63|128)):(g(m>>18&7|240),g(m>>12&63|128),g(m>>6&63|128),g(m&63|128)),m=null},N.decodeUTF8=function(T,g){for(var m,f,x,S,O=function(C){C=C.slice(0,C.indexOf(null));var D=Error(C.toString());throw D.name="TruncatedError",D.bytes=C,D};(m=T())!==null;)if((m&128)===0)g(m);else if((m&224)===192)(f=T())===null&&O([m,f]),g((m&31)<<6|f&63);else if((m&240)===224)((f=T())===null||(x=T())===null)&&O([m,f,x]),g((m&15)<<12|(f&63)<<6|x&63);else if((m&248)===240)((f=T())===null||(x=T())===null||(S=T())===null)&&O([m,f,x,S]),g((m&7)<<18|(f&63)<<12|(x&63)<<6|S&63);else throw RangeError("Illegal starting byte: "+m)},N.UTF16toUTF8=function(T,g){for(var m,f=null;(m=f!==null?f:T())!==null;){if(m>=55296&&m<=57343&&(f=T())!==null&&f>=56320&&f<=57343){g((m-55296)*1024+f-56320+65536),f=null;continue}g(m)}f!==null&&g(f)},N.UTF8toUTF16=function(T,g){var m=null;for(typeof T=="number"&&(m=T,T=function(){return null});m!==null||(m=T())!==null;)m<=65535?g(m):(m-=65536,g((m>>10)+55296),g(m%1024+56320)),m=null},N.encodeUTF16toUTF8=function(T,g){N.UTF16toUTF8(T,function(m){N.encodeUTF8(m,g)})},N.decodeUTF8toUTF16=function(T,g){N.decodeUTF8(T,function(m){N.UTF8toUTF16(m,g)})},N.calculateCodePoint=function(T){return T<128?1:T<2048?2:T<65536?3:4},N.calculateUTF8=function(T){for(var g,m=0;(g=T())!==null;)m+=N.calculateCodePoint(g);return m},N.calculateUTF16asUTF8=function(T){var g=0,m=0;return N.UTF16toUTF8(T,function(f){++g,m+=N.calculateCodePoint(f)}),[g,m]},N})();Date.now=Date.now||function(){return+new Date};var v=16,b=10,I=16,y=100,w=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],_=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],k=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function j(N,T,g,m){var f,x=N[T],S=N[T+1];return x^=g[0],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[1],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[2],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[3],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[4],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[5],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[6],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[7],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[8],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[9],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[10],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[11],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[12],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[13],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[14],f=m[x>>>24],f+=m[256|x>>16&255],f^=m[512|x>>8&255],f+=m[768|x&255],S^=f^g[15],f=m[S>>>24],f+=m[256|S>>16&255],f^=m[512|S>>8&255],f+=m[768|S&255],x^=f^g[16],N[T]=S^g[I+1],N[T+1]=x,N}function P(N,T){for(var g=0,m=0;g<4;++g)m=m<<8|N[T]&255,T=(T+1)%N.length;return{key:m,offp:T}}function M(N,T,g){for(var m=0,f=[0,0],x=T.length,S=g.length,O,C=0;C<x;C++)O=P(N,m),m=O.offp,T[C]=T[C]^O.key;for(C=0;C<x;C+=2)f=j(f,0,T,g),T[C]=f[0],T[C+1]=f[1];for(C=0;C<S;C+=2)f=j(f,0,T,g),g[C]=f[0],g[C+1]=f[1]}function L(N,T,g,m){for(var f=0,x=[0,0],S=g.length,O=m.length,C,D=0;D<S;D++)C=P(T,f),f=C.offp,g[D]=g[D]^C.key;for(f=0,D=0;D<S;D+=2)C=P(N,f),f=C.offp,x[0]^=C.key,C=P(N,f),f=C.offp,x[1]^=C.key,x=j(x,0,g,m),g[D]=x[0],g[D+1]=x[1];for(D=0;D<O;D+=2)C=P(N,f),f=C.offp,x[0]^=C.key,C=P(N,f),f=C.offp,x[1]^=C.key,x=j(x,0,g,m),m[D]=x[0],m[D+1]=x[1]}function z(N,T,g,m,f){var x=k.slice(),S=x.length,O;if(g<4||g>31)if(O=Error("Illegal number of rounds (4-31): "+g),m){o(m.bind(this,O));return}else throw O;if(T.length!==v)if(O=Error("Illegal salt length: "+T.length+" != "+v),m){o(m.bind(this,O));return}else throw O;g=1<<g>>>0;var C,D,U=0,F;Int32Array?(C=new Int32Array(w),D=new Int32Array(_)):(C=w.slice(),D=_.slice()),L(T,N,C,D);function X(){if(f&&f(U/g),U<g)for(var ne=Date.now();U<g&&(U=U+1,M(N,C,D),M(T,C,D),!(Date.now()-ne>y)););else{for(U=0;U<64;U++)for(F=0;F<S>>1;F++)j(x,F<<1,C,D);var ie=[];for(U=0;U<S;U++)ie.push((x[U]>>24&255)>>>0),ie.push((x[U]>>16&255)>>>0),ie.push((x[U]>>8&255)>>>0),ie.push((x[U]&255)>>>0);if(m){m(null,ie);return}else return ie}m&&o(X)}if(typeof m<"u")X();else for(var oe;;)if(typeof(oe=X())<"u")return oe||[]}function V(N,T,g,m){var f;if(typeof N!="string"||typeof T!="string")if(f=Error("Invalid string / salt: Not a string"),g){o(g.bind(this,f));return}else throw f;var x,S;if(T.charAt(0)!=="$"||T.charAt(1)!=="2")if(f=Error("Invalid salt version: "+T.substring(0,2)),g){o(g.bind(this,f));return}else throw f;if(T.charAt(2)==="$")x="\0",S=3;else{if(x=T.charAt(2),x!=="a"&&x!=="b"&&x!=="y"||T.charAt(3)!=="$")if(f=Error("Invalid salt revision: "+T.substring(2,4)),g){o(g.bind(this,f));return}else throw f;S=4}if(T.charAt(S+2)>"$")if(f=Error("Missing salt rounds"),g){o(g.bind(this,f));return}else throw f;var O=parseInt(T.substring(S,S+1),10)*10,C=parseInt(T.substring(S+1,S+2),10),D=O+C,U=T.substring(S+3,S+25);N+=x>="a"?"\0":"";var F=c(N),X=p(U,v);function oe(ne){var ie=[];return ie.push("$2"),x>="a"&&ie.push(x),ie.push("$"),D<10&&ie.push("0"),ie.push(D.toString()),ie.push("$"),ie.push(h(X,X.length)),ie.push(h(ne,k.length*4-1)),ie.join("")}if(typeof g>"u")return oe(z(F,X,D));z(F,X,D,function(ne,ie){ne?g(ne,null):g(null,oe(ie))},m)}return e.encodeBase64=h,e.decodeBase64=p,e})})(kr)),kr.exports}var nc=ed();const Cn=ac(nc),td=wo({__proto__:null,default:Cn},[nc]);var Pe={},xr={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Ts;function lr(){return Ts||(Ts=1,(function(t,e){var r=Ir,a=r.Buffer;function n(o,c){for(var l in o)c[l]=o[l]}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?t.exports=r:(n(r,e),e.Buffer=s);function s(o,c,l){return a(o,c,l)}s.prototype=Object.create(a.prototype),n(a,s),s.from=function(o,c,l){if(typeof o=="number")throw new TypeError("Argument must not be a number");return a(o,c,l)},s.alloc=function(o,c,l){if(typeof o!="number")throw new TypeError("Argument must be a number");var u=a(o);return c!==void 0?typeof l=="string"?u.fill(c,l):u.fill(c):u.fill(0),u},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return a(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(o)}})(xr,xr.exports)),xr.exports}var aa,ks;function sc(){if(ks)return aa;ks=1;var t=lr().Buffer,e=Mn,r=Mr;function a(n){if(this.buffer=null,this.writable=!0,this.readable=!0,!n)return this.buffer=t.alloc(0),this;if(typeof n.pipe=="function")return this.buffer=t.alloc(0),n.pipe(this),this;if(n.length||typeof n=="object")return this.buffer=n,this.writable=!1,process.nextTick((function(){this.emit("end",n),this.readable=!1,this.emit("close")}).bind(this)),this;throw new TypeError("Unexpected data type ("+typeof n+")")}return r.inherits(a,e),a.prototype.write=function(s){this.buffer=t.concat([this.buffer,t.from(s)]),this.emit("data",s)},a.prototype.end=function(s){s&&this.write(s),this.emit("end",s),this.emit("close"),this.writable=!1,this.readable=!1},aa=a,aa}var na,Is;function rd(){if(Is)return na;Is=1;function t(a){var n=(a/8|0)+(a%8===0?0:1);return n}var e={ES256:t(256),ES384:t(384),ES512:t(521)};function r(a){var n=e[a];if(n)return n;throw new Error('Unknown algorithm "'+a+'"')}return na=r,na}var sa,Rs;function ad(){if(Rs)return sa;Rs=1;var t=lr().Buffer,e=rd(),r=128,a=0,n=32,s=16,o=2,c=s|n|a<<6,l=o|a<<6;function u(v){return v.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function d(v){if(t.isBuffer(v))return v;if(typeof v=="string")return t.from(v,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function h(v,b){v=d(v);var I=e(b),y=I+1,w=v.length,_=0;if(v[_++]!==c)throw new Error('Could not find expected "seq"');var k=v[_++];if(k===(r|1)&&(k=v[_++]),w-_<k)throw new Error('"seq" specified length of "'+k+'", only "'+(w-_)+'" remaining');if(v[_++]!==l)throw new Error('Could not find expected "int" for "r"');var j=v[_++];if(w-_-2<j)throw new Error('"r" specified length of "'+j+'", only "'+(w-_-2)+'" available');if(y<j)throw new Error('"r" specified length of "'+j+'", max of "'+y+'" is acceptable');var P=_;if(_+=j,v[_++]!==l)throw new Error('Could not find expected "int" for "s"');var M=v[_++];if(w-_!==M)throw new Error('"s" specified length of "'+M+'", expected "'+(w-_)+'"');if(y<M)throw new Error('"s" specified length of "'+M+'", max of "'+y+'" is acceptable');var L=_;if(_+=M,_!==w)throw new Error('Expected to consume entire buffer, but "'+(w-_)+'" bytes remain');var z=I-j,V=I-M,N=t.allocUnsafe(z+j+V+M);for(_=0;_<z;++_)N[_]=0;v.copy(N,_,P+Math.max(-z,0),P+j),_=I;for(var T=_;_<T+V;++_)N[_]=0;return v.copy(N,_,L+Math.max(-V,0),L+M),N=N.toString("base64"),N=u(N),N}function p(v,b,I){for(var y=0;b+y<I&&v[b+y]===0;)++y;var w=v[b+y]>=r;return w&&--y,y}function E(v,b){v=d(v);var I=e(b),y=v.length;if(y!==I*2)throw new TypeError('"'+b+'" signatures must be "'+I*2+'" bytes, saw "'+y+'"');var w=p(v,0,I),_=p(v,I,v.length),k=I-w,j=I-_,P=2+k+1+1+j,M=P<r,L=t.allocUnsafe((M?2:3)+P),z=0;return L[z++]=c,M?L[z++]=P:(L[z++]=r|1,L[z++]=P&255),L[z++]=l,L[z++]=k,w<0?(L[z++]=0,z+=v.copy(L,z,0,I)):z+=v.copy(L,z,w,I),L[z++]=l,L[z++]=j,_<0?(L[z++]=0,v.copy(L,z,I)):v.copy(L,z,I+_),L}return sa={derToJose:h,joseToDer:E},sa}var ia,As;function nd(){if(As)return ia;As=1;var t=Ir.Buffer,e=Ir.SlowBuffer;ia=r;function r(s,o){if(!t.isBuffer(s)||!t.isBuffer(o)||s.length!==o.length)return!1;for(var c=0,l=0;l<s.length;l++)c|=s[l]^o[l];return c===0}r.install=function(){t.prototype.equal=e.prototype.equal=function(o){return r(this,o)}};var a=t.prototype.equal,n=e.prototype.equal;return r.restore=function(){t.prototype.equal=a,e.prototype.equal=n},ia}var oa,Cs;function ic(){if(Cs)return oa;Cs=1;var t=lr().Buffer,e=Bn,r=ad(),a=Mr,n=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,s="secret must be a string or buffer",o="key must be a string or a buffer",c="key must be a string, a buffer or an object",l=typeof e.createPublicKey=="function";l&&(o+=" or a KeyObject",s+="or a KeyObject");function u(g){if(!t.isBuffer(g)&&typeof g!="string"&&(!l||typeof g!="object"||typeof g.type!="string"||typeof g.asymmetricKeyType!="string"||typeof g.export!="function"))throw v(o)}function d(g){if(!t.isBuffer(g)&&typeof g!="string"&&typeof g!="object")throw v(c)}function h(g){if(!t.isBuffer(g)){if(typeof g=="string")return g;if(!l||typeof g!="object"||g.type!=="secret"||typeof g.export!="function")throw v(s)}}function p(g){return g.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function E(g){g=g.toString();var m=4-g.length%4;if(m!==4)for(var f=0;f<m;++f)g+="=";return g.replace(/\-/g,"+").replace(/_/g,"/")}function v(g){var m=[].slice.call(arguments,1),f=a.format.bind(a,g).apply(null,m);return new TypeError(f)}function b(g){return t.isBuffer(g)||typeof g=="string"}function I(g){return b(g)||(g=JSON.stringify(g)),g}function y(g){return function(f,x){h(x),f=I(f);var S=e.createHmac("sha"+g,x),O=(S.update(f),S.digest("base64"));return p(O)}}var w,_="timingSafeEqual"in e?function(m,f){return m.byteLength!==f.byteLength?!1:e.timingSafeEqual(m,f)}:function(m,f){return w||(w=nd()),w(m,f)};function k(g){return function(f,x,S){var O=y(g)(f,S);return _(t.from(x),t.from(O))}}function j(g){return function(f,x){d(x),f=I(f);var S=e.createSign("RSA-SHA"+g),O=(S.update(f),S.sign(x,"base64"));return p(O)}}function P(g){return function(f,x,S){u(S),f=I(f),x=E(x);var O=e.createVerify("RSA-SHA"+g);return O.update(f),O.verify(S,x,"base64")}}function M(g){return function(f,x){d(x),f=I(f);var S=e.createSign("RSA-SHA"+g),O=(S.update(f),S.sign({key:x,padding:e.constants.RSA_PKCS1_PSS_PADDING,saltLength:e.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return p(O)}}function L(g){return function(f,x,S){u(S),f=I(f),x=E(x);var O=e.createVerify("RSA-SHA"+g);return O.update(f),O.verify({key:S,padding:e.constants.RSA_PKCS1_PSS_PADDING,saltLength:e.constants.RSA_PSS_SALTLEN_DIGEST},x,"base64")}}function z(g){var m=j(g);return function(){var x=m.apply(null,arguments);return x=r.derToJose(x,"ES"+g),x}}function V(g){var m=P(g);return function(x,S,O){S=r.joseToDer(S,"ES"+g).toString("base64");var C=m(x,S,O);return C}}function N(){return function(){return""}}function T(){return function(m,f){return f===""}}return oa=function(m){var f={hs:y,rs:j,ps:M,es:z,none:N},x={hs:k,rs:P,ps:L,es:V,none:T},S=m.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!S)throw v(n,m);var O=(S[1]||S[3]).toLowerCase(),C=S[2];return{sign:f[O](C),verify:x[O](C)}},oa}var ca,Ls;function oc(){if(Ls)return ca;Ls=1;var t=Ir.Buffer;return ca=function(r){return typeof r=="string"?r:typeof r=="number"||t.isBuffer(r)?r.toString():JSON.stringify(r)},ca}var la,Ps;function sd(){if(Ps)return la;Ps=1;var t=lr().Buffer,e=sc(),r=ic(),a=Mn,n=oc(),s=Mr;function o(d,h){return t.from(d,h).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function c(d,h,p){p=p||"utf8";var E=o(n(d),"binary"),v=o(n(h),p);return s.format("%s.%s",E,v)}function l(d){var h=d.header,p=d.payload,E=d.secret||d.privateKey,v=d.encoding,b=r(h.alg),I=c(h,p,v),y=b.sign(I,E);return s.format("%s.%s",I,y)}function u(d){var h=d.secret||d.privateKey||d.key,p=new e(h);this.readable=!0,this.header=d.header,this.encoding=d.encoding,this.secret=this.privateKey=this.key=p,this.payload=new e(d.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}return s.inherits(u,a),u.prototype.sign=function(){try{var h=l({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",h),this.emit("data",h),this.emit("end"),this.readable=!1,h}catch(p){this.readable=!1,this.emit("error",p),this.emit("close")}},u.sign=l,la=u,la}var da,Os;function id(){if(Os)return da;Os=1;var t=lr().Buffer,e=sc(),r=ic(),a=Mn,n=oc(),s=Mr,o=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function c(y){return Object.prototype.toString.call(y)==="[object Object]"}function l(y){if(c(y))return y;try{return JSON.parse(y)}catch{return}}function u(y){var w=y.split(".",1)[0];return l(t.from(w,"base64").toString("binary"))}function d(y){return y.split(".",2).join(".")}function h(y){return y.split(".")[2]}function p(y,w){w=w||"utf8";var _=y.split(".")[1];return t.from(_,"base64").toString(w)}function E(y){return o.test(y)&&!!u(y)}function v(y,w,_){if(!w){var k=new Error("Missing algorithm parameter for jws.verify");throw k.code="MISSING_ALGORITHM",k}y=n(y);var j=h(y),P=d(y),M=r(w);return M.verify(P,j,_)}function b(y,w){if(w=w||{},y=n(y),!E(y))return null;var _=u(y);if(!_)return null;var k=p(y);return(_.typ==="JWT"||w.json)&&(k=JSON.parse(k,w.encoding)),{header:_,payload:k,signature:h(y)}}function I(y){y=y||{};var w=y.secret||y.publicKey||y.key,_=new e(w);this.readable=!0,this.algorithm=y.algorithm,this.encoding=y.encoding,this.secret=this.publicKey=this.key=_,this.signature=new e(y.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}return s.inherits(I,a),I.prototype.verify=function(){try{var w=v(this.signature.buffer,this.algorithm,this.key.buffer),_=b(this.signature.buffer,this.encoding);return this.emit("done",w,_),this.emit("data",w),this.emit("end"),this.readable=!1,w}catch(k){this.readable=!1,this.emit("error",k),this.emit("close")}},I.decode=b,I.isValid=E,I.verify=v,da=I,da}var $s;function Wn(){if($s)return Pe;$s=1;var t=sd(),e=id(),r=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];return Pe.ALGORITHMS=r,Pe.sign=t.sign,Pe.verify=e.verify,Pe.decode=e.decode,Pe.isValid=e.isValid,Pe.createSign=function(n){return new t(n)},Pe.createVerify=function(n){return new e(n)},Pe}var ua,js;function cc(){if(js)return ua;js=1;var t=Wn();return ua=function(e,r){r=r||{};var a=t.decode(e,r);if(!a)return null;var n=a.payload;if(typeof n=="string")try{var s=JSON.parse(n);s!==null&&typeof s=="object"&&(n=s)}catch{}return r.complete===!0?{header:a.header,payload:n,signature:a.signature}:n},ua}var fa,Ds;function qr(){if(Ds)return fa;Ds=1;var t=function(e,r){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,r&&(this.inner=r)};return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,fa=t,fa}var ha,Ms;function lc(){if(Ms)return ha;Ms=1;var t=qr(),e=function(r,a){t.call(this,r),this.name="NotBeforeError",this.date=a};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ha=e,ha}var ma,Bs;function dc(){if(Bs)return ma;Bs=1;var t=qr(),e=function(r,a){t.call(this,r),this.name="TokenExpiredError",this.expiredAt=a};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ma=e,ma}var pa,qs;function od(){if(qs)return pa;qs=1;var t=1e3,e=t*60,r=e*60,a=r*24,n=a*7,s=a*365.25;pa=function(d,h){h=h||{};var p=typeof d;if(p==="string"&&d.length>0)return o(d);if(p==="number"&&isFinite(d))return h.long?l(d):c(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function o(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var p=parseFloat(h[1]),E=(h[2]||"ms").toLowerCase();switch(E){case"years":case"year":case"yrs":case"yr":case"y":return p*s;case"weeks":case"week":case"w":return p*n;case"days":case"day":case"d":return p*a;case"hours":case"hour":case"hrs":case"hr":case"h":return p*r;case"minutes":case"minute":case"mins":case"min":case"m":return p*e;case"seconds":case"second":case"secs":case"sec":case"s":return p*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function c(d){var h=Math.abs(d);return h>=a?Math.round(d/a)+"d":h>=r?Math.round(d/r)+"h":h>=e?Math.round(d/e)+"m":h>=t?Math.round(d/t)+"s":d+"ms"}function l(d){var h=Math.abs(d);return h>=a?u(d,h,a,"day"):h>=r?u(d,h,r,"hour"):h>=e?u(d,h,e,"minute"):h>=t?u(d,h,t,"second"):d+" ms"}function u(d,h,p,E){var v=h>=p*1.5;return Math.round(d/p)+" "+E+(v?"s":"")}return pa}var ga,Fs;function uc(){if(Fs)return ga;Fs=1;var t=od();return ga=function(e,r){var a=r||Math.floor(Date.now()/1e3);if(typeof e=="string"){var n=t(e);return typeof n>"u"?void 0:Math.floor(a+n/1e3)}else return typeof e=="number"?a+e:void 0},ga}var yr={exports:{}},xa,Us;function Fr(){if(Us)return xa;Us=1;const t="2.0.0",e=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,a=16,n=e-6;return xa={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},xa}var ya,Hs;function Ur(){if(Hs)return ya;Hs=1;var t={};return ya=typeof process=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{},ya}var zs;function dr(){return zs||(zs=1,(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:n}=Fr(),s=Ur();e=t.exports={};const o=e.re=[],c=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],d=e.t={};let h=0;const p="[a-zA-Z0-9-]",E=[["\\s",1],["\\d",n],[p,a]],v=I=>{for(const[y,w]of E)I=I.split(`${y}*`).join(`${y}{0,${w}}`).split(`${y}+`).join(`${y}{1,${w}}`);return I},b=(I,y,w)=>{const _=v(y),k=h++;s(I,k,y),d[I]=k,l[k]=y,u[k]=_,o[k]=new RegExp(y,w?"g":void 0),c[k]=new RegExp(_,w?"g":void 0)};b("NUMERICIDENTIFIER","0|[1-9]\\d*"),b("NUMERICIDENTIFIERLOOSE","\\d+"),b("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),b("MAINVERSION",`(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})`),b("MAINVERSIONLOOSE",`(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASEIDENTIFIER",`(?:${l[d.NONNUMERICIDENTIFIER]}|${l[d.NUMERICIDENTIFIER]})`),b("PRERELEASEIDENTIFIERLOOSE",`(?:${l[d.NONNUMERICIDENTIFIER]}|${l[d.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASE",`(?:-(${l[d.PRERELEASEIDENTIFIER]}(?:\\.${l[d.PRERELEASEIDENTIFIER]})*))`),b("PRERELEASELOOSE",`(?:-?(${l[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[d.PRERELEASEIDENTIFIERLOOSE]})*))`),b("BUILDIDENTIFIER",`${p}+`),b("BUILD",`(?:\\+(${l[d.BUILDIDENTIFIER]}(?:\\.${l[d.BUILDIDENTIFIER]})*))`),b("FULLPLAIN",`v?${l[d.MAINVERSION]}${l[d.PRERELEASE]}?${l[d.BUILD]}?`),b("FULL",`^${l[d.FULLPLAIN]}$`),b("LOOSEPLAIN",`[v=\\s]*${l[d.MAINVERSIONLOOSE]}${l[d.PRERELEASELOOSE]}?${l[d.BUILD]}?`),b("LOOSE",`^${l[d.LOOSEPLAIN]}$`),b("GTLT","((?:<|>)?=?)"),b("XRANGEIDENTIFIERLOOSE",`${l[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),b("XRANGEIDENTIFIER",`${l[d.NUMERICIDENTIFIER]}|x|X|\\*`),b("XRANGEPLAIN",`[v=\\s]*(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:${l[d.PRERELEASE]})?${l[d.BUILD]}?)?)?`),b("XRANGEPLAINLOOSE",`[v=\\s]*(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:${l[d.PRERELEASELOOSE]})?${l[d.BUILD]}?)?)?`),b("XRANGE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAIN]}$`),b("XRANGELOOSE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAINLOOSE]}$`),b("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),b("COERCE",`${l[d.COERCEPLAIN]}(?:$|[^\\d])`),b("COERCEFULL",l[d.COERCEPLAIN]+`(?:${l[d.PRERELEASE]})?(?:${l[d.BUILD]})?(?:$|[^\\d])`),b("COERCERTL",l[d.COERCE],!0),b("COERCERTLFULL",l[d.COERCEFULL],!0),b("LONETILDE","(?:~>?)"),b("TILDETRIM",`(\\s*)${l[d.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",b("TILDE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAIN]}$`),b("TILDELOOSE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAINLOOSE]}$`),b("LONECARET","(?:\\^)"),b("CARETTRIM",`(\\s*)${l[d.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",b("CARET",`^${l[d.LONECARET]}${l[d.XRANGEPLAIN]}$`),b("CARETLOOSE",`^${l[d.LONECARET]}${l[d.XRANGEPLAINLOOSE]}$`),b("COMPARATORLOOSE",`^${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]})$|^$`),b("COMPARATOR",`^${l[d.GTLT]}\\s*(${l[d.FULLPLAIN]})$|^$`),b("COMPARATORTRIM",`(\\s*)${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]}|${l[d.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",b("HYPHENRANGE",`^\\s*(${l[d.XRANGEPLAIN]})\\s+-\\s+(${l[d.XRANGEPLAIN]})\\s*$`),b("HYPHENRANGELOOSE",`^\\s*(${l[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[d.XRANGEPLAINLOOSE]})\\s*$`),b("STAR","(<|>)?=?\\s*\\*"),b("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),b("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(yr,yr.exports)),yr.exports}var ba,Gs;function Zn(){if(Gs)return ba;Gs=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return ba=a=>a?typeof a!="object"?t:a:e,ba}var va,Vs;function fc(){if(Vs)return va;Vs=1;const t=/^[0-9]+$/,e=(a,n)=>{const s=t.test(a),o=t.test(n);return s&&o&&(a=+a,n=+n),a===n?0:s&&!o?-1:o&&!s?1:a<n?-1:1};return va={compareIdentifiers:e,rcompareIdentifiers:(a,n)=>e(n,a)},va}var wa,Ws;function xe(){if(Ws)return wa;Ws=1;const t=Ur(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:r}=Fr(),{safeRe:a,t:n}=dr(),s=Zn(),{compareIdentifiers:o}=fc();class c{constructor(u,d){if(d=s(d),u instanceof c){if(u.loose===!!d.loose&&u.includePrerelease===!!d.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",u,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=u.trim().match(d.loose?a[n.LOOSE]:a[n.FULL]);if(!h)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(p=>{if(/^[0-9]+$/.test(p)){const E=+p;if(E>=0&&E<r)return E}return p}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(t("SemVer.compare",this.version,this.options,u),!(u instanceof c)){if(typeof u=="string"&&u===this.version)return 0;u=new c(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof c||(u=new c(u,this.options)),o(this.major,u.major)||o(this.minor,u.minor)||o(this.patch,u.patch)}comparePre(u){if(u instanceof c||(u=new c(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],p=u.prerelease[d];if(t("prerelease compare",d,h,p),h===void 0&&p===void 0)return 0;if(p===void 0)return 1;if(h===void 0)return-1;if(h===p)continue;return o(h,p)}while(++d)}compareBuild(u){u instanceof c||(u=new c(u,this.options));let d=0;do{const h=this.build[d],p=u.build[d];if(t("build compare",d,h,p),h===void 0&&p===void 0)return 0;if(p===void 0)return 1;if(h===void 0)return-1;if(h===p)continue;return o(h,p)}while(++d)}inc(u,d,h){if(u.startsWith("pre")){if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const p=`-${d}`.match(this.options.loose?a[n.PRERELEASELOOSE]:a[n.PRERELEASE]);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const p=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[p];else{let E=this.prerelease.length;for(;--E>=0;)typeof this.prerelease[E]=="number"&&(this.prerelease[E]++,E=-2);if(E===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(p)}}if(d){let E=[d,p];h===!1&&(E=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=E):this.prerelease=E}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return wa=c,wa}var _a,Zs;function Mt(){if(Zs)return _a;Zs=1;const t=xe();return _a=(r,a,n=!1)=>{if(r instanceof t)return r;try{return new t(r,a)}catch(s){if(!n)return null;throw s}},_a}var Ea,Ks;function cd(){if(Ks)return Ea;Ks=1;const t=Mt();return Ea=(r,a)=>{const n=t(r,a);return n?n.version:null},Ea}var Sa,Ys;function ld(){if(Ys)return Sa;Ys=1;const t=Mt();return Sa=(r,a)=>{const n=t(r.trim().replace(/^[=v]+/,""),a);return n?n.version:null},Sa}var Na,Js;function dd(){if(Js)return Na;Js=1;const t=xe();return Na=(r,a,n,s,o)=>{typeof n=="string"&&(o=s,s=n,n=void 0);try{return new t(r instanceof t?r.version:r,n).inc(a,s,o).version}catch{return null}},Na}var Ta,Xs;function ud(){if(Xs)return Ta;Xs=1;const t=Mt();return Ta=(r,a)=>{const n=t(r,null,!0),s=t(a,null,!0),o=n.compare(s);if(o===0)return null;const c=o>0,l=c?n:s,u=c?s:n,d=!!l.prerelease.length;if(!!u.prerelease.length&&!d){if(!u.patch&&!u.minor)return"major";if(u.compareMain(l)===0)return u.minor&&!u.patch?"minor":"patch"}const p=d?"pre":"";return n.major!==s.major?p+"major":n.minor!==s.minor?p+"minor":n.patch!==s.patch?p+"patch":"prerelease"},Ta}var ka,Qs;function fd(){if(Qs)return ka;Qs=1;const t=xe();return ka=(r,a)=>new t(r,a).major,ka}var Ia,ei;function hd(){if(ei)return Ia;ei=1;const t=xe();return Ia=(r,a)=>new t(r,a).minor,Ia}var Ra,ti;function md(){if(ti)return Ra;ti=1;const t=xe();return Ra=(r,a)=>new t(r,a).patch,Ra}var Aa,ri;function pd(){if(ri)return Aa;ri=1;const t=Mt();return Aa=(r,a)=>{const n=t(r,a);return n&&n.prerelease.length?n.prerelease:null},Aa}var Ca,ai;function Re(){if(ai)return Ca;ai=1;const t=xe();return Ca=(r,a,n)=>new t(r,n).compare(new t(a,n)),Ca}var La,ni;function gd(){if(ni)return La;ni=1;const t=Re();return La=(r,a,n)=>t(a,r,n),La}var Pa,si;function xd(){if(si)return Pa;si=1;const t=Re();return Pa=(r,a)=>t(r,a,!0),Pa}var Oa,ii;function Kn(){if(ii)return Oa;ii=1;const t=xe();return Oa=(r,a,n)=>{const s=new t(r,n),o=new t(a,n);return s.compare(o)||s.compareBuild(o)},Oa}var $a,oi;function yd(){if(oi)return $a;oi=1;const t=Kn();return $a=(r,a)=>r.sort((n,s)=>t(n,s,a)),$a}var ja,ci;function bd(){if(ci)return ja;ci=1;const t=Kn();return ja=(r,a)=>r.sort((n,s)=>t(s,n,a)),ja}var Da,li;function Hr(){if(li)return Da;li=1;const t=Re();return Da=(r,a,n)=>t(r,a,n)>0,Da}var Ma,di;function Yn(){if(di)return Ma;di=1;const t=Re();return Ma=(r,a,n)=>t(r,a,n)<0,Ma}var Ba,ui;function hc(){if(ui)return Ba;ui=1;const t=Re();return Ba=(r,a,n)=>t(r,a,n)===0,Ba}var qa,fi;function mc(){if(fi)return qa;fi=1;const t=Re();return qa=(r,a,n)=>t(r,a,n)!==0,qa}var Fa,hi;function Jn(){if(hi)return Fa;hi=1;const t=Re();return Fa=(r,a,n)=>t(r,a,n)>=0,Fa}var Ua,mi;function Xn(){if(mi)return Ua;mi=1;const t=Re();return Ua=(r,a,n)=>t(r,a,n)<=0,Ua}var Ha,pi;function pc(){if(pi)return Ha;pi=1;const t=hc(),e=mc(),r=Hr(),a=Jn(),n=Yn(),s=Xn();return Ha=(c,l,u,d)=>{switch(l){case"===":return typeof c=="object"&&(c=c.version),typeof u=="object"&&(u=u.version),c===u;case"!==":return typeof c=="object"&&(c=c.version),typeof u=="object"&&(u=u.version),c!==u;case"":case"=":case"==":return t(c,u,d);case"!=":return e(c,u,d);case">":return r(c,u,d);case">=":return a(c,u,d);case"<":return n(c,u,d);case"<=":return s(c,u,d);default:throw new TypeError(`Invalid operator: ${l}`)}},Ha}var za,gi;function vd(){if(gi)return za;gi=1;const t=xe(),e=Mt(),{safeRe:r,t:a}=dr();return za=(s,o)=>{if(s instanceof t)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;o=o||{};let c=null;if(!o.rtl)c=s.match(o.includePrerelease?r[a.COERCEFULL]:r[a.COERCE]);else{const E=o.includePrerelease?r[a.COERCERTLFULL]:r[a.COERCERTL];let v;for(;(v=E.exec(s))&&(!c||c.index+c[0].length!==s.length);)(!c||v.index+v[0].length!==c.index+c[0].length)&&(c=v),E.lastIndex=v.index+v[1].length+v[2].length;E.lastIndex=-1}if(c===null)return null;const l=c[2],u=c[3]||"0",d=c[4]||"0",h=o.includePrerelease&&c[5]?`-${c[5]}`:"",p=o.includePrerelease&&c[6]?`+${c[6]}`:"";return e(`${l}.${u}.${d}${h}${p}`,o)},za}var Ga,xi;function wd(){if(xi)return Ga;xi=1;class t{constructor(){this.max=1e3,this.map=new Map}get(r){const a=this.map.get(r);if(a!==void 0)return this.map.delete(r),this.map.set(r,a),a}delete(r){return this.map.delete(r)}set(r,a){if(!this.delete(r)&&a!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(r,a)}return this}}return Ga=t,Ga}var Va,yi;function Ae(){if(yi)return Va;yi=1;const t=/\s+/g;class e{constructor(f,x){if(x=n(x),f instanceof e)return f.loose===!!x.loose&&f.includePrerelease===!!x.includePrerelease?f:new e(f.raw,x);if(f instanceof s)return this.raw=f.value,this.set=[[f]],this.formatted=void 0,this;if(this.options=x,this.loose=!!x.loose,this.includePrerelease=!!x.includePrerelease,this.raw=f.trim().replace(t," "),this.set=this.raw.split("||").map(S=>this.parseRange(S.trim())).filter(S=>S.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const S=this.set[0];if(this.set=this.set.filter(O=>!b(O[0])),this.set.length===0)this.set=[S];else if(this.set.length>1){for(const O of this.set)if(O.length===1&&I(O[0])){this.set=[O];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let f=0;f<this.set.length;f++){f>0&&(this.formatted+="||");const x=this.set[f];for(let S=0;S<x.length;S++)S>0&&(this.formatted+=" "),this.formatted+=x[S].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(f){const S=((this.options.includePrerelease&&E)|(this.options.loose&&v))+":"+f,O=a.get(S);if(O)return O;const C=this.options.loose,D=C?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];f=f.replace(D,T(this.options.includePrerelease)),o("hyphen replace",f),f=f.replace(l[u.COMPARATORTRIM],d),o("comparator trim",f),f=f.replace(l[u.TILDETRIM],h),o("tilde trim",f),f=f.replace(l[u.CARETTRIM],p),o("caret trim",f);let U=f.split(" ").map(ne=>w(ne,this.options)).join(" ").split(/\s+/).map(ne=>N(ne,this.options));C&&(U=U.filter(ne=>(o("loose invalid filter",ne,this.options),!!ne.match(l[u.COMPARATORLOOSE])))),o("range list",U);const F=new Map,X=U.map(ne=>new s(ne,this.options));for(const ne of X){if(b(ne))return[ne];F.set(ne.value,ne)}F.size>1&&F.has("")&&F.delete("");const oe=[...F.values()];return a.set(S,oe),oe}intersects(f,x){if(!(f instanceof e))throw new TypeError("a Range is required");return this.set.some(S=>y(S,x)&&f.set.some(O=>y(O,x)&&S.every(C=>O.every(D=>C.intersects(D,x)))))}test(f){if(!f)return!1;if(typeof f=="string")try{f=new c(f,this.options)}catch{return!1}for(let x=0;x<this.set.length;x++)if(g(this.set[x],f,this.options))return!0;return!1}}Va=e;const r=wd(),a=new r,n=Zn(),s=zr(),o=Ur(),c=xe(),{safeRe:l,t:u,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:p}=dr(),{FLAG_INCLUDE_PRERELEASE:E,FLAG_LOOSE:v}=Fr(),b=m=>m.value==="<0.0.0-0",I=m=>m.value==="",y=(m,f)=>{let x=!0;const S=m.slice();let O=S.pop();for(;x&&S.length;)x=S.every(C=>O.intersects(C,f)),O=S.pop();return x},w=(m,f)=>(o("comp",m,f),m=P(m,f),o("caret",m),m=k(m,f),o("tildes",m),m=L(m,f),o("xrange",m),m=V(m,f),o("stars",m),m),_=m=>!m||m.toLowerCase()==="x"||m==="*",k=(m,f)=>m.trim().split(/\s+/).map(x=>j(x,f)).join(" "),j=(m,f)=>{const x=f.loose?l[u.TILDELOOSE]:l[u.TILDE];return m.replace(x,(S,O,C,D,U)=>{o("tilde",m,S,O,C,D,U);let F;return _(O)?F="":_(C)?F=`>=${O}.0.0 <${+O+1}.0.0-0`:_(D)?F=`>=${O}.${C}.0 <${O}.${+C+1}.0-0`:U?(o("replaceTilde pr",U),F=`>=${O}.${C}.${D}-${U} <${O}.${+C+1}.0-0`):F=`>=${O}.${C}.${D} <${O}.${+C+1}.0-0`,o("tilde return",F),F})},P=(m,f)=>m.trim().split(/\s+/).map(x=>M(x,f)).join(" "),M=(m,f)=>{o("caret",m,f);const x=f.loose?l[u.CARETLOOSE]:l[u.CARET],S=f.includePrerelease?"-0":"";return m.replace(x,(O,C,D,U,F)=>{o("caret",m,O,C,D,U,F);let X;return _(C)?X="":_(D)?X=`>=${C}.0.0${S} <${+C+1}.0.0-0`:_(U)?C==="0"?X=`>=${C}.${D}.0${S} <${C}.${+D+1}.0-0`:X=`>=${C}.${D}.0${S} <${+C+1}.0.0-0`:F?(o("replaceCaret pr",F),C==="0"?D==="0"?X=`>=${C}.${D}.${U}-${F} <${C}.${D}.${+U+1}-0`:X=`>=${C}.${D}.${U}-${F} <${C}.${+D+1}.0-0`:X=`>=${C}.${D}.${U}-${F} <${+C+1}.0.0-0`):(o("no pr"),C==="0"?D==="0"?X=`>=${C}.${D}.${U}${S} <${C}.${D}.${+U+1}-0`:X=`>=${C}.${D}.${U}${S} <${C}.${+D+1}.0-0`:X=`>=${C}.${D}.${U} <${+C+1}.0.0-0`),o("caret return",X),X})},L=(m,f)=>(o("replaceXRanges",m,f),m.split(/\s+/).map(x=>z(x,f)).join(" ")),z=(m,f)=>{m=m.trim();const x=f.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return m.replace(x,(S,O,C,D,U,F)=>{o("xRange",m,S,O,C,D,U,F);const X=_(C),oe=X||_(D),ne=oe||_(U),ie=ne;return O==="="&&ie&&(O=""),F=f.includePrerelease?"-0":"",X?O===">"||O==="<"?S="<0.0.0-0":S="*":O&&ie?(oe&&(D=0),U=0,O===">"?(O=">=",oe?(C=+C+1,D=0,U=0):(D=+D+1,U=0)):O==="<="&&(O="<",oe?C=+C+1:D=+D+1),O==="<"&&(F="-0"),S=`${O+C}.${D}.${U}${F}`):oe?S=`>=${C}.0.0${F} <${+C+1}.0.0-0`:ne&&(S=`>=${C}.${D}.0${F} <${C}.${+D+1}.0-0`),o("xRange return",S),S})},V=(m,f)=>(o("replaceStars",m,f),m.trim().replace(l[u.STAR],"")),N=(m,f)=>(o("replaceGTE0",m,f),m.trim().replace(l[f.includePrerelease?u.GTE0PRE:u.GTE0],"")),T=m=>(f,x,S,O,C,D,U,F,X,oe,ne,ie)=>(_(S)?x="":_(O)?x=`>=${S}.0.0${m?"-0":""}`:_(C)?x=`>=${S}.${O}.0${m?"-0":""}`:D?x=`>=${x}`:x=`>=${x}${m?"-0":""}`,_(X)?F="":_(oe)?F=`<${+X+1}.0.0-0`:_(ne)?F=`<${X}.${+oe+1}.0-0`:ie?F=`<=${X}.${oe}.${ne}-${ie}`:m?F=`<${X}.${oe}.${+ne+1}-0`:F=`<=${F}`,`${x} ${F}`.trim()),g=(m,f,x)=>{for(let S=0;S<m.length;S++)if(!m[S].test(f))return!1;if(f.prerelease.length&&!x.includePrerelease){for(let S=0;S<m.length;S++)if(o(m[S].semver),m[S].semver!==s.ANY&&m[S].semver.prerelease.length>0){const O=m[S].semver;if(O.major===f.major&&O.minor===f.minor&&O.patch===f.patch)return!0}return!1}return!0};return Va}var Wa,bi;function zr(){if(bi)return Wa;bi=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(d,h){if(h=r(h),d instanceof e){if(d.loose===!!h.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),o("comparator",d,h),this.options=h,this.loose=!!h.loose,this.parse(d),this.semver===t?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(d){const h=this.options.loose?a[n.COMPARATORLOOSE]:a[n.COMPARATOR],p=d.match(h);if(!p)throw new TypeError(`Invalid comparator: ${d}`);this.operator=p[1]!==void 0?p[1]:"",this.operator==="="&&(this.operator=""),p[2]?this.semver=new c(p[2],this.options.loose):this.semver=t}toString(){return this.value}test(d){if(o("Comparator.test",d,this.options.loose),this.semver===t||d===t)return!0;if(typeof d=="string")try{d=new c(d,this.options)}catch{return!1}return s(d,this.operator,this.semver,this.options)}intersects(d,h){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(d.value,h).test(this.value):d.operator===""?d.value===""?!0:new l(this.value,h).test(d.semver):(h=r(h),h.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!h.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||s(this.semver,"<",d.semver,h)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||s(this.semver,">",d.semver,h)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}Wa=e;const r=Zn(),{safeRe:a,t:n}=dr(),s=pc(),o=Ur(),c=xe(),l=Ae();return Wa}var Za,vi;function Gr(){if(vi)return Za;vi=1;const t=Ae();return Za=(r,a,n)=>{try{a=new t(a,n)}catch{return!1}return a.test(r)},Za}var Ka,wi;function _d(){if(wi)return Ka;wi=1;const t=Ae();return Ka=(r,a)=>new t(r,a).set.map(n=>n.map(s=>s.value).join(" ").trim().split(" ")),Ka}var Ya,_i;function Ed(){if(_i)return Ya;_i=1;const t=xe(),e=Ae();return Ya=(a,n,s)=>{let o=null,c=null,l=null;try{l=new e(n,s)}catch{return null}return a.forEach(u=>{l.test(u)&&(!o||c.compare(u)===-1)&&(o=u,c=new t(o,s))}),o},Ya}var Ja,Ei;function Sd(){if(Ei)return Ja;Ei=1;const t=xe(),e=Ae();return Ja=(a,n,s)=>{let o=null,c=null,l=null;try{l=new e(n,s)}catch{return null}return a.forEach(u=>{l.test(u)&&(!o||c.compare(u)===1)&&(o=u,c=new t(o,s))}),o},Ja}var Xa,Si;function Nd(){if(Si)return Xa;Si=1;const t=xe(),e=Ae(),r=Hr();return Xa=(n,s)=>{n=new e(n,s);let o=new t("0.0.0");if(n.test(o)||(o=new t("0.0.0-0"),n.test(o)))return o;o=null;for(let c=0;c<n.set.length;++c){const l=n.set[c];let u=null;l.forEach(d=>{const h=new t(d.semver.version);switch(d.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!u||r(h,u))&&(u=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),u&&(!o||r(o,u))&&(o=u)}return o&&n.test(o)?o:null},Xa}var Qa,Ni;function Td(){if(Ni)return Qa;Ni=1;const t=Ae();return Qa=(r,a)=>{try{return new t(r,a).range||"*"}catch{return null}},Qa}var en,Ti;function Qn(){if(Ti)return en;Ti=1;const t=xe(),e=zr(),{ANY:r}=e,a=Ae(),n=Gr(),s=Hr(),o=Yn(),c=Xn(),l=Jn();return en=(d,h,p,E)=>{d=new t(d,E),h=new a(h,E);let v,b,I,y,w;switch(p){case">":v=s,b=c,I=o,y=">",w=">=";break;case"<":v=o,b=l,I=s,y="<",w="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(n(d,h,E))return!1;for(let _=0;_<h.set.length;++_){const k=h.set[_];let j=null,P=null;if(k.forEach(M=>{M.semver===r&&(M=new e(">=0.0.0")),j=j||M,P=P||M,v(M.semver,j.semver,E)?j=M:I(M.semver,P.semver,E)&&(P=M)}),j.operator===y||j.operator===w||(!P.operator||P.operator===y)&&b(d,P.semver))return!1;if(P.operator===w&&I(d,P.semver))return!1}return!0},en}var tn,ki;function kd(){if(ki)return tn;ki=1;const t=Qn();return tn=(r,a,n)=>t(r,a,">",n),tn}var rn,Ii;function Id(){if(Ii)return rn;Ii=1;const t=Qn();return rn=(r,a,n)=>t(r,a,"<",n),rn}var an,Ri;function Rd(){if(Ri)return an;Ri=1;const t=Ae();return an=(r,a,n)=>(r=new t(r,n),a=new t(a,n),r.intersects(a,n)),an}var nn,Ai;function Ad(){if(Ai)return nn;Ai=1;const t=Gr(),e=Re();return nn=(r,a,n)=>{const s=[];let o=null,c=null;const l=r.sort((p,E)=>e(p,E,n));for(const p of l)t(p,a,n)?(c=p,o||(o=p)):(c&&s.push([o,c]),c=null,o=null);o&&s.push([o,null]);const u=[];for(const[p,E]of s)p===E?u.push(p):!E&&p===l[0]?u.push("*"):E?p===l[0]?u.push(`<=${E}`):u.push(`${p} - ${E}`):u.push(`>=${p}`);const d=u.join(" || "),h=typeof a.raw=="string"?a.raw:String(a);return d.length<h.length?d:a},nn}var sn,Ci;function Cd(){if(Ci)return sn;Ci=1;const t=Ae(),e=zr(),{ANY:r}=e,a=Gr(),n=Re(),s=(h,p,E={})=>{if(h===p)return!0;h=new t(h,E),p=new t(p,E);let v=!1;e:for(const b of h.set){for(const I of p.set){const y=l(b,I,E);if(v=v||y!==null,y)continue e}if(v)return!1}return!0},o=[new e(">=0.0.0-0")],c=[new e(">=0.0.0")],l=(h,p,E)=>{if(h===p)return!0;if(h.length===1&&h[0].semver===r){if(p.length===1&&p[0].semver===r)return!0;E.includePrerelease?h=o:h=c}if(p.length===1&&p[0].semver===r){if(E.includePrerelease)return!0;p=c}const v=new Set;let b,I;for(const L of h)L.operator===">"||L.operator===">="?b=u(b,L,E):L.operator==="<"||L.operator==="<="?I=d(I,L,E):v.add(L.semver);if(v.size>1)return null;let y;if(b&&I){if(y=n(b.semver,I.semver,E),y>0)return null;if(y===0&&(b.operator!==">="||I.operator!=="<="))return null}for(const L of v){if(b&&!a(L,String(b),E)||I&&!a(L,String(I),E))return null;for(const z of p)if(!a(L,String(z),E))return!1;return!0}let w,_,k,j,P=I&&!E.includePrerelease&&I.semver.prerelease.length?I.semver:!1,M=b&&!E.includePrerelease&&b.semver.prerelease.length?b.semver:!1;P&&P.prerelease.length===1&&I.operator==="<"&&P.prerelease[0]===0&&(P=!1);for(const L of p){if(j=j||L.operator===">"||L.operator===">=",k=k||L.operator==="<"||L.operator==="<=",b){if(M&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===M.major&&L.semver.minor===M.minor&&L.semver.patch===M.patch&&(M=!1),L.operator===">"||L.operator===">="){if(w=u(b,L,E),w===L&&w!==b)return!1}else if(b.operator===">="&&!a(b.semver,String(L),E))return!1}if(I){if(P&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===P.major&&L.semver.minor===P.minor&&L.semver.patch===P.patch&&(P=!1),L.operator==="<"||L.operator==="<="){if(_=d(I,L,E),_===L&&_!==I)return!1}else if(I.operator==="<="&&!a(I.semver,String(L),E))return!1}if(!L.operator&&(I||b)&&y!==0)return!1}return!(b&&k&&!I&&y!==0||I&&j&&!b&&y!==0||M||P)},u=(h,p,E)=>{if(!h)return p;const v=n(h.semver,p.semver,E);return v>0?h:v<0||p.operator===">"&&h.operator===">="?p:h},d=(h,p,E)=>{if(!h)return p;const v=n(h.semver,p.semver,E);return v<0?h:v>0||p.operator==="<"&&h.operator==="<="?p:h};return sn=s,sn}var on,Li;function es(){if(Li)return on;Li=1;const t=dr(),e=Fr(),r=xe(),a=fc(),n=Mt(),s=cd(),o=ld(),c=dd(),l=ud(),u=fd(),d=hd(),h=md(),p=pd(),E=Re(),v=gd(),b=xd(),I=Kn(),y=yd(),w=bd(),_=Hr(),k=Yn(),j=hc(),P=mc(),M=Jn(),L=Xn(),z=pc(),V=vd(),N=zr(),T=Ae(),g=Gr(),m=_d(),f=Ed(),x=Sd(),S=Nd(),O=Td(),C=Qn(),D=kd(),U=Id(),F=Rd(),X=Ad(),oe=Cd();return on={parse:n,valid:s,clean:o,inc:c,diff:l,major:u,minor:d,patch:h,prerelease:p,compare:E,rcompare:v,compareLoose:b,compareBuild:I,sort:y,rsort:w,gt:_,lt:k,eq:j,neq:P,gte:M,lte:L,cmp:z,coerce:V,Comparator:N,Range:T,satisfies:g,toComparators:m,maxSatisfying:f,minSatisfying:x,minVersion:S,validRange:O,outside:C,gtr:D,ltr:U,intersects:F,simplifyRange:X,subset:oe,SemVer:r,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:a.compareIdentifiers,rcompareIdentifiers:a.rcompareIdentifiers},on}var cn,Pi;function Ld(){return Pi||(Pi=1,cn=es().satisfies(process.version,">=15.7.0")),cn}var ln,Oi;function Pd(){return Oi||(Oi=1,ln=es().satisfies(process.version,">=16.9.0")),ln}var dn,$i;function gc(){if($i)return dn;$i=1;const t=Ld(),e=Pd(),r={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},a={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};return dn=function(n,s){if(!n||!s)return;const o=s.asymmetricKeyType;if(!o)return;const c=r[o];if(!c)throw new Error(`Unknown key type "${o}".`);if(!c.includes(n))throw new Error(`"alg" parameter for "${o}" key type must be one of: ${c.join(", ")}.`);if(t)switch(o){case"ec":const l=s.asymmetricKeyDetails.namedCurve,u=a[n];if(l!==u)throw new Error(`"alg" parameter "${n}" requires curve "${u}".`);break;case"rsa-pss":if(e){const d=parseInt(n.slice(-3),10),{hashAlgorithm:h,mgf1HashAlgorithm:p,saltLength:E}=s.asymmetricKeyDetails;if(h!==`sha${d}`||p!==h)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${n}.`);if(E!==void 0&&E>d>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${n}.`)}break}},dn}var un,ji;function xc(){if(ji)return un;ji=1;var t=es();return un=t.satisfies(process.version,"^6.12.0 || >=8.0.0"),un}var fn,Di;function Od(){if(Di)return fn;Di=1;const t=qr(),e=lc(),r=dc(),a=cc(),n=uc(),s=gc(),o=xc(),c=Wn(),{KeyObject:l,createSecretKey:u,createPublicKey:d}=Bn,h=["RS256","RS384","RS512"],p=["ES256","ES384","ES512"],E=["RS256","RS384","RS512"],v=["HS256","HS384","HS512"];return o&&(h.splice(h.length,0,"PS256","PS384","PS512"),E.splice(E.length,0,"PS256","PS384","PS512")),fn=function(b,I,y,w){typeof y=="function"&&!w&&(w=y,y={}),y||(y={}),y=Object.assign({},y);let _;if(w?_=w:_=function(z,V){if(z)throw z;return V},y.clockTimestamp&&typeof y.clockTimestamp!="number")return _(new t("clockTimestamp must be a number"));if(y.nonce!==void 0&&(typeof y.nonce!="string"||y.nonce.trim()===""))return _(new t("nonce must be a non-empty string"));if(y.allowInvalidAsymmetricKeyTypes!==void 0&&typeof y.allowInvalidAsymmetricKeyTypes!="boolean")return _(new t("allowInvalidAsymmetricKeyTypes must be a boolean"));const k=y.clockTimestamp||Math.floor(Date.now()/1e3);if(!b)return _(new t("jwt must be provided"));if(typeof b!="string")return _(new t("jwt must be a string"));const j=b.split(".");if(j.length!==3)return _(new t("jwt malformed"));let P;try{P=a(b,{complete:!0})}catch(z){return _(z)}if(!P)return _(new t("invalid token"));const M=P.header;let L;if(typeof I=="function"){if(!w)return _(new t("verify must be called asynchronous if secret or public key is provided as a callback"));L=I}else L=function(z,V){return V(null,I)};return L(M,function(z,V){if(z)return _(new t("error in secret or public key callback: "+z.message));const N=j[2].trim()!=="";if(!N&&V)return _(new t("jwt signature is required"));if(N&&!V)return _(new t("secret or public key must be provided"));if(!N&&!y.algorithms)return _(new t('please specify "none" in "algorithms" to verify unsigned tokens'));if(V!=null&&!(V instanceof l))try{V=d(V)}catch{try{V=u(typeof V=="string"?Buffer.from(V):V)}catch{return _(new t("secretOrPublicKey is not valid key material"))}}if(y.algorithms||(V.type==="secret"?y.algorithms=v:["rsa","rsa-pss"].includes(V.asymmetricKeyType)?y.algorithms=E:V.asymmetricKeyType==="ec"?y.algorithms=p:y.algorithms=h),y.algorithms.indexOf(P.header.alg)===-1)return _(new t("invalid algorithm"));if(M.alg.startsWith("HS")&&V.type!=="secret")return _(new t(`secretOrPublicKey must be a symmetric key when using ${M.alg}`));if(/^(?:RS|PS|ES)/.test(M.alg)&&V.type!=="public")return _(new t(`secretOrPublicKey must be an asymmetric key when using ${M.alg}`));if(!y.allowInvalidAsymmetricKeyTypes)try{s(M.alg,V)}catch(m){return _(m)}let T;try{T=c.verify(b,P.header.alg,V)}catch(m){return _(m)}if(!T)return _(new t("invalid signature"));const g=P.payload;if(typeof g.nbf<"u"&&!y.ignoreNotBefore){if(typeof g.nbf!="number")return _(new t("invalid nbf value"));if(g.nbf>k+(y.clockTolerance||0))return _(new e("jwt not active",new Date(g.nbf*1e3)))}if(typeof g.exp<"u"&&!y.ignoreExpiration){if(typeof g.exp!="number")return _(new t("invalid exp value"));if(k>=g.exp+(y.clockTolerance||0))return _(new r("jwt expired",new Date(g.exp*1e3)))}if(y.audience){const m=Array.isArray(y.audience)?y.audience:[y.audience];if(!(Array.isArray(g.aud)?g.aud:[g.aud]).some(function(S){return m.some(function(O){return O instanceof RegExp?O.test(S):O===S})}))return _(new t("jwt audience invalid. expected: "+m.join(" or ")))}if(y.issuer&&(typeof y.issuer=="string"&&g.iss!==y.issuer||Array.isArray(y.issuer)&&y.issuer.indexOf(g.iss)===-1))return _(new t("jwt issuer invalid. expected: "+y.issuer));if(y.subject&&g.sub!==y.subject)return _(new t("jwt subject invalid. expected: "+y.subject));if(y.jwtid&&g.jti!==y.jwtid)return _(new t("jwt jwtid invalid. expected: "+y.jwtid));if(y.nonce&&g.nonce!==y.nonce)return _(new t("jwt nonce invalid. expected: "+y.nonce));if(y.maxAge){if(typeof g.iat!="number")return _(new t("iat required when maxAge is specified"));const m=n(y.maxAge,g.iat);if(typeof m>"u")return _(new t('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(k>=m+(y.clockTolerance||0))return _(new r("maxAge exceeded",new Date(m*1e3)))}if(y.complete===!0){const m=P.signature;return _(null,{header:M,payload:g,signature:m})}return _(null,g)})},fn}var hn,Mi;function $d(){if(Mi)return hn;Mi=1;var t=1/0,e=9007199254740991,r=17976931348623157e292,a=NaN,n="[object Arguments]",s="[object Function]",o="[object GeneratorFunction]",c="[object String]",l="[object Symbol]",u=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,p=/^0o[0-7]+$/i,E=/^(?:0|[1-9]\d*)$/,v=parseInt;function b(R,W){for(var J=-1,pe=R?R.length:0,we=Array(pe);++J<pe;)we[J]=W(R[J],J,R);return we}function I(R,W,J,pe){for(var we=R.length,Le=J+-1;++Le<we;)if(W(R[Le],Le,R))return Le;return-1}function y(R,W,J){if(W!==W)return I(R,w,J);for(var pe=J-1,we=R.length;++pe<we;)if(R[pe]===W)return pe;return-1}function w(R){return R!==R}function _(R,W){for(var J=-1,pe=Array(R);++J<R;)pe[J]=W(J);return pe}function k(R,W){return b(W,function(J){return R[J]})}function j(R,W){return function(J){return R(W(J))}}var P=Object.prototype,M=P.hasOwnProperty,L=P.toString,z=P.propertyIsEnumerable,V=j(Object.keys,Object),N=Math.max;function T(R,W){var J=O(R)||S(R)?_(R.length,String):[],pe=J.length,we=!!pe;for(var Le in R)M.call(R,Le)&&!(we&&(Le=="length"||m(Le,pe)))&&J.push(Le);return J}function g(R){if(!f(R))return V(R);var W=[];for(var J in Object(R))M.call(R,J)&&J!="constructor"&&W.push(J);return W}function m(R,W){return W=W??e,!!W&&(typeof R=="number"||E.test(R))&&R>-1&&R%1==0&&R<W}function f(R){var W=R&&R.constructor,J=typeof W=="function"&&W.prototype||P;return R===J}function x(R,W,J,pe){R=C(R)?R:Cc(R),J=J&&!pe?Ic(J):0;var we=R.length;return J<0&&(J=N(we+J,0)),ne(R)?J<=we&&R.indexOf(W,J)>-1:!!we&&y(R,W,J)>-1}function S(R){return D(R)&&M.call(R,"callee")&&(!z.call(R,"callee")||L.call(R)==n)}var O=Array.isArray;function C(R){return R!=null&&F(R.length)&&!U(R)}function D(R){return oe(R)&&C(R)}function U(R){var W=X(R)?L.call(R):"";return W==s||W==o}function F(R){return typeof R=="number"&&R>-1&&R%1==0&&R<=e}function X(R){var W=typeof R;return!!R&&(W=="object"||W=="function")}function oe(R){return!!R&&typeof R=="object"}function ne(R){return typeof R=="string"||!O(R)&&oe(R)&&L.call(R)==c}function ie(R){return typeof R=="symbol"||oe(R)&&L.call(R)==l}function kc(R){if(!R)return R===0?R:0;if(R=Rc(R),R===t||R===-t){var W=R<0?-1:1;return W*r}return R===R?R:0}function Ic(R){var W=kc(R),J=W%1;return W===W?J?W-J:W:0}function Rc(R){if(typeof R=="number")return R;if(ie(R))return a;if(X(R)){var W=typeof R.valueOf=="function"?R.valueOf():R;R=X(W)?W+"":W}if(typeof R!="string")return R===0?R:+R;R=R.replace(u,"");var J=h.test(R);return J||p.test(R)?v(R.slice(2),J?2:8):d.test(R)?a:+R}function Ac(R){return C(R)?T(R):g(R)}function Cc(R){return R?k(R,Ac(R)):[]}return hn=x,hn}var mn,Bi;function jd(){if(Bi)return mn;Bi=1;var t="[object Boolean]",e=Object.prototype,r=e.toString;function a(s){return s===!0||s===!1||n(s)&&r.call(s)==t}function n(s){return!!s&&typeof s=="object"}return mn=a,mn}var pn,qi;function Dd(){if(qi)return pn;qi=1;var t=1/0,e=17976931348623157e292,r=NaN,a="[object Symbol]",n=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,u=Object.prototype,d=u.toString;function h(w){return typeof w=="number"&&w==I(w)}function p(w){var _=typeof w;return!!w&&(_=="object"||_=="function")}function E(w){return!!w&&typeof w=="object"}function v(w){return typeof w=="symbol"||E(w)&&d.call(w)==a}function b(w){if(!w)return w===0?w:0;if(w=y(w),w===t||w===-t){var _=w<0?-1:1;return _*e}return w===w?w:0}function I(w){var _=b(w),k=_%1;return _===_?k?_-k:_:0}function y(w){if(typeof w=="number")return w;if(v(w))return r;if(p(w)){var _=typeof w.valueOf=="function"?w.valueOf():w;w=p(_)?_+"":_}if(typeof w!="string")return w===0?w:+w;w=w.replace(n,"");var k=o.test(w);return k||c.test(w)?l(w.slice(2),k?2:8):s.test(w)?r:+w}return pn=h,pn}var gn,Fi;function Md(){if(Fi)return gn;Fi=1;var t="[object Number]",e=Object.prototype,r=e.toString;function a(s){return!!s&&typeof s=="object"}function n(s){return typeof s=="number"||a(s)&&r.call(s)==t}return gn=n,gn}var xn,Ui;function Bd(){if(Ui)return xn;Ui=1;var t="[object Object]";function e(p){var E=!1;if(p!=null&&typeof p.toString!="function")try{E=!!(p+"")}catch{}return E}function r(p,E){return function(v){return p(E(v))}}var a=Function.prototype,n=Object.prototype,s=a.toString,o=n.hasOwnProperty,c=s.call(Object),l=n.toString,u=r(Object.getPrototypeOf,Object);function d(p){return!!p&&typeof p=="object"}function h(p){if(!d(p)||l.call(p)!=t||e(p))return!1;var E=u(p);if(E===null)return!0;var v=o.call(E,"constructor")&&E.constructor;return typeof v=="function"&&v instanceof v&&s.call(v)==c}return xn=h,xn}var yn,Hi;function qd(){if(Hi)return yn;Hi=1;var t="[object String]",e=Object.prototype,r=e.toString,a=Array.isArray;function n(o){return!!o&&typeof o=="object"}function s(o){return typeof o=="string"||!a(o)&&n(o)&&r.call(o)==t}return yn=s,yn}var bn,zi;function Fd(){if(zi)return bn;zi=1;var t="Expected a function",e=1/0,r=17976931348623157e292,a=NaN,n="[object Symbol]",s=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt,d=Object.prototype,h=d.toString;function p(k,j){var P;if(typeof j!="function")throw new TypeError(t);return k=w(k),function(){return--k>0&&(P=j.apply(this,arguments)),k<=1&&(j=void 0),P}}function E(k){return p(2,k)}function v(k){var j=typeof k;return!!k&&(j=="object"||j=="function")}function b(k){return!!k&&typeof k=="object"}function I(k){return typeof k=="symbol"||b(k)&&h.call(k)==n}function y(k){if(!k)return k===0?k:0;if(k=_(k),k===e||k===-e){var j=k<0?-1:1;return j*r}return k===k?k:0}function w(k){var j=y(k),P=j%1;return j===j?P?j-P:j:0}function _(k){if(typeof k=="number")return k;if(I(k))return a;if(v(k)){var j=typeof k.valueOf=="function"?k.valueOf():k;k=v(j)?j+"":j}if(typeof k!="string")return k===0?k:+k;k=k.replace(s,"");var P=c.test(k);return P||l.test(k)?u(k.slice(2),P?2:8):o.test(k)?a:+k}return bn=E,bn}var vn,Gi;function Ud(){if(Gi)return vn;Gi=1;const t=uc(),e=xc(),r=gc(),a=Wn(),n=$d(),s=jd(),o=Dd(),c=Md(),l=Bd(),u=qd(),d=Fd(),{KeyObject:h,createSecretKey:p,createPrivateKey:E}=Bn,v=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];e&&v.splice(3,0,"PS256","PS384","PS512");const b={expiresIn:{isValid:function(P){return o(P)||u(P)&&P},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(P){return o(P)||u(P)&&P},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(P){return u(P)||Array.isArray(P)},message:'"audience" must be a string or array'},algorithm:{isValid:n.bind(null,v),message:'"algorithm" must be a valid string enum value'},header:{isValid:l,message:'"header" must be an object'},encoding:{isValid:u,message:'"encoding" must be a string'},issuer:{isValid:u,message:'"issuer" must be a string'},subject:{isValid:u,message:'"subject" must be a string'},jwtid:{isValid:u,message:'"jwtid" must be a string'},noTimestamp:{isValid:s,message:'"noTimestamp" must be a boolean'},keyid:{isValid:u,message:'"keyid" must be a string'},mutatePayload:{isValid:s,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:s,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:s,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},I={iat:{isValid:c,message:'"iat" should be a number of seconds'},exp:{isValid:c,message:'"exp" should be a number of seconds'},nbf:{isValid:c,message:'"nbf" should be a number of seconds'}};function y(P,M,L,z){if(!l(L))throw new Error('Expected "'+z+'" to be a plain object.');Object.keys(L).forEach(function(V){const N=P[V];if(!N){if(!M)throw new Error('"'+V+'" is not allowed in "'+z+'"');return}if(!N.isValid(L[V]))throw new Error(N.message)})}function w(P){return y(b,!1,P,"options")}function _(P){return y(I,!0,P,"payload")}const k={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},j=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];return vn=function(P,M,L,z){typeof L=="function"?(z=L,L={}):L=L||{};const V=typeof P=="object"&&!Buffer.isBuffer(P),N=Object.assign({alg:L.algorithm||"HS256",typ:V?"JWT":void 0,kid:L.keyid},L.header);function T(f){if(z)return z(f);throw f}if(!M&&L.algorithm!=="none")return T(new Error("secretOrPrivateKey must have a value"));if(M!=null&&!(M instanceof h))try{M=E(M)}catch{try{M=p(typeof M=="string"?Buffer.from(M):M)}catch{return T(new Error("secretOrPrivateKey is not valid key material"))}}if(N.alg.startsWith("HS")&&M.type!=="secret")return T(new Error(`secretOrPrivateKey must be a symmetric key when using ${N.alg}`));if(/^(?:RS|PS|ES)/.test(N.alg)){if(M.type!=="private")return T(new Error(`secretOrPrivateKey must be an asymmetric key when using ${N.alg}`));if(!L.allowInsecureKeySizes&&!N.alg.startsWith("ES")&&M.asymmetricKeyDetails!==void 0&&M.asymmetricKeyDetails.modulusLength<2048)return T(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${N.alg}`))}if(typeof P>"u")return T(new Error("payload is required"));if(V){try{_(P)}catch(f){return T(f)}L.mutatePayload||(P=Object.assign({},P))}else{const f=j.filter(function(x){return typeof L[x]<"u"});if(f.length>0)return T(new Error("invalid "+f.join(",")+" option for "+typeof P+" payload"))}if(typeof P.exp<"u"&&typeof L.expiresIn<"u")return T(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(typeof P.nbf<"u"&&typeof L.notBefore<"u")return T(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{w(L)}catch(f){return T(f)}if(!L.allowInvalidAsymmetricKeyTypes)try{r(N.alg,M)}catch(f){return T(f)}const g=P.iat||Math.floor(Date.now()/1e3);if(L.noTimestamp?delete P.iat:V&&(P.iat=g),typeof L.notBefore<"u"){try{P.nbf=t(L.notBefore,g)}catch(f){return T(f)}if(typeof P.nbf>"u")return T(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(typeof L.expiresIn<"u"&&typeof P=="object"){try{P.exp=t(L.expiresIn,g)}catch(f){return T(f)}if(typeof P.exp>"u")return T(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(k).forEach(function(f){const x=k[f];if(typeof L[f]<"u"){if(typeof P[x]<"u")return T(new Error('Bad "options.'+f+'" option. The payload already has an "'+x+'" property.'));P[x]=L[f]}});const m=L.encoding||"utf8";if(typeof z=="function")z=z&&d(z),a.createSign({header:N,privateKey:M,payload:P,encoding:m}).once("error",z).once("done",function(f){if(!L.allowInsecureKeySizes&&/^(?:RS|PS)/.test(N.alg)&&f.length<256)return z(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${N.alg}`));z(null,f)});else{let f=a.sign({header:N,payload:P,secret:M,encoding:m});if(!L.allowInsecureKeySizes&&/^(?:RS|PS)/.test(N.alg)&&f.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${N.alg}`);return f}},vn}var wn,Vi;function Hd(){return Vi||(Vi=1,wn={decode:cc(),verify:Od(),sign:Ud(),JsonWebTokenError:qr(),NotBeforeError:lc(),TokenExpiredError:dc()}),wn}var yc=Hd();const ts=ac(yc),zd=wo({__proto__:null,default:ts},[yc]);class Vr{constructor(e){G(this,"db");this.db=e}async createUser(e){const r=await Cn.hash(e.password,10),a=await this.db.prepare(`
      INSERT INTO users (email, password_hash, full_name, phone, language, currency)
      VALUES (?, ?, ?, ?, ?, ?)
      RETURNING *
    `).bind(e.email,r,e.full_name,e.phone||null,e.language||"en",e.currency||"EUR").first();if(!a)throw new Error("Failed to create user");return await this.db.prepare(`
      INSERT INTO credits (user_id, balance) VALUES (?, 0.0)
    `).bind(a.id).run(),a}async getUserByEmail(e){return await this.db.prepare(`
      SELECT * FROM users WHERE email = ?
    `).bind(e).first()}async getUserById(e){return await this.db.prepare(`
      SELECT * FROM users WHERE id = ?
    `).bind(e).first()}async verifyPassword(e,r){return await Cn.compare(e,r)}async getUserCredits(e){const r=await this.db.prepare(`
      SELECT balance FROM credits WHERE user_id = ?
    `).bind(e).first();return(r==null?void 0:r.balance)||0}async addCredits(e,r){await this.db.prepare(`
      UPDATE credits 
      SET balance = balance + ?, updated_at = CURRENT_TIMESTAMP
      WHERE user_id = ?
    `).bind(r,e).run()}async deductCredits(e,r){return(await this.db.prepare(`
      UPDATE credits 
      SET balance = balance - ?, updated_at = CURRENT_TIMESTAMP
      WHERE user_id = ? AND balance >= ?
    `).bind(r,e,r).run()).changes>0}async createTransaction(e){const r=await this.db.prepare(`
      INSERT INTO transactions (user_id, amount_eur, amount_currency, currency, rate_used, rates_timestamp, tx_id)
      VALUES (?, ?, ?, ?, ?, ?, ?)
      RETURNING *
    `).bind(e.user_id,e.amount_eur,e.amount_currency,e.currency,e.rate_used,e.rates_timestamp,e.tx_id).first();if(!r)throw new Error("Failed to create transaction");return r}async updateTransactionStatus(e,r,a){await this.db.prepare(`
      UPDATE transactions 
      SET status = ?, gateway_response = ?, updated_at = CURRENT_TIMESTAMP
      WHERE tx_id = ?
    `).bind(r,a||null,e).run()}async getUserTransactions(e,r=50){return(await this.db.prepare(`
      SELECT * FROM transactions 
      WHERE user_id = ? 
      ORDER BY created_at DESC 
      LIMIT ?
    `).bind(e,r).all()).results}async createGenerationLog(e){const r=await this.db.prepare(`
      INSERT INTO generation_logs (user_id, service_type, params, base_cost, modifiers, total_cost, result_id, status)
      VALUES (?, ?, ?, ?, ?, ?, ?, 'pending')
      RETURNING *
    `).bind(e.user_id,e.service_type,e.params||null,e.base_cost,e.modifiers||null,e.total_cost,e.result_id||null).first();if(!r)throw new Error("Failed to create generation log");return r}async updateGenerationLogStatus(e,r,a){await this.db.prepare(`
      UPDATE generation_logs 
      SET status = ?, result_id = ?
      WHERE id = ?
    `).bind(r,a||null,e).run()}async getUserGenerations(e,r=50){return(await this.db.prepare(`
      SELECT * FROM generation_logs 
      WHERE user_id = ? 
      ORDER BY created_at DESC 
      LIMIT ?
    `).bind(e,r).all()).results}async saveContent(e){const r=await this.db.prepare(`
      INSERT INTO content_library (user_id, content_type, title, content, meta)
      VALUES (?, ?, ?, ?, ?)
      RETURNING *
    `).bind(e.user_id,e.content_type,e.title,e.content,e.meta||null).first();if(!r)throw new Error("Failed to save content");return r}async getUserContent(e,r){let a=`
      SELECT * FROM content_library 
      WHERE user_id = ?
    `;const n=[e];return r&&(a+=" AND content_type = ?",n.push(r)),a+=" ORDER BY created_at DESC",(await this.db.prepare(a).bind(...n).all()).results}async createSupportTicket(e){return await this.db.prepare(`
      INSERT INTO support_tickets (user_id, full_name, email, company, phone, message)
      VALUES (?, ?, ?, ?, ?, ?)
    `).bind(e.user_id||null,e.full_name,e.email,e.company||null,e.phone||null,e.message).run()}async updateRatesCache(e,r){await this.db.prepare(`
      INSERT INTO rates_cache (rates_data, rates_timestamp)
      VALUES (?, ?)
    `).bind(e,r).run()}async getLatestRates(){return await this.db.prepare(`
      SELECT rates_data, rates_timestamp 
      FROM rates_cache 
      ORDER BY rates_timestamp DESC 
      LIMIT 1
    `).first()}async createResetToken(e,r,a){await this.db.prepare(`
      INSERT INTO reset_tokens (user_id, token, expires_at)
      VALUES (?, ?, ?)
    `).bind(e,r,a).run()}async verifyResetToken(e){return await this.db.prepare(`
      SELECT user_id, expires_at 
      FROM reset_tokens 
      WHERE token = ? AND used = FALSE
    `).bind(e).first()}async markResetTokenUsed(e){await this.db.prepare(`
      UPDATE reset_tokens SET used = TRUE WHERE token = ?
    `).bind(e).run()}}function rs(t,e){return ts.sign({userId:t,iat:Math.floor(Date.now()/1e3)},e,{expiresIn:"7d"})}function bc(t,e){try{return ts.verify(t,e)}catch{return null}}function vc(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}const Gd=Object.freeze(Object.defineProperty({__proto__:null,DatabaseService:Vr,generateRandomToken:vc,generateToken:rs,verifyToken:bc},Symbol.toStringTag,{value:"Module"}));var Vd={};async function tt(t,e){var r;try{const a=t.req.header("Authorization");if(!a||!a.startsWith("Bearer "))return t.json({error:"No authorization token provided"},401);const n=a.substring(7),s=((r=t.env)==null?void 0:r.JWT_SECRET)||Vd.JWT_SECRET||"demo_jwt_secret_astroluna_2024",o=bc(n,s);if(!o)return t.json({error:"Invalid or expired token"},401);t.set("userId",o.userId),await e()}catch(a){return console.error("Auth middleware error:",a),t.json({error:"Authentication failed"},401)}}async function Wd(t,e){if(t.req.method==="OPTIONS")return new Response(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Max-Age":"86400"}});t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.header("Access-Control-Allow-Headers","Content-Type, Authorization"),await e()}function Fe(t){return t.get("userId")}async function as(t,e){const r=Fe(t);if(!r)throw new Error("User not authenticated");let a;if(t.env.DB)try{await t.env.DB.prepare("SELECT COUNT(*) FROM users LIMIT 1").first();const{DatabaseService:s}=await Promise.resolve().then(()=>Gd);a=new s(t.env.DB)}catch{const{MockDatabaseService:o}=await Promise.resolve().then(()=>lo);await o.initialize(),a=new o}else{const{MockDatabaseService:s}=await Promise.resolve().then(()=>lo);await s.initialize(),a=new s}const n=await a.getUserCredits(r);return{hasCredits:n>=e,currentBalance:n}}const Ut=new Map;function Zd(t=100,e=900*1e3){return async(r,a)=>{const n=r.req.header("CF-Connecting-IP")||r.req.header("X-Forwarded-For")||"unknown",s=Date.now();for(const[c,l]of Ut.entries())s>l.resetTime&&Ut.delete(c);const o=Ut.get(n);if(!o)Ut.set(n,{count:1,resetTime:s+e});else if(s>o.resetTime)Ut.set(n,{count:1,resetTime:s+e});else{if(o.count>=t)return r.json({error:"Too many requests. Please try again later."},429);o.count++}await a()}}var Kd=/^[\w!#$%&'*.^`|~+-]+$/,Yd=/^[ !#-:<-[\]-~]*$/,Jd=(t,e)=>{const r=t.trim().split(";"),a={};for(let n of r){n=n.trim();const s=n.indexOf("=");if(s===-1)continue;const o=n.substring(0,s).trim();if(!Kd.test(o))continue;let c=n.substring(s+1).trim();c.startsWith('"')&&c.endsWith('"')&&(c=c.slice(1,-1)),Yd.test(c)&&(a[o]=c.indexOf("%")!==-1?Br(c,zn):c)}return a},Xd=(t,e,r)=>{const a=t.req.raw.headers.get("Cookie");return a?Jd(a):{}},Wi=class extends Error{constructor(e=500,r){super(r==null?void 0:r.message,{cause:r==null?void 0:r.cause});G(this,"res");G(this,"status");this.res=r==null?void 0:r.res,this.status=e}getResponse(){return this.res?new Response(this.res.body,{status:this.status,headers:this.res.headers}):new Response(this.message,{status:this.status})}},Qd=(t,e)=>new Response(t,{headers:{"Content-Type":e}}).formData(),eu=/^application\/([a-z-\.]+\+)?json(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,tu=/^multipart\/form-data(;\s?boundary=[a-zA-Z0-9'"()+_,\-./:=?]+)?$/,ru=/^application\/x-www-form-urlencoded(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,au=(t,e)=>async(r,a)=>{let n={};const s=r.req.header("Content-Type");switch(t){case"json":if(!s||!eu.test(s))break;try{n=await r.req.json()}catch{const c="Malformed JSON in request body";throw new Wi(400,{message:c})}break;case"form":{if(!s||!(tu.test(s)||ru.test(s)))break;let c;if(r.req.bodyCache.formData)c=await r.req.bodyCache.formData;else try{const u=await r.req.arrayBuffer();c=await Qd(u,s),r.req.bodyCache.formData=c}catch(u){let d="Malformed FormData request.";throw d+=u instanceof Error?` ${u.message}`:` ${String(u)}`,new Wi(400,{message:d})}const l={};c.forEach((u,d)=>{d.endsWith("[]")?(l[d]??(l[d]=[])).push(u):Array.isArray(l[d])?l[d].push(u):d in l?l[d]=[l[d],u]:l[d]=u}),n=l;break}case"query":n=Object.fromEntries(Object.entries(r.req.queries()).map(([c,l])=>l.length===1?[c,l[0]]:[c,l]));break;case"param":n=r.req.param();break;case"header":n=r.req.header();break;case"cookie":n=Xd(r);break}const o=await e(n,r);if(o instanceof Response)return o;r.req.addValidatedData(t,o),await a()},re;(function(t){t.assertEqual=n=>{};function e(n){}t.assertIs=e;function r(n){throw new Error}t.assertNever=r,t.arrayToEnum=n=>{const s={};for(const o of n)s[o]=o;return s},t.getValidEnumValues=n=>{const s=t.objectKeys(n).filter(c=>typeof n[n[c]]!="number"),o={};for(const c of s)o[c]=n[c];return t.objectValues(o)},t.objectValues=n=>t.objectKeys(n).map(function(s){return n[s]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const s=[];for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&s.push(o);return s},t.find=(n,s)=>{for(const o of n)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function a(n,s=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=a,t.jsonStringifyReplacer=(n,s)=>typeof s=="bigint"?s.toString():s})(re||(re={}));var Zi;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Zi||(Zi={}));const q=re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ue=t=>{switch(typeof t){case"undefined":return q.undefined;case"string":return q.string;case"number":return Number.isNaN(t)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(t)?q.array:t===null?q.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?q.promise:typeof Map<"u"&&t instanceof Map?q.map:typeof Set<"u"&&t instanceof Set?q.set:typeof Date<"u"&&t instanceof Date?q.date:q.object;default:return q.unknown}},$=re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Be extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(s){return s.message},a={_errors:[]},n=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let c=a,l=0;for(;l<o.path.length;){const u=o.path[l];l===o.path.length-1?(c[u]=c[u]||{_errors:[]},c[u]._errors.push(r(o))):c[u]=c[u]||{_errors:[]},c=c[u],l++}}};return n(this),a}static assert(e){if(!(e instanceof Be))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},a=[];for(const n of this.issues)if(n.path.length>0){const s=n.path[0];r[s]=r[s]||[],r[s].push(e(n))}else a.push(e(n));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}Be.create=t=>new Be(t);const Ln=(t,e)=>{let r;switch(t.code){case $.invalid_type:t.received===q.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case $.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,re.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:r=`Unrecognized key(s) in object: ${re.joinValues(t.keys,", ")}`;break;case $.invalid_union:r="Invalid input";break;case $.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${re.joinValues(t.options)}`;break;case $.invalid_enum_value:r=`Invalid enum value. Expected ${re.joinValues(t.options)}, received '${t.received}'`;break;case $.invalid_arguments:r="Invalid function arguments";break;case $.invalid_return_type:r="Invalid function return type";break;case $.invalid_date:r="Invalid date";break;case $.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:re.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case $.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case $.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case $.custom:r="Invalid input";break;case $.invalid_intersection_types:r="Intersection results could not be merged";break;case $.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case $.not_finite:r="Number must be finite";break;default:r=e.defaultError,re.assertNever(t)}return{message:r}};let nu=Ln;function su(){return nu}const iu=t=>{const{data:e,path:r,errorMaps:a,issueData:n}=t,s=[...r,...n.path||[]],o={...n,path:s};if(n.message!==void 0)return{...n,path:s,message:n.message};let c="";const l=a.filter(u=>!!u).slice().reverse();for(const u of l)c=u(o,{data:e,defaultError:c}).message;return{...n,path:s,message:c}};function B(t,e){const r=su(),a=iu({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Ln?void 0:Ln].filter(n=>!!n)});t.common.issues.push(a)}class ve{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const a=[];for(const n of r){if(n.status==="aborted")return K;n.status==="dirty"&&e.dirty(),a.push(n.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){const a=[];for(const n of r){const s=await n.key,o=await n.value;a.push({key:s,value:o})}return ve.mergeObjectSync(e,a)}static mergeObjectSync(e,r){const a={};for(const n of r){const{key:s,value:o}=n;if(s.status==="aborted"||o.status==="aborted")return K;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(a[s.value]=o.value)}return{status:e.value,value:a}}}const K=Object.freeze({status:"aborted"}),Gt=t=>({status:"dirty",value:t}),Se=t=>({status:"valid",value:t}),Ki=t=>t.status==="aborted",Yi=t=>t.status==="dirty",At=t=>t.status==="valid",Lr=t=>typeof Promise<"u"&&t instanceof Promise;var H;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(H||(H={}));class Xe{constructor(e,r,a,n){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ji=(t,e)=>{if(At(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Be(t.common.issues);return this._error=r,this._error}}};function ee(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:a,description:n}=t;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(o,c)=>{const{message:l}=t;return o.code==="invalid_enum_value"?{message:l??c.defaultError}:typeof c.data>"u"?{message:l??a??c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:l??r??c.defaultError}},description:n}}class te{get description(){return this._def.description}_getType(e){return Ue(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Ue(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ve,ctx:{common:e.parent.common,data:e.data,parsedType:Ue(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Lr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){const a={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ue(e)},n=this._parseSync({data:e,path:a.path,parent:a});return Ji(a,n)}"~validate"(e){var a,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ue(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:r});return At(s)?{value:s.value}:{issues:r.common.issues}}catch(s){(n=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(s=>At(s)?{value:s.value}:{issues:r.common.issues})}async parseAsync(e,r){const a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){const a={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ue(e)},n=this._parse({data:e,path:a.path,parent:a}),s=await(Lr(n)?n:Promise.resolve(n));return Ji(a,s)}refine(e,r){const a=n=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(n):r;return this._refinement((n,s)=>{const o=e(n),c=()=>s.addIssue({code:$.custom,...a(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(c(),!1)):o?!0:(c(),!1)})}refinement(e,r){return this._refinement((a,n)=>e(a)?!0:(n.addIssue(typeof r=="function"?r(a,n):r),!1))}_refinement(e){return new Pt({schema:this,typeName:Y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Je.create(this,this._def)}nullable(){return Ot.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ce.create(this)}promise(){return jr.create(this,this._def)}or(e){return Or.create([this,e],this._def)}and(e){return $r.create(this,e,this._def)}transform(e){return new Pt({...ee(this._def),schema:this,typeName:Y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new $n({...ee(this._def),innerType:this,defaultValue:r,typeName:Y.ZodDefault})}brand(){return new Ru({typeName:Y.ZodBranded,type:this,...ee(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new jn({...ee(this._def),innerType:this,catchValue:r,typeName:Y.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return ns.create(this,e)}readonly(){return Dn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ou=/^c[^\s-]{8,}$/i,cu=/^[0-9a-z]+$/,lu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,du=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,uu=/^[a-z0-9_-]{21}$/i,fu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,hu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,mu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,pu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let _n;const gu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,yu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,wu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,wc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_u=new RegExp(`^${wc}$`);function _c(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Eu(t){return new RegExp(`^${_c(t)}$`)}function Su(t){let e=`${wc}T${_c(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Nu(t,e){return!!((e==="v4"||!e)&&gu.test(t)||(e==="v6"||!e)&&yu.test(t))}function Tu(t,e){if(!fu.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!(typeof n!="object"||n===null||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function ku(t,e){return!!((e==="v4"||!e)&&xu.test(t)||(e==="v6"||!e)&&bu.test(t))}class Ke extends te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){const s=this._getOrReturnCtx(e);return B(s,{code:$.invalid_type,expected:q.string,received:s.parsedType}),K}const a=new ve;let n;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),B(n,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),B(n,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,c=e.data.length<s.value;(o||c)&&(n=this._getOrReturnCtx(e,n),o?B(n,{code:$.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):c&&B(n,{code:$.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")mu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"email",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")_n||(_n=new RegExp(pu,"u")),_n.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"emoji",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")du.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"uuid",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")uu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"nanoid",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")ou.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"cuid",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")cu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"cuid2",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")lu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"ulid",code:$.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),B(n,{validation:"url",code:$.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"regex",code:$.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?Su(s).test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?_u.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Eu(s).test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:$.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?hu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"duration",code:$.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?Nu(e.data,s.version)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"ip",code:$.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?Tu(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"jwt",code:$.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?ku(e.data,s.version)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"cidr",code:$.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?vu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"base64",code:$.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?wu.test(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{validation:"base64url",code:$.invalid_string,message:s.message}),a.dirty()):re.assertNever(s);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(n=>e.test(n),{validation:r,code:$.invalid_string,...H.errToObj(a)})}_addCheck(e){return new Ke({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...H.errToObj(e)})}url(e){return this._addCheck({kind:"url",...H.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...H.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...H.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...H.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...H.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...H.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...H.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...H.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...H.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...H.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...H.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...H.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...H.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...H.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...H.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...H.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...H.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...H.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...H.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...H.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...H.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...H.errToObj(r)})}nonempty(e){return this.min(1,H.errToObj(e))}trim(){return new Ke({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ke({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ke({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Ke.create=t=>new Ke({checks:[],typeName:Y.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...ee(t)});function Iu(t,e){const r=(t.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,n=r>a?r:a,s=Number.parseInt(t.toFixed(n).replace(".","")),o=Number.parseInt(e.toFixed(n).replace(".",""));return s%o/10**n}class Ct extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){const s=this._getOrReturnCtx(e);return B(s,{code:$.invalid_type,expected:q.number,received:s.parsedType}),K}let a;const n=new ve;for(const s of this._def.checks)s.kind==="int"?re.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),B(a,{code:$.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="multipleOf"?Iu(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),B(a,{code:$.not_finite,message:s.message}),n.dirty()):re.assertNever(s);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,H.toString(r))}gt(e,r){return this.setLimit("min",e,!1,H.toString(r))}lte(e,r){return this.setLimit("max",e,!0,H.toString(r))}lt(e,r){return this.setLimit("max",e,!1,H.toString(r))}setLimit(e,r,a,n){return new Ct({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:H.toString(n)}]})}_addCheck(e){return new Ct({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:H.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:H.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:H.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:H.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:H.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&re.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}}Ct.create=t=>new Ct({checks:[],typeName:Y.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...ee(t)});class Jt extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let a;const n=new ve;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),B(a,{code:$.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):re.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return B(r,{code:$.invalid_type,expected:q.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,H.toString(r))}gt(e,r){return this.setLimit("min",e,!1,H.toString(r))}lte(e,r){return this.setLimit("max",e,!0,H.toString(r))}lt(e,r){return this.setLimit("max",e,!1,H.toString(r))}setLimit(e,r,a,n){return new Jt({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:H.toString(n)}]})}_addCheck(e){return new Jt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:H.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Jt.create=t=>new Jt({checks:[],typeName:Y.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...ee(t)});class Pn extends te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.boolean,received:a.parsedType}),K}return Se(e.data)}}Pn.create=t=>new Pn({typeName:Y.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...ee(t)});class Pr extends te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){const s=this._getOrReturnCtx(e);return B(s,{code:$.invalid_type,expected:q.date,received:s.parsedType}),K}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return B(s,{code:$.invalid_date}),K}const a=new ve;let n;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),B(n,{code:$.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),B(n,{code:$.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):re.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Pr({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:H.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:H.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Pr.create=t=>new Pr({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Y.ZodDate,...ee(t)});class Xi extends te{_parse(e){if(this._getType(e)!==q.symbol){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.symbol,received:a.parsedType}),K}return Se(e.data)}}Xi.create=t=>new Xi({typeName:Y.ZodSymbol,...ee(t)});class Qi extends te{_parse(e){if(this._getType(e)!==q.undefined){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.undefined,received:a.parsedType}),K}return Se(e.data)}}Qi.create=t=>new Qi({typeName:Y.ZodUndefined,...ee(t)});class eo extends te{_parse(e){if(this._getType(e)!==q.null){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.null,received:a.parsedType}),K}return Se(e.data)}}eo.create=t=>new eo({typeName:Y.ZodNull,...ee(t)});class to extends te{constructor(){super(...arguments),this._any=!0}_parse(e){return Se(e.data)}}to.create=t=>new to({typeName:Y.ZodAny,...ee(t)});class ro extends te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Se(e.data)}}ro.create=t=>new ro({typeName:Y.ZodUnknown,...ee(t)});class Qe extends te{_parse(e){const r=this._getOrReturnCtx(e);return B(r,{code:$.invalid_type,expected:q.never,received:r.parsedType}),K}}Qe.create=t=>new Qe({typeName:Y.ZodNever,...ee(t)});class ao extends te{_parse(e){if(this._getType(e)!==q.undefined){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.void,received:a.parsedType}),K}return Se(e.data)}}ao.create=t=>new ao({typeName:Y.ZodVoid,...ee(t)});class Ce extends te{_parse(e){const{ctx:r,status:a}=this._processInputParams(e),n=this._def;if(r.parsedType!==q.array)return B(r,{code:$.invalid_type,expected:q.array,received:r.parsedType}),K;if(n.exactLength!==null){const o=r.data.length>n.exactLength.value,c=r.data.length<n.exactLength.value;(o||c)&&(B(r,{code:o?$.too_big:$.too_small,minimum:c?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),a.dirty())}if(n.minLength!==null&&r.data.length<n.minLength.value&&(B(r,{code:$.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),a.dirty()),n.maxLength!==null&&r.data.length>n.maxLength.value&&(B(r,{code:$.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,c)=>n.type._parseAsync(new Xe(r,o,r.path,c)))).then(o=>ve.mergeArray(a,o));const s=[...r.data].map((o,c)=>n.type._parseSync(new Xe(r,o,r.path,c)));return ve.mergeArray(a,s)}get element(){return this._def.type}min(e,r){return new Ce({...this._def,minLength:{value:e,message:H.toString(r)}})}max(e,r){return new Ce({...this._def,maxLength:{value:e,message:H.toString(r)}})}length(e,r){return new Ce({...this._def,exactLength:{value:e,message:H.toString(r)}})}nonempty(e){return this.min(1,e)}}Ce.create=(t,e)=>new Ce({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Y.ZodArray,...ee(e)});function wt(t){if(t instanceof de){const e={};for(const r in t.shape){const a=t.shape[r];e[r]=Je.create(wt(a))}return new de({...t._def,shape:()=>e})}else return t instanceof Ce?new Ce({...t._def,type:wt(t.element)}):t instanceof Je?Je.create(wt(t.unwrap())):t instanceof Ot?Ot.create(wt(t.unwrap())):t instanceof mt?mt.create(t.items.map(e=>wt(e))):t}class de extends te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=re.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==q.object){const u=this._getOrReturnCtx(e);return B(u,{code:$.invalid_type,expected:q.object,received:u.parsedType}),K}const{status:a,ctx:n}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof Qe&&this._def.unknownKeys==="strip"))for(const u in n.data)o.includes(u)||c.push(u);const l=[];for(const u of o){const d=s[u],h=n.data[u];l.push({key:{status:"valid",value:u},value:d._parse(new Xe(n,h,n.path,u)),alwaysSet:u in n.data})}if(this._def.catchall instanceof Qe){const u=this._def.unknownKeys;if(u==="passthrough")for(const d of c)l.push({key:{status:"valid",value:d},value:{status:"valid",value:n.data[d]}});else if(u==="strict")c.length>0&&(B(n,{code:$.unrecognized_keys,keys:c}),a.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const d of c){const h=n.data[d];l.push({key:{status:"valid",value:d},value:u._parse(new Xe(n,h,n.path,d)),alwaysSet:d in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const u=[];for(const d of l){const h=await d.key,p=await d.value;u.push({key:h,value:p,alwaysSet:d.alwaysSet})}return u}).then(u=>ve.mergeObjectSync(a,u)):ve.mergeObjectSync(a,l)}get shape(){return this._def.shape()}strict(e){return H.errToObj,new de({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{var s,o;const n=((o=(s=this._def).errorMap)==null?void 0:o.call(s,r,a).message)??a.defaultError;return r.code==="unrecognized_keys"?{message:H.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new de({...this._def,unknownKeys:"strip"})}passthrough(){return new de({...this._def,unknownKeys:"passthrough"})}extend(e){return new de({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new de({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Y.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new de({...this._def,catchall:e})}pick(e){const r={};for(const a of re.objectKeys(e))e[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new de({...this._def,shape:()=>r})}omit(e){const r={};for(const a of re.objectKeys(this.shape))e[a]||(r[a]=this.shape[a]);return new de({...this._def,shape:()=>r})}deepPartial(){return wt(this)}partial(e){const r={};for(const a of re.objectKeys(this.shape)){const n=this.shape[a];e&&!e[a]?r[a]=n:r[a]=n.optional()}return new de({...this._def,shape:()=>r})}required(e){const r={};for(const a of re.objectKeys(this.shape))if(e&&!e[a])r[a]=this.shape[a];else{let s=this.shape[a];for(;s instanceof Je;)s=s._def.innerType;r[a]=s}return new de({...this._def,shape:()=>r})}keyof(){return Ec(re.objectKeys(this.shape))}}de.create=(t,e)=>new de({shape:()=>t,unknownKeys:"strip",catchall:Qe.create(),typeName:Y.ZodObject,...ee(e)});de.strictCreate=(t,e)=>new de({shape:()=>t,unknownKeys:"strict",catchall:Qe.create(),typeName:Y.ZodObject,...ee(e)});de.lazycreate=(t,e)=>new de({shape:t,unknownKeys:"strip",catchall:Qe.create(),typeName:Y.ZodObject,...ee(e)});class Or extends te{_parse(e){const{ctx:r}=this._processInputParams(e),a=this._def.options;function n(s){for(const c of s)if(c.result.status==="valid")return c.result;for(const c of s)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;const o=s.map(c=>new Be(c.ctx.common.issues));return B(r,{code:$.invalid_union,unionErrors:o}),K}if(r.common.async)return Promise.all(a.map(async s=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(n);{let s;const o=[];for(const l of a){const u={...r,common:{...r.common,issues:[]},parent:null},d=l._parseSync({data:r.data,path:r.path,parent:u});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;const c=o.map(l=>new Be(l));return B(r,{code:$.invalid_union,unionErrors:c}),K}}get options(){return this._def.options}}Or.create=(t,e)=>new Or({options:t,typeName:Y.ZodUnion,...ee(e)});function On(t,e){const r=Ue(t),a=Ue(e);if(t===e)return{valid:!0,data:t};if(r===q.object&&a===q.object){const n=re.objectKeys(e),s=re.objectKeys(t).filter(c=>n.indexOf(c)!==-1),o={...t,...e};for(const c of s){const l=On(t[c],e[c]);if(!l.valid)return{valid:!1};o[c]=l.data}return{valid:!0,data:o}}else if(r===q.array&&a===q.array){if(t.length!==e.length)return{valid:!1};const n=[];for(let s=0;s<t.length;s++){const o=t[s],c=e[s],l=On(o,c);if(!l.valid)return{valid:!1};n.push(l.data)}return{valid:!0,data:n}}else return r===q.date&&a===q.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class $r extends te{_parse(e){const{status:r,ctx:a}=this._processInputParams(e),n=(s,o)=>{if(Ki(s)||Ki(o))return K;const c=On(s.value,o.value);return c.valid?((Yi(s)||Yi(o))&&r.dirty(),{status:r.value,value:c.data}):(B(a,{code:$.invalid_intersection_types}),K)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,o])=>n(s,o)):n(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}$r.create=(t,e,r)=>new $r({left:t,right:e,typeName:Y.ZodIntersection,...ee(r)});class mt extends te{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.array)return B(a,{code:$.invalid_type,expected:q.array,received:a.parsedType}),K;if(a.data.length<this._def.items.length)return B(a,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),K;!this._def.rest&&a.data.length>this._def.items.length&&(B(a,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const s=[...a.data].map((o,c)=>{const l=this._def.items[c]||this._def.rest;return l?l._parse(new Xe(a,o,a.path,c)):null}).filter(o=>!!o);return a.common.async?Promise.all(s).then(o=>ve.mergeArray(r,o)):ve.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new mt({...this._def,rest:e})}}mt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new mt({items:t,typeName:Y.ZodTuple,rest:null,...ee(e)})};class no extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.map)return B(a,{code:$.invalid_type,expected:q.map,received:a.parsedType}),K;const n=this._def.keyType,s=this._def.valueType,o=[...a.data.entries()].map(([c,l],u)=>({key:n._parse(new Xe(a,c,a.path,[u,"key"])),value:s._parse(new Xe(a,l,a.path,[u,"value"]))}));if(a.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const l of o){const u=await l.key,d=await l.value;if(u.status==="aborted"||d.status==="aborted")return K;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(u.value,d.value)}return{status:r.value,value:c}})}else{const c=new Map;for(const l of o){const u=l.key,d=l.value;if(u.status==="aborted"||d.status==="aborted")return K;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(u.value,d.value)}return{status:r.value,value:c}}}}no.create=(t,e,r)=>new no({valueType:e,keyType:t,typeName:Y.ZodMap,...ee(r)});class Xt extends te{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.set)return B(a,{code:$.invalid_type,expected:q.set,received:a.parsedType}),K;const n=this._def;n.minSize!==null&&a.data.size<n.minSize.value&&(B(a,{code:$.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),n.maxSize!==null&&a.data.size>n.maxSize.value&&(B(a,{code:$.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());const s=this._def.valueType;function o(l){const u=new Set;for(const d of l){if(d.status==="aborted")return K;d.status==="dirty"&&r.dirty(),u.add(d.value)}return{status:r.value,value:u}}const c=[...a.data.values()].map((l,u)=>s._parse(new Xe(a,l,a.path,u)));return a.common.async?Promise.all(c).then(l=>o(l)):o(c)}min(e,r){return new Xt({...this._def,minSize:{value:e,message:H.toString(r)}})}max(e,r){return new Xt({...this._def,maxSize:{value:e,message:H.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Xt.create=(t,e)=>new Xt({valueType:t,minSize:null,maxSize:null,typeName:Y.ZodSet,...ee(e)});class so extends te{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}so.create=(t,e)=>new so({getter:t,typeName:Y.ZodLazy,...ee(e)});class io extends te{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return B(r,{received:r.data,code:$.invalid_literal,expected:this._def.value}),K}return{status:"valid",value:e.data}}get value(){return this._def.value}}io.create=(t,e)=>new io({value:t,typeName:Y.ZodLiteral,...ee(e)});function Ec(t,e){return new Lt({values:t,typeName:Y.ZodEnum,...ee(e)})}class Lt extends te{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),a=this._def.values;return B(r,{expected:re.joinValues(a),received:r.parsedType,code:$.invalid_type}),K}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),a=this._def.values;return B(r,{received:r.data,code:$.invalid_enum_value,options:a}),K}return Se(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return Lt.create(e,{...this._def,...r})}exclude(e,r=this._def){return Lt.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}}Lt.create=Ec;class oo extends te{_parse(e){const r=re.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==q.string&&a.parsedType!==q.number){const n=re.objectValues(r);return B(a,{expected:re.joinValues(n),received:a.parsedType,code:$.invalid_type}),K}if(this._cache||(this._cache=new Set(re.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const n=re.objectValues(r);return B(a,{received:a.data,code:$.invalid_enum_value,options:n}),K}return Se(e.data)}get enum(){return this._def.values}}oo.create=(t,e)=>new oo({values:t,typeName:Y.ZodNativeEnum,...ee(e)});class jr extends te{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==q.promise&&r.common.async===!1)return B(r,{code:$.invalid_type,expected:q.promise,received:r.parsedType}),K;const a=r.parsedType===q.promise?r.data:Promise.resolve(r.data);return Se(a.then(n=>this._def.type.parseAsync(n,{path:r.path,errorMap:r.common.contextualErrorMap})))}}jr.create=(t,e)=>new jr({type:t,typeName:Y.ZodPromise,...ee(e)});class Pt extends te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:a}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:o=>{B(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),n.type==="preprocess"){const o=n.transform(a.data,s);if(a.common.async)return Promise.resolve(o).then(async c=>{if(r.value==="aborted")return K;const l=await this._def.schema._parseAsync({data:c,path:a.path,parent:a});return l.status==="aborted"?K:l.status==="dirty"||r.value==="dirty"?Gt(l.value):l});{if(r.value==="aborted")return K;const c=this._def.schema._parseSync({data:o,path:a.path,parent:a});return c.status==="aborted"?K:c.status==="dirty"||r.value==="dirty"?Gt(c.value):c}}if(n.type==="refinement"){const o=c=>{const l=n.refinement(c,s);if(a.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(a.common.async===!1){const c=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return c.status==="aborted"?K:(c.status==="dirty"&&r.dirty(),o(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(c=>c.status==="aborted"?K:(c.status==="dirty"&&r.dirty(),o(c.value).then(()=>({status:r.value,value:c.value}))))}if(n.type==="transform")if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!At(o))return K;const c=n.transform(o.value,s);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>At(o)?Promise.resolve(n.transform(o.value,s)).then(c=>({status:r.value,value:c})):K);re.assertNever(n)}}Pt.create=(t,e,r)=>new Pt({schema:t,typeName:Y.ZodEffects,effect:e,...ee(r)});Pt.createWithPreprocess=(t,e,r)=>new Pt({schema:e,effect:{type:"preprocess",transform:t},typeName:Y.ZodEffects,...ee(r)});class Je extends te{_parse(e){return this._getType(e)===q.undefined?Se(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Je.create=(t,e)=>new Je({innerType:t,typeName:Y.ZodOptional,...ee(e)});class Ot extends te{_parse(e){return this._getType(e)===q.null?Se(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ot.create=(t,e)=>new Ot({innerType:t,typeName:Y.ZodNullable,...ee(e)});class $n extends te{_parse(e){const{ctx:r}=this._processInputParams(e);let a=r.data;return r.parsedType===q.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}$n.create=(t,e)=>new $n({innerType:t,typeName:Y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ee(e)});class jn extends te{_parse(e){const{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Lr(n)?n.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Be(a.common.issues)},input:a.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Be(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}jn.create=(t,e)=>new jn({innerType:t,typeName:Y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ee(e)});class co extends te{_parse(e){if(this._getType(e)!==q.nan){const a=this._getOrReturnCtx(e);return B(a,{code:$.invalid_type,expected:q.nan,received:a.parsedType}),K}return{status:"valid",value:e.data}}}co.create=t=>new co({typeName:Y.ZodNaN,...ee(t)});class Ru extends te{_parse(e){const{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class ns extends te{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?K:s.status==="dirty"?(r.dirty(),Gt(s.value)):this._def.out._parseAsync({data:s.value,path:a.path,parent:a})})();{const n=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?K:n.status==="dirty"?(r.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:a.path,parent:a})}}static create(e,r){return new ns({in:e,out:r,typeName:Y.ZodPipeline})}}class Dn extends te{_parse(e){const r=this._def.innerType._parse(e),a=n=>(At(n)&&(n.value=Object.freeze(n.value)),n);return Lr(r)?r.then(n=>a(n)):a(r)}unwrap(){return this._def.innerType}}Dn.create=(t,e)=>new Dn({innerType:t,typeName:Y.ZodReadonly,...ee(e)});var Y;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Y||(Y={}));const se=Ke.create,Sc=Ct.create,Nc=Pn.create;Qe.create;const Au=Ce.create,rt=de.create;Or.create;$r.create;mt.create;const et=Lt.create;jr.create;Je.create;Ot.create;var at=(t,e,r)=>au(t,async(a,n)=>{let s=a;const o=await e.safeParseAsync(s);return o.success?o.data:n.json(o,400)});let Ht=[],xt=[],En=[],it=1;class be{static async initialize(){if(Ht.length===0){const n=[{id:1,email:"demo@astroluna.com",password_hash:"b74ff91f71caef55a5af547ac8f03c3e0dec9d6c9669bcfa23c22460dc32f151:testsalt123",full_name:"Demo User",phone:"+1234567890",language:"en",currency:"EUR",is_verified:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:2,email:"test@astroluna.com",password_hash:"9346cddcc214472fa19094d4f40acd0ce761758c0bab35c7585bb473b1f3550c:demosalt456",full_name:"Test User",phone:"+0987654321",language:"en",currency:"USD",is_verified:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:3,email:"admin@astroluna.com",password_hash:"7307f78c9244e00526debeabb074fc6b9987b2594c2da6a2ed9269aac3511b51:adminsalt789",full_name:"Admin User",phone:"+1122334455",language:"en",currency:"GBP",is_verified:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];Ht.push(...n);const s=[{id:1,user_id:1,balance:150,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:2,user_id:2,balance:100,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:3,user_id:3,balance:500,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];xt.push(...s),it=4,console.log("🌙 Mock database initialized with test accounts:"),console.log("📧 demo@astroluna.com / demo123 (150 credits)"),console.log("📧 test@astroluna.com / password (100 credits)"),console.log("📧 admin@astroluna.com / admin123 (500 credits)")}}async createUser(e){console.log("Creating user with password:",typeof e.password,e.password);const r=Math.random().toString(36).substring(2,15),n=new TextEncoder().encode(e.password+r),s=await crypto.subtle.digest("SHA-256",n),l=Array.from(new Uint8Array(s)).map(h=>h.toString(16).padStart(2,"0")).join("")+":"+r,u={id:it++,email:e.email,password_hash:l,full_name:e.full_name,phone:e.phone||"",language:e.language||"en",currency:e.currency||"EUR",is_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};Ht.push(u);const d={id:it++,user_id:u.id,balance:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return xt.push(d),u}async getUserByEmail(e){return Ht.find(r=>r.email===e)||null}async getUserById(e){return Ht.find(r=>r.id===e)||null}async verifyPassword(e,r){if(!r.includes(":"))return!1;const[a,n]=r.split(":"),o=new TextEncoder().encode(e+n),c=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(c)).map(d=>d.toString(16).padStart(2,"0")).join("")===a}async getUserCredits(e){const r=xt.find(a=>a.user_id===e);return(r==null?void 0:r.balance)||0}async addCredits(e,r){const a=xt.find(n=>n.user_id===e);a?(a.balance+=r,a.updated_at=new Date().toISOString()):xt.push({id:it++,user_id:e,balance:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}async deductCredits(e,r){const a=xt.find(n=>n.user_id===e);return a&&a.balance>=r?(a.balance-=r,a.updated_at=new Date().toISOString(),!0):!1}async createTransaction(e){const r={id:it++,user_id:e.user_id,amount_eur:e.amount_eur,amount_currency:e.amount_currency,currency:e.currency,rate_used:e.rate_used,rates_timestamp:e.rates_timestamp,tx_id:e.tx_id,status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return En.push(r),r}async updateTransactionStatus(e,r,a){const n=En.find(s=>s.tx_id===e);n&&(n.status=r,n.gateway_response=a,n.updated_at=new Date().toISOString())}async getUserTransactions(e,r=50){return En.filter(a=>a.user_id===e).sort((a,n)=>new Date(n.created_at).getTime()-new Date(a.created_at).getTime()).slice(0,r)}async createGenerationLog(){return{id:it++}}async updateGenerationLogStatus(){}async getUserGenerations(){return[]}async saveContent(){return{id:it++}}async getUserContent(){return[]}async createSupportTicket(){return{changes:1}}async updateRatesCache(){}async getLatestRates(){return null}async createResetToken(){}async verifyResetToken(){return null}async markResetTokenUsed(){}}const lo=Object.freeze(Object.defineProperty({__proto__:null,MockDatabaseService:be},Symbol.toStringTag,{value:"Module"}));var ss={};const Bt=new Dt,Cu=rt({full_name:se().min(2,"Full name must be at least 2 characters"),email:se().email("Invalid email address"),phone:se().min(8,"Phone number must be at least 8 characters"),password:se().min(6,"Password must be at least 6 characters"),confirm_password:se(),privacy_accepted:Nc().refine(t=>t===!0,"You must accept privacy policy"),language:et(["en","es","de"]).optional(),currency:et(["EUR","USD","GBP"]).optional()}).refine(t=>t.password===t.confirm_password,{message:"Passwords don't match",path:["confirm_password"]}),Lu=rt({email:se().email("Invalid email address"),password:se().min(1,"Password is required")}),Pu=rt({email:se().email("Invalid email address")}),Ou=rt({token:se().min(1,"Token is required"),new_password:se().min(6,"Password must be at least 6 characters"),confirm_password:se()}).refine(t=>t.new_password===t.confirm_password,{message:"Passwords don't match",path:["confirm_password"]});async function ur(t){if(typeof(t==null?void 0:t.DB)>"u")return console.log("Using mock database (non-Cloudflare environment)"),await be.initialize(),new be;try{return await t.DB.prepare("SELECT COUNT(*) FROM users LIMIT 1").first(),new Vr(t.DB)}catch(e){return console.log("D1 database not properly configured, using mock database:",e.message),await be.initialize(),new be}}Bt.post("/signup",at("json",Cu),async t=>{var e;try{const r=t.req.valid("json"),a=await ur(t.env);if(await a.getUserByEmail(r.email))return t.json({error:"User with this email already exists"},400);const s=await a.createUser({email:r.email,password:r.password,full_name:r.full_name,phone:r.phone,language:r.language||"en",currency:r.currency||"EUR"}),o=((e=t.env)==null?void 0:e.JWT_SECRET)||ss.JWT_SECRET||"demo_jwt_secret_astroluna_2024",c=rs(s.id,o),{password_hash:l,...u}=s;return t.json({success:!0,message:"Account created successfully",user:u,token:c})}catch(r){return console.error("Signup error:",r),t.json({error:"Registration failed. Please try again."},500)}});Bt.post("/login",at("json",Lu),async t=>{var e;try{const{email:r,password:a}=t.req.valid("json"),n=await ur(t.env),s=await n.getUserByEmail(r);if(!s)return t.json({error:"Invalid email or password"},401);if(!await n.verifyPassword(a,s.password_hash))return t.json({error:"Invalid email or password"},401);const c=((e=t.env)==null?void 0:e.JWT_SECRET)||ss.JWT_SECRET||"demo_jwt_secret_astroluna_2024",l=rs(s.id,c),u=await n.getUserCredits(s.id),{password_hash:d,...h}=s;return t.json({success:!0,message:"Login successful",user:h,credits:u,token:l})}catch(r){return console.error("Login error:",r),t.json({error:"Login failed. Please try again."},500)}});Bt.post("/reset-password",at("json",Pu),async t=>{try{const{email:e}=t.req.valid("json"),r=await ur(t.env),a=await r.getUserByEmail(e);if(!a)return t.json({success:!0,message:"If this email exists, you will receive a password reset link"});const n=vc(),s=new Date(Date.now()+36e5).toISOString();await r.createResetToken(a.id,n,s);const o=`${t.env.BASE_URL||"http://localhost:3000"}/reset-password?token=${n}`;return console.log(`Password reset requested for ${e}`),console.log(`Reset URL: ${o}`),t.json({success:!0,message:"If this email exists, you will receive a password reset link",...t.env.NODE_ENV==="development"&&{reset_token:n,reset_url:o}})}catch(e){return console.error("Reset password error:",e),t.json({error:"Password reset failed. Please try again."},500)}});Bt.post("/reset-password/confirm",at("json",Ou),async t=>{try{const{token:e,new_password:r}=t.req.valid("json"),a=await ur(t.env),n=await a.verifyResetToken(e);if(!n)return t.json({error:"Invalid or expired reset token"},400);const s=new Date,o=new Date(n.expires_at);if(s>o)return t.json({error:"Reset token has expired"},400);const c=await a.getUserById(n.user_id);if(!c)return t.json({error:"User not found"},400);const u=await(await Promise.resolve().then(()=>td)).hash(r,10);return await t.env.DB.prepare(`
      UPDATE users SET password_hash = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).bind(u,c.id).run(),await a.markResetTokenUsed(e),t.json({success:!0,message:"Password updated successfully"})}catch(e){return console.error("Set new password error:",e),t.json({error:"Password update failed. Please try again."},500)}});Bt.get("/profile",async t=>{var e;try{const r=t.req.header("Authorization");if(!r||!r.startsWith("Bearer "))return t.json({error:"No authorization token provided"},401);const a=r.substring(7),n=((e=t.env)==null?void 0:e.JWT_SECRET)||ss.JWT_SECRET||"demo_jwt_secret_astroluna_2024",s=await Promise.resolve().then(()=>zd);let o;try{o=s.verify(a,n)}catch{return t.json({error:"Invalid or expired token"},401)}const c=await ur(t.env),l=await c.getUserById(o.userId);if(!l)return t.json({error:"User not found"},404);const u=await c.getUserCredits(l.id),{password_hash:d,...h}=l;return t.json({success:!0,user:h,credits:u})}catch(r){return console.error("Profile error:",r),t.json({error:"Failed to get profile"},500)}});class ye{static async fetchNBURates(){try{const e=await fetch(this.NBU_API_URL);if(!e.ok)throw new Error(`NBU API request failed: ${e.status}`);return await e.json()}catch(e){throw console.error("Error fetching NBU rates:",e),e}}static processNBURates(e){var s,o,c;const r=(s=e.find(l=>l.cc==="USD"))==null?void 0:s.rate,a=(o=e.find(l=>l.cc==="EUR"))==null?void 0:o.rate,n=(c=e.find(l=>l.cc==="GBP"))==null?void 0:c.rate;if(!r||!a||!n)throw new Error("Required currency rates not found in NBU response");return{EUR:1,USD:r/a,GBP:n/a,timestamp:new Date().toISOString()}}static getFallbackRates(){return{EUR:1,USD:1.1,GBP:.85,timestamp:new Date().toISOString()}}static convertToEUR(e,r,a){const n=a[r];if(!n)throw new Error(`Unsupported currency: ${r}`);return r==="EUR"?e:e/n}static convertFromEUR(e,r,a){const n=a[r];if(!n)throw new Error(`Unsupported currency: ${r}`);return r==="EUR"?e:e*n}static areRatesFresh(e){const r=new Date(e).getTime();return(new Date().getTime()-r)/(1e3*60*60)<24}static async getExchangeRates(e){try{let r=null;if(e&&e.prepare)try{r=await e.prepare(`
            SELECT rates_data, rates_timestamp 
            FROM rates_cache 
            ORDER BY rates_timestamp DESC 
            LIMIT 1
          `).first()}catch{}if(r&&this.areRatesFresh(r.rates_timestamp))return JSON.parse(r.rates_data);try{const a=await this.fetchNBURates(),n=this.processNBURates(a);if(e&&e.prepare)try{await e.prepare(`
              INSERT INTO rates_cache (rates_data, rates_timestamp)
              VALUES (?, ?)
            `).bind(JSON.stringify(n),n.timestamp).run()}catch{}return n}catch(a){console.error("NBU API failed, using fallback rates:",a);const n=this.getFallbackRates();if(e&&e.prepare)try{await e.prepare(`
              INSERT INTO rates_cache (rates_data, rates_timestamp)
              VALUES (?, ?)
            `).bind(JSON.stringify({...n,fallback:!0}),n.timestamp).run()}catch{}return n}}catch(r){return console.error("Error getting exchange rates:",r),this.getFallbackRates()}}static formatCurrency(e,r){return new Intl.NumberFormat("en-US",{style:"currency",currency:r,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}static calculatePackagePricing(e,r){return{EUR:e,USD:this.convertFromEUR(e,"USD",r),GBP:this.convertFromEUR(e,"GBP",r),formatted:{EUR:this.formatCurrency(e,"EUR"),USD:this.formatCurrency(this.convertFromEUR(e,"USD",r),"USD"),GBP:this.formatCurrency(this.convertFromEUR(e,"GBP",r),"GBP")}}}}G(ye,"NBU_API_URL","https://bank.gov.ua/NBUStatService/v1/statdirectory/exchangenew?json");const qt=new Dt;qt.get("/rates",async t=>{var e;try{const r=await ye.getExchangeRates((e=t.env)==null?void 0:e.DB);return t.json({success:!0,rates:r,timestamp:r.timestamp})}catch(r){console.error("Error fetching exchange rates:",r);const a=ye.getFallbackRates();return t.json({success:!0,rates:a,timestamp:a.timestamp,fallback:!0})}});qt.get("/pricing",async t=>{var e;try{const r=await ye.getExchangeRates((e=t.env)==null?void 0:e.DB),n=[{eur_amount:5,credits:50,bonus_percent:0},{eur_amount:20,credits:220,bonus_percent:10},{eur_amount:100,credits:1200,bonus_percent:20},{eur_amount:500,credits:7e3,bonus_percent:40},{eur_amount:2e3,credits:32e3,bonus_percent:60}].map(s=>{const o=ye.calculatePackagePricing(s.eur_amount,r);return{credits:s.credits,bonus_percent:s.bonus_percent,prices:o,cost_per_credit:{EUR:Number((s.eur_amount/s.credits).toFixed(4)),USD:Number((o.USD/s.credits).toFixed(4)),GBP:Number((o.GBP/s.credits).toFixed(4))}}});return t.json({success:!0,pricing:n,rates:r,service_costs:{astroscope:15,tarotpath:20,zodiac_tome:10}})}catch(r){return console.error("Error calculating pricing:",r),t.json({error:"Failed to calculate pricing"},500)}});qt.post("/convert",async t=>{var e;try{const{amount:r,from_currency:a,to_currency:n}=await t.req.json();if(!r||!a||!n)return t.json({error:"Missing required parameters: amount, from_currency, to_currency"},400);const s=await ye.getExchangeRates((e=t.env)==null?void 0:e.DB),o=ye.convertToEUR(r,a,s),c=ye.convertFromEUR(o,n,s);return t.json({success:!0,original_amount:r,from_currency:a,to_currency:n,converted_amount:Math.round(c*100)/100,exchange_rate:s[n]/s[a],formatted:ye.formatCurrency(c,n)})}catch(r){return console.error("Error converting currency:",r),t.json({error:"Currency conversion failed"},500)}});qt.get("/supported",t=>t.json({success:!0,currencies:[{code:"EUR",name:"Euro",symbol:"€",is_base:!0},{code:"USD",name:"US Dollar",symbol:"$",is_base:!1},{code:"GBP",name:"British Pound",symbol:"£",is_base:!1}]}));qt.post("/checkout/quote",async t=>{var e;try{const{amount_eur:r,target_currency:a}=await t.req.json();if(!r||!a)return t.json({error:"Missing required parameters: amount_eur, target_currency"},400);const n=await ye.getExchangeRates((e=t.env)==null?void 0:e.DB),s=ye.convertFromEUR(r,a,n),o=`quote_${Date.now()}_${Math.random().toString(36).substring(7)}`,c=new Date(Date.now()+1800*1e3).toISOString();return await t.env.DB.prepare(`
      INSERT INTO rates_cache (rates_data, rates_timestamp)
      VALUES (?, ?)
    `).bind(JSON.stringify({quote_id:o,amount_eur:r,target_currency:a,converted_amount:s,rate_used:n[a],expires_at:c,rates_snapshot:n}),new Date().toISOString()).run(),t.json({success:!0,quote_id:o,amount_eur:r,target_currency:a,converted_amount:Math.round(s*100)/100,rate_used:n[a],formatted_amount:ye.formatCurrency(s,a),expires_at:c})}catch(r){return console.error("Error creating checkout quote:",r),t.json({error:"Failed to create checkout quote"},500)}});class _t{static async createPaymentWidget(e,r){try{const a=`astroluna_${Date.now()}_${Math.random().toString(36).substring(7)}`,n={terminal_id:r.SPC_TERMINAL_ID,amount:Math.round(e.amount_eur*100),currency:e.currency,order_id:a,description:`AstroLuna Credits Purchase - ${e.amount_eur} EUR`,customer:{email:e.email,name:e.full_name,phone:e.phone,billing_address:{country:e.country,state:e.state,city:e.city,address:e.address,zip:e.zip_code}},callback_url:`${r.BASE_URL}/api/payments/webhook`,return_url:`${r.BASE_URL}/checkout/success`,cancel_url:`${r.BASE_URL}/checkout/cancel`,timestamp:Math.floor(Date.now()/1e3)},s=await this.generateSignature(n,r.SPC_SEC_KEY),o=await fetch(`${this.SPC_API_BASE}/transactions/widget`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.SPC_PUB_KEY}`,"X-Terminal-ID":r.SPC_TERMINAL_ID,"X-Signature":s},body:JSON.stringify(n)});if(!o.ok){const l=await o.json().catch(()=>({}));throw new Error(`SPC API Error: ${o.status} - ${l.message||"Payment creation failed"}`)}const c=await o.json();return{success:!0,transaction_id:c.transaction_id||a,payment_url:c.payment_url||c.widget_url,widget_config:c.widget_config}}catch(a){return console.error("SPC Payment creation error:",a),{success:!1,error:a instanceof Error?a.message:"Payment creation failed"}}}static async generateSignature(e,r){try{const a=Object.keys(e).filter(h=>e[h]!==null&&e[h]!==void 0).sort().map(h=>`${h}=${typeof e[h]=="object"?JSON.stringify(e[h]):e[h]}`).join("&"),n=new TextEncoder,s=n.encode(r),o=n.encode(a),c=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",c,o);return Array.from(new Uint8Array(l)).map(h=>h.toString(16).padStart(2,"0")).join("")}catch(a){throw console.error("Signature generation error:",a),new Error("Failed to generate payment signature")}}static async verifyWebhookSignature(e,r,a){try{const n=await this.generateWebhookSignature(e,a);return r===n}catch(n){return console.error("Webhook signature verification error:",n),!1}}static async generateWebhookSignature(e,r){const a=new TextEncoder,n=a.encode(r),s=a.encode(e),o=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),c=await crypto.subtle.sign("HMAC",o,s);return Array.from(new Uint8Array(c)).map(d=>d.toString(16).padStart(2,"0")).join("")}static parseWebhookPayload(e){var r,a;try{const n=JSON.parse(e);return{event:n.event||"payment.updated",transaction_id:n.transaction_id||n.id,order_id:n.order_id||n.merchant_order_id,status:n.status||"unknown",amount:n.amount||0,currency:n.currency||"EUR",timestamp:n.timestamp||new Date().toISOString(),payment_method:n.payment_method,error_code:(r=n.error)==null?void 0:r.code,error_message:(a=n.error)==null?void 0:a.message}}catch(n){return console.error("Webhook payload parsing error:",n),null}}static calculateCredits(e){const a=[{eur_amount:5,credits:50,bonus_percent:0},{eur_amount:20,credits:220,bonus_percent:10},{eur_amount:100,credits:1200,bonus_percent:20},{eur_amount:500,credits:7e3,bonus_percent:40},{eur_amount:2e3,credits:32e3,bonus_percent:60}].find(c=>c.eur_amount===e);if(a){const c=Math.floor(a.credits*a.bonus_percent/100);return{credits:a.credits,bonus:c,total:a.credits+c}}const n=e*10;let s=0;e>=2e3?s=60:e>=500?s=40:e>=100?s=20:e>=20&&(s=10);const o=Math.floor(n*s/100);return{credits:n,bonus:o,total:n+o}}static async getPaymentStatus(e,r){try{const a=await fetch(`${this.SPC_API_BASE}/transactions/${e}`,{headers:{Authorization:`Bearer ${r.SPC_PUB_KEY}`,"X-Terminal-ID":r.SPC_TERMINAL_ID}});if(!a.ok)throw new Error(`SPC API Error: ${a.status}`);const n=await a.json();return{status:n.status||"unknown",amount:n.amount,currency:n.currency,payment_method:n.payment_method}}catch(a){return console.error("Payment status check error:",a),{status:"error",error:a instanceof Error?a.message:"Status check failed"}}}}G(_t,"SPC_API_BASE","https://api.sandbox.securepaycard.com");var Sn={};const nt=new Dt;async function fr(t){if(t.DB)try{return await t.DB.prepare("SELECT COUNT(*) FROM users LIMIT 1").first(),new Vr(t.DB)}catch(e){return console.log("D1 database not properly configured, using mock database:",e.message),await be.initialize(),new be}else return console.log("Using mock database (D1 not available)"),await be.initialize(),new be}const $u=rt({credits_amount:Sc().min(10,"Minimum purchase is 10 credits"),currency:et(["EUR","USD","GBP"]),email:se().email("Invalid email"),full_name:se().min(2,"Full name required"),phone:se().min(8,"Valid phone number required"),country:se().min(2,"Country required"),state:se().min(2,"State required"),city:se().min(2,"City required"),address:se().min(5,"Full address required"),zip_code:se().min(3,"ZIP code required"),privacy_accepted:Nc().refine(t=>t===!0,"Privacy policy must be accepted")});nt.post("/checkout/init",tt,at("json",$u),async t=>{var e,r,a;try{const n=Fe(t),s=t.req.valid("json"),o=await fr(t.env),c=await ye.getExchangeRates(t.env.DB),l=_t.calculateCredits(s.credits_amount/10),u=s.credits_amount/10,d=ye.convertFromEUR(u,s.currency,c),h={user_id:n,amount_eur:u,amount_currency:d,currency:s.currency,rate_used:c[s.currency],rates_timestamp:c.timestamp,tx_id:`astroluna_${Date.now()}_${Math.random().toString(36).substring(7)}`},p=await o.createTransaction(h),E={amount_eur:u,currency:s.currency,email:s.email,full_name:s.full_name,phone:s.phone,country:s.country,state:s.state,city:s.city,address:s.address,zip_code:s.zip_code},v=((e=t.env)==null?void 0:e.SPC_TERMINAL_ID)||Sn.SPC_TERMINAL_ID||"demo_terminal_id",b=((r=t.env)==null?void 0:r.SPC_PUB_KEY)||Sn.SPC_PUB_KEY||"demo_pub_key",I=((a=t.env)==null?void 0:a.SPC_SEC_KEY)||Sn.SPC_SEC_KEY||"SEC-AA_demo_key",y=v&&b&&I&&!v.includes("placeholder")&&!b.includes("placeholder")&&!I.includes("SEC-AA");console.log("SPC Credentials check:",{hasValidSPCCredentials:y,hasTerminal:!!v,hasPubKey:!!b,hasSecKey:!!I,usingDemoMode:!y});let w;return y?w=await _t.createPaymentWidget(E,{SPC_TERMINAL_ID:v,SPC_PUB_KEY:b,SPC_SEC_KEY:I,BASE_URL:t.env.BASE_URL||"http://localhost:3000"}):(console.log("Using demo payment mode (SPC credentials not configured or invalid)"),w={success:!0,transaction_id:`demo_${Date.now()}`,payment_url:`/api/payments/checkout/demo-payment?tx=${p.tx_id}&amount=${d}&currency=${s.currency}`,widget_config:{demo:!0,message:"Demo mode - no real payment will be processed"}}),w.success?(await o.updateTransactionStatus(p.tx_id,"pending",JSON.stringify({gateway_transaction_id:w.transaction_id,payment_url:w.payment_url,demo_mode:!y})),t.json({success:!0,transaction_id:p.tx_id,payment_url:w.payment_url,widget_config:w.widget_config,order_summary:{credits_purchased:l.credits,bonus_credits:l.bonus,total_credits:l.total,amount_eur:u,amount_currency:Math.round(d*100)/100,currency:s.currency,exchange_rate:c[s.currency]}})):(await o.updateTransactionStatus(p.tx_id,"failed",w.error),t.json({error:"Payment initialization failed",details:w.error},400))}catch(n){return console.error("Checkout initialization error:",n),t.json({error:"Failed to initialize checkout"},500)}});nt.post("/webhook",async t=>{try{const r=await t.req.text(),a=t.req.header("X-SPC-Signature")||t.req.header("X-Signature")||"";if(!await _t.verifyWebhookSignature(r,a,t.env.SPC_SEC_KEY))return console.error("Invalid webhook signature"),t.json({error:"Invalid signature"},401);const s=_t.parseWebhookPayload(r);if(!s)return t.json({error:"Invalid payload"},400);console.log("Processing webhook:",s);const o=await fr(t.env);if(t.env.DB){const c=await t.env.DB.prepare(`
        SELECT * FROM transactions 
        WHERE tx_id = ? OR gateway_response LIKE ?
      `).bind(s.order_id,`%${s.transaction_id}%`).all();if(c.results.length===0)return console.error("Transaction not found for webhook:",s.order_id),t.json({error:"Transaction not found"},404);var e=c.results[0]}else{const l=(await o.getUserTransactions(0,1e3)).filter(u=>u.tx_id===s.order_id||u.gateway_response&&u.gateway_response.includes(s.transaction_id));if(l.length===0)return console.error("Transaction not found for webhook:",s.order_id),t.json({error:"Transaction not found"},404);var e=l[0]}switch(s.status.toLowerCase()){case"completed":case"success":case"succeeded":const c=_t.calculateCredits(e.amount_eur);await o.addCredits(e.user_id,c.total),await o.updateTransactionStatus(e.tx_id,"completed",JSON.stringify({...JSON.parse(e.gateway_response||"{}"),webhook_data:s,credits_added:c.total})),await o.createGenerationLog({user_id:e.user_id,service_type:"credit_purchase",params:JSON.stringify({transaction_id:e.tx_id,amount_eur:e.amount_eur,credits_purchased:c.credits,bonus_credits:c.bonus}),base_cost:-c.total,total_cost:-c.total,result_id:`tx_${e.tx_id}`}),console.log(`Credits added: ${c.total} to user ${e.user_id}`);break;case"failed":case"declined":case"error":await o.updateTransactionStatus(e.tx_id,"failed",JSON.stringify({...JSON.parse(e.gateway_response||"{}"),webhook_data:s,error_code:s.error_code,error_message:s.error_message})),console.log(`Payment failed for transaction ${e.tx_id}: ${s.error_message}`);break;case"cancelled":case"canceled":await o.updateTransactionStatus(e.tx_id,"cancelled",JSON.stringify({...JSON.parse(e.gateway_response||"{}"),webhook_data:s})),console.log(`Payment cancelled for transaction ${e.tx_id}`);break;default:console.log(`Unknown payment status: ${s.status} for transaction ${e.tx_id}`);break}return t.json({status:"ok",message:"Webhook processed successfully"})}catch(r){return console.error("Webhook processing error:",r),t.json({error:"Webhook processing failed"},500)}});nt.get("/status/:transactionId",tt,async t=>{try{const e=Fe(t),r=t.req.param("transactionId"),s=(await(await fr(t.env)).getUserTransactions(e,1e3)).find(o=>o.tx_id===r);return s?t.json({success:!0,transaction:{id:s.tx_id,status:s.status,amount_eur:s.amount_eur,amount_currency:s.amount_currency,currency:s.currency,created_at:s.created_at,updated_at:s.updated_at}}):t.json({error:"Transaction not found"},404)}catch(e){return console.error("Transaction status error:",e),t.json({error:"Failed to get transaction status"},500)}});nt.get("/history",tt,async t=>{try{const e=Fe(t),r=parseInt(t.req.query("limit")||"20"),a=parseInt(t.req.query("offset")||"0"),o={results:(await(await fr(t.env)).getUserTransactions(e,r+a)).slice(a,a+r)};return t.json({success:!0,transactions:o.results,pagination:{limit:r,offset:a,total:o.results.length}})}catch(e){return console.error("Transaction history error:",e),t.json({error:"Failed to get transaction history"},500)}});nt.get("/test-connection",async t=>{if(t.env.NODE_ENV==="production")return t.json({error:"Test endpoint not available in production"},403);try{const e=await fetch(`${t.env.SPC_API_BASE||"https://api.sandbox.securepaycard.com"}/health`,{headers:{Authorization:`Bearer ${t.env.SPC_PUB_KEY}`,"X-Terminal-ID":t.env.SPC_TERMINAL_ID}});return t.json({success:!0,spc_status:e.status,spc_ok:e.ok,config:{terminal_id:t.env.SPC_TERMINAL_ID?"configured":"missing",pub_key:t.env.SPC_PUB_KEY?"configured":"missing",sec_key:t.env.SPC_SEC_KEY?"configured":"missing"}})}catch(e){return t.json({success:!1,error:e instanceof Error?e.message:"Connection test failed",config:{terminal_id:t.env.SPC_TERMINAL_ID?"configured":"missing",pub_key:t.env.SPC_PUB_KEY?"configured":"missing",sec_key:t.env.SPC_SEC_KEY?"configured":"missing"}})}});nt.post("/checkout/demo-webhook",async t=>{try{const{tx_id:e}=await t.req.json();if(!e)return t.json({error:"Missing transaction ID"},400);const r=await fr(t.env);await r.updateTransactionStatus(e,"completed",JSON.stringify({demo:!0,completed_at:new Date().toISOString()}));const n=(await r.getUserTransactions(1,1)).find(s=>s.tx_id===e);if(n){const s=Math.floor(n.amount_eur*10);await r.addCredits(n.user_id,s),console.log(`Demo payment completed: Added ${s} credits to user ${n.user_id}`)}return t.json({success:!0,demo:!0})}catch(e){return console.error("Demo webhook error:",e),t.json({error:"Demo webhook failed"},500)}});nt.get("/checkout/demo-payment",async t=>{const e=t.req.query("tx"),r=t.req.query("amount"),a=t.req.query("currency");return!e||!r||!a?t.json({error:"Missing payment parameters"},400):t.html(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Demo Payment - AstroLuna</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" />
        <style>
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
        </style>
    </head>
    <body class="text-white flex items-center justify-center min-h-screen">
        <div class="max-w-md mx-auto p-8">
            <div class="bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-8 text-center">
                <div class="text-6xl text-yellow-400 mb-6">
                    <i class="fas fa-credit-card"></i>
                </div>
                
                <h1 class="text-2xl font-bold mb-4">Demo Payment Simulation</h1>
                
                <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4 mb-6">
                    <p class="text-yellow-300 text-sm">
                        <i class="fas fa-info-circle mr-2"></i>
                        This is a demo environment. No real payment will be processed.
                    </p>
                </div>
                
                <div class="space-y-3 mb-6 text-left">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Transaction ID:</span>
                        <span class="font-mono text-sm">${e}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Amount:</span>
                        <span class="font-bold">${r} ${a}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Status:</span>
                        <span class="text-yellow-400">Pending</span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <button onclick="simulateSuccess()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 py-3 px-4 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                        <i class="fas fa-check mr-2"></i>Simulate Successful Payment
                    </button>
                    
                    <button onclick="simulateFailure()" class="w-full bg-gradient-to-r from-red-600 to-pink-600 py-3 px-4 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                        <i class="fas fa-times mr-2"></i>Simulate Failed Payment
                    </button>
                    
                    <a href="/checkout" class="block w-full border border-gray-600 py-3 px-4 rounded-lg font-semibold hover:bg-gray-600/20 transition-colors text-center">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Checkout
                    </a>
                </div>
            </div>
        </div>

        <script>
            async function simulateSuccess() {
                try {
                    // Call demo webhook to complete the transaction
                    const response = await fetch('/api/payments/checkout/demo-webhook', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tx_id: '${e}' })
                    });
                    
                    if (response.ok) {
                        // Redirect to success page
                        window.location.href = '/checkout/success?transaction_id=${e}&demo=true';
                    } else {
                        alert('Failed to process demo payment');
                    }
                } catch (error) {
                    console.error('Demo payment error:', error);
                    alert('Demo payment processing failed');
                }
            }
            
            function simulateFailure() {
                // Simulate failed payment - redirect to cancel page  
                window.location.href = '/checkout/cancel?transaction_id=${e}&demo=true&reason=demo_failure';
            }
        <\/script>
    </body>
    </html>
  `)});class hr{static async generateContent(e,r,a){var n,s,o,c;try{const l={contents:[{parts:[{text:e}]}],generationConfig:{temperature:(a==null?void 0:a.temperature)||.8,topK:(a==null?void 0:a.topK)||40,topP:(a==null?void 0:a.topP)||.95,maxOutputTokens:(a==null?void 0:a.maxOutputTokens)||2048,...a}},u=await fetch(`${this.GEMINI_API_BASE}/models/gemini-2.0-flash:generateContent?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){const p=await u.json().catch(()=>({}));throw new Error(`Gemini API Error: ${u.status} - ${((n=p.error)==null?void 0:n.message)||"Generation failed"}`)}const d=await u.json();if(!d.candidates||d.candidates.length===0)throw new Error("No content generated by Gemini");const h=(c=(o=(s=d.candidates[0])==null?void 0:s.content)==null?void 0:o.parts[0])==null?void 0:c.text;if(!h)throw new Error("Empty response from Gemini");return h.trim()}catch(l){throw console.error("Gemini generation error:",l),l}}static async generateHoroscope(e,r){const a=new Date().toLocaleString("en-US",{month:"long",year:"numeric"});let n="";if(e.type==="personalized"&&e.birthDate)n=`Create a detailed personalized monthly horoscope for ${a}.

Birth Information:
- Birth Date: ${e.birthDate}
${e.birthTime?`- Birth Time: ${e.birthTime}`:""}
${e.birthPlace?`- Birth Place: ${e.birthPlace}`:""}
${e.zodiacSign?`- Zodiac Sign: ${e.zodiacSign}`:""}

Please provide insights for the following areas in a warm, encouraging, and mystical tone:

1. LOVE & RELATIONSHIPS: How will romantic energy flow this month? What should they focus on?
2. CAREER & FINANCES: Professional opportunities, financial guidance, and success indicators.
3. HEALTH & ENERGY: Physical wellness, mental health, and energy management advice.
4. PERSONAL GROWTH: Self-development, spiritual insights, and personal transformation.

Also include 3-4 KEY DATES this month that will be particularly significant with brief descriptions.

Format the response as a structured horoscope reading that feels personal and insightful.`;else{const c=e.zodiacSign||"Unknown";n=`Create a monthly horoscope for ${c} for ${a}.

Please provide insights for the following areas in a warm, encouraging, and mystical tone:

1. LOVE & RELATIONSHIPS: Romantic prospects and relationship guidance for ${c}.
2. CAREER & FINANCES: Professional opportunities and financial outlook for ${c}.
3. HEALTH & ENERGY: Wellness advice and energy management for ${c}.
4. PERSONAL GROWTH: Self-development and spiritual guidance for ${c}.

Also include 3-4 KEY DATES this month that will be particularly favorable for ${c}.

Write in an engaging, mystical style that ${c} individuals will connect with.`}n+=`

${{en:"Write the horoscope in English.",es:"Escribe el horóscopo en español.",de:"Schreibe das Horoskop auf Deutsch."}[e.language]}`;const o=await this.generateContent(n,r,{temperature:.8,maxOutputTokens:2048});return this.parseHoroscopeContent(o,e.zodiacSign,a)}static async generateTarotReading(e,r){const a=new Date().toLocaleString("en-US",{month:"long",year:"numeric"}),n=["The Fool","The Magician","The High Priestess","The Empress","The Emperor","The Hierophant","The Lovers","The Chariot","Strength","The Hermit","Wheel of Fortune","Justice","The Hanged Man","Death","Temperance","The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"],s=["Ace of Cups","Two of Cups","Three of Cups","Four of Cups","Five of Cups","Six of Cups","Seven of Cups","Eight of Cups","Nine of Cups","Ten of Cups","Page of Cups","Knight of Cups","Queen of Cups","King of Cups","Ace of Swords","Two of Swords","Three of Swords","Four of Swords","Five of Swords","Six of Swords","Seven of Swords","Eight of Swords","Nine of Swords","Ten of Swords","Page of Swords","Knight of Swords","Queen of Swords","King of Swords","Ace of Wands","Two of Wands","Three of Wands","Four of Wands","Five of Wands","Six of Wands","Seven of Wands","Eight of Wands","Nine of Wands","Ten of Wands","Page of Wands","Knight of Wands","Queen of Wands","King of Wands","Ace of Pentacles","Two of Pentacles","Three of Pentacles","Four of Pentacles","Five of Pentacles","Six of Pentacles","Seven of Pentacles","Eight of Pentacles","Nine of Pentacles","Ten of Pentacles","Page of Pentacles","Knight of Pentacles","Queen of Pentacles","King of Pentacles"],o=[...n,...s],c=e.selected_cards.map((E,v)=>({cardName:o[E%o.length]||`Unknown Card ${E}`,position:v+1})),l={lunar_path:["Past Influences","Present Situation","Hidden Influences","Future Potential","Guidance & Wisdom"],celtic_cross:["Current Situation","Challenge/Cross","Distant Past/Foundation","Recent Past","Possible Future"],three_card:["Past","Present","Future","Advice","Outcome"]},u=l[e.spread_type]||l.lunar_path,d=c.map((E,v)=>`${v+1}. ${u[v]}: ${E.cardName}`).join(`
`),h=`Create a mystical Tarot reading for the question: "${e.question}"

The reading type is: ${e.reading_type}
Spread layout: ${e.spread_type}

Selected cards for this reading:
${d}

For each of the 5 cards, provide:
- Position meaning and relevance to the question
- Detailed interpretation of how this specific card answers their question
- Brief description of the card's imagery and symbolism
- Personal guidance based on this card's message

End with an OVERALL MESSAGE that weaves all the cards together into cohesive wisdom for their question: "${e.question}"

Use mystical, intuitive language that feels personal and insightful. Make the reading feel authentic and meaningful, directly addressing their specific question.

Language: ${e.language==="en"?"English":e.language==="es"?"Spanish":"German"}`,p=await this.generateContent(h,r,{temperature:.9,maxOutputTokens:2048});return this.parseTarotContent(p,e.question,a)}static async generateZodiacInfo(e,r){let a="";e.analysisType==="compatibility"&&e.targetSign?a=`Create a detailed compatibility analysis between ${e.zodiacSign} and ${e.targetSign}.

Analyze the following aspects:
1. ROMANTIC COMPATIBILITY - How these signs connect in love relationships
2. FRIENDSHIP POTENTIAL - Their dynamics as friends and companions  
3. COMMUNICATION STYLE - How they express themselves to each other
4. CHALLENGES & GROWTH - Potential conflicts and how to overcome them
5. STRENGTHS TOGETHER - What makes this pairing powerful
6. ADVICE - Practical tips for building a strong relationship

Provide a compatibility score (1-100) and explain the reasoning.

Use an insightful, balanced tone that acknowledges both strengths and challenges.`:a=`Create comprehensive AI insights for the zodiac sign ${e.zodiacSign}.

Provide detailed analysis for:
1. CAREER & PROFESSIONAL LIFE - Natural talents, ideal careers, workplace behavior
2. LOVE & RELATIONSHIPS - Romantic tendencies, what they seek in partners, relationship patterns
3. HEALTH & WELLNESS - Physical tendencies, stress patterns, wellness advice
4. SPIRITUAL GROWTH - Higher purpose, spiritual lessons, personal development path
5. HIDDEN STRENGTHS - Lesser-known positive traits and untapped potential
6. SHADOW ASPECTS - Areas for growth and self-awareness

Write with depth and nuance, going beyond typical zodiac descriptions to provide truly insightful guidance.`,a+=`

${{en:"Write in English.",es:"Escribe en español.",de:"Schreibe auf Deutsch."}[e.language]}`;const s=await this.generateContent(a,r,{temperature:.7,maxOutputTokens:2048});return this.parseZodiacContent(s,e)}static parseHoroscopeContent(e,r,a){const n=`Monthly Horoscope${r?` for ${r}`:""} - ${a}`;let s="",o="",c="",l="";const u=e.match(/(\d+\.\s*[^:]+:\s*[^1-9]+?)(?=\d+\.|$)/g);if(u&&u.length>=4)s=this.cleanSectionText(u[0]),o=this.cleanSectionText(u[1]),c=this.cleanSectionText(u[2]),l=this.cleanSectionText(u[3]);else{const d=e.match(/(?:LOVE|RELATIONSHIPS?)[\s&:]*([^]*?)(?=(?:CAREER|FINANCE|HEALTH|PERSONAL|$))/i),h=e.match(/(?:CAREER|FINANCE)[\s&:]*([^]*?)(?=(?:HEALTH|PERSONAL|LOVE|$))/i),p=e.match(/(?:HEALTH|ENERGY|WELLNESS)[\s&:]*([^]*?)(?=(?:PERSONAL|CAREER|LOVE|$))/i),E=e.match(/(?:PERSONAL|GROWTH|SPIRITUAL)[\s&:]*([^]*?)(?=(?:KEY DATES?|CAREER|LOVE|HEALTH|$))/i);s=this.cleanSectionText(d==null?void 0:d[1])||"Love energies are flowing positively this month.",o=this.cleanSectionText(h==null?void 0:h[1])||"Professional opportunities await your attention.",c=this.cleanSectionText(p==null?void 0:p[1])||"Focus on maintaining balance in all areas of life.",l=this.cleanSectionText(E==null?void 0:E[1])||"Personal growth opportunities are highlighted."}return!s&&!o&&!c&&!l&&(l=this.cleanSectionText(e)),{title:n,content:{love:s||"Love energies are flowing positively this month.",career:o||"Professional opportunities await your attention.",health:c||"Focus on maintaining balance in all areas of life.",personal:l||"Personal growth opportunities are highlighted.",keyDates:this.extractKeyDates(e)}}}static cleanSectionText(e){return e?e.trim().replace(/^\d+\.\s*[^:]+:\s*/,"").replace(/\*\*/g,"").replace(/^\s*[-*]\s*/gm,"").replace(/\n\s*\n/g,`

`).substring(0,500).trim():""}static parseTarotContent(e,r,a){const n=`Tarot Reading: "${r}" - ${a}`,s=e.split(/\d+\./),o=[],c=["Past Influences","Present Situation","Hidden Influences","Future Potential","Guidance"];for(let u=1;u<Math.min(s.length,6);u++){const d=s[u],h=this.extractCardName(d);o.push({name:h,position:c[u-1]||`Position ${u}`,interpretation:d.trim(),imagery:"A mystically charged card revealing deep insights into your journey."})}const l=this.extractOverallMessage(e);return{title:n,cards:o,overall:l}}static parseZodiacContent(e,r){return r.analysisType==="compatibility"?{compatibility:{score:this.extractCompatibilityScore(e),analysis:e,strengths:[],challenges:[],advice:""}}:{insights:{career:"",love:"",health:"",spiritual:"",strengths:[],growth_areas:[],full_analysis:e}}}static extractKeyDates(e){const r=[],a=[/(\d{1,2}(?:st|nd|rd|th)?)\s*(?:of\s*)?(\w+)/g,/(\d{1,2})(?:[-\/])(\d{1,2})/g,/(\w+)\s*(\d{1,2}(?:st|nd|rd|th)?)/g];for(const n of a){const s=[...e.matchAll(n)];if(s.length>0){for(let o=0;o<Math.min(s.length,4);o++)r.push({date:s[o][0],description:"A day of special significance and opportunity."});break}}if(r.length===0){const n=new Date().getFullYear(),s=new Date().getMonth()+1;r.push({date:`${n}-${String(s).padStart(2,"0")}-05`,description:"A day for new beginnings and fresh energy."},{date:`${n}-${String(s).padStart(2,"0")}-12`,description:"A powerful day for manifestation and goal setting."},{date:`${n}-${String(s).padStart(2,"0")}-18`,description:"Ideal time for important conversations and connections."},{date:`${n}-${String(s).padStart(2,"0")}-25`,description:"A harmonious day for creativity and inspiration."})}return r}static extractCardName(e){const r=["The Fool","The Magician","The High Priestess","The Empress","The Emperor","The Hierophant","The Lovers","The Chariot","Strength","The Hermit","Wheel of Fortune","Justice","The Hanged Man","Death","Temperance","The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"];for(const a of r)if(e.toLowerCase().includes(a.toLowerCase()))return a;return"The Star"}static extractOverallMessage(e){var a;const r=e.match(/(?:OVERALL|SUMMARY|GUIDANCE)[\s:]*(.+?)$/si);return((a=r==null?void 0:r[1])==null?void 0:a.trim())||"Trust in your inner wisdom and embrace the journey ahead."}static extractCompatibilityScore(e){const r=e.match(/(?:score|rating)[\s:]*(\d+)/i);return r?parseInt(r[1]):75}}G(hr,"GEMINI_API_BASE","https://generativelanguage.googleapis.com/v1");var is={};const st=new Dt;async function mr(t){if(typeof(t==null?void 0:t.DB)>"u")return console.log("Using mock database (non-Cloudflare environment)"),await be.initialize(),new be;try{return await t.DB.prepare("SELECT COUNT(*) FROM users LIMIT 1").first(),new Vr(t.DB)}catch(e){return console.log("D1 database not properly configured, using mock database:",e.message),await be.initialize(),new be}}const ju=rt({type:et(["quick","personalized"]),zodiac_sign:se().optional(),birth_date:se().optional(),birth_time:se().optional(),birth_place:se().optional(),language:et(["en","es","de"]).default("en")}),Du=rt({question:se().min(1,"Question is required"),reading_type:se().min(1,"Reading type is required"),spread_type:se().min(1,"Spread type is required"),selected_cards:Au(Sc()).min(5,"Must select 5 cards").max(5,"Must select exactly 5 cards"),language:et(["en","es","de"]).default("en")}),Mu=rt({zodiac_sign:se().min(1,"Zodiac sign is required"),analysis_type:et(["compatibility","insights"]),target_sign:se().optional(),language:et(["en","es","de"]).default("en")});st.post("/astroscope/generate",tt,at("json",ju),async t=>{var e;try{const r=Fe(t),a=t.req.valid("json"),n=await as(t,15);if(!n.hasCredits)return t.json({error:"Insufficient credits",required:15,current:n.currentBalance},402);const s=await mr(t.env);if(a.type==="personalized"&&!a.birth_date)return t.json({error:"Birth date is required for personalized horoscope"},400);if(a.type==="quick"&&!a.zodiac_sign)return t.json({error:"Zodiac sign is required for quick horoscope"},400);const o=await s.createGenerationLog({user_id:r,service_type:"astroscope",params:JSON.stringify(a),base_cost:15,total_cost:15});try{const c=((e=t.env)==null?void 0:e.GEMINI_API_KEY)||is.GEMINI_API_KEY;if(!c)return t.json({success:!0,message:"Horoscope generated (Demo mode - configure GEMINI_API_KEY for real AI content)",horoscope:{title:`${a.zodiac_sign||"Your"} Daily Horoscope - Demo`,content:`This is a demo horoscope for ${a.zodiac_sign||"you"}. The stars align beautifully today, bringing opportunities for growth and positive change. Trust your intuition and embrace new experiences. Configure GEMINI_API_KEY environment variable for personalized AI-powered horoscopes.`,type:a.type,zodiac_sign:a.zodiac_sign,generated_at:new Date().toISOString()},cost:0});const l=await hr.generateHoroscope(a,c),u=await s.saveContent({user_id:r,content_type:"horoscope",title:l.title,content:JSON.stringify(l.content),meta:JSON.stringify({type:a.type,zodiac_sign:a.zodiac_sign,birth_date:a.birth_date,birth_time:a.birth_time,birth_place:a.birth_place,language:a.language,generated_at:new Date().toISOString()})});return await s.deductCredits(r,15),await s.updateGenerationLogStatus(o.id,"completed",u.id.toString()),t.json({success:!0,horoscope:l,content_id:u.id,credits_used:15,remaining_credits:n.currentBalance-15})}catch(c){return await s.updateGenerationLogStatus(o.id,"failed"),console.error("Horoscope generation error:",c),t.json({error:"Failed to generate horoscope",details:c instanceof Error?c.message:"Unknown error"},500)}}catch(r){return console.error("AstroScope error:",r),t.json({error:"Service temporarily unavailable"},500)}});st.post("/tarotpath/generate",tt,at("json",Du),async t=>{var e;try{const r=Fe(t),a=t.req.valid("json"),n=await as(t,20);if(!n.hasCredits)return t.json({error:"Insufficient credits",required:20,current:n.currentBalance},402);const s=await mr(t.env),o=await s.createGenerationLog({user_id:r,service_type:"tarotpath",params:JSON.stringify(a),base_cost:20,total_cost:20});try{const c=((e=t.env)==null?void 0:e.GEMINI_API_KEY)||is.GEMINI_API_KEY;if(!c)return t.json({success:!0,message:"Horoscope generated (Demo mode - configure GEMINI_API_KEY for real AI content)",horoscope:{title:`${a.zodiac_sign||"Your"} Daily Horoscope - Demo`,content:`This is a demo horoscope for ${a.zodiac_sign||"you"}. The stars align beautifully today, bringing opportunities for growth and positive change. Trust your intuition and embrace new experiences. Configure GEMINI_API_KEY environment variable for personalized AI-powered horoscopes.`,type:a.type,zodiac_sign:a.zodiac_sign,generated_at:new Date().toISOString()},cost:0});const l=await hr.generateTarotReading(a,c),u=await s.saveContent({user_id:r,content_type:"tarot_reading",title:l.title,content:JSON.stringify({cards:l.cards,overall:l.overall}),meta:JSON.stringify({question:a.question,reading_type:a.reading_type,spread_type:a.spread_type,selected_cards:a.selected_cards,language:a.language,generated_at:new Date().toISOString()})});return await s.deductCredits(r,20),await s.updateGenerationLogStatus(o.id,"completed",u.id.toString()),t.json({success:!0,tarot_reading:l,content_id:u.id,credits_used:20,remaining_credits:n.currentBalance-20})}catch(c){return await s.updateGenerationLogStatus(o.id,"failed"),console.error("Tarot reading generation error:",c),t.json({error:"Failed to generate tarot reading",details:c instanceof Error?c.message:"Unknown error"},500)}}catch(r){return console.error("TarotPath error:",r),t.json({error:"Service temporarily unavailable"},500)}});st.post("/zodiac-tome/generate",tt,at("json",Mu),async t=>{var e;try{const r=Fe(t),a=t.req.valid("json"),n=await as(t,10);if(!n.hasCredits)return t.json({error:"Insufficient credits",required:10,current:n.currentBalance},402);if(a.analysis_type==="compatibility"&&!a.target_sign)return t.json({error:"Target sign is required for compatibility analysis"},400);const s=await mr(t.env),o=await s.createGenerationLog({user_id:r,service_type:"zodiac_tome",params:JSON.stringify(a),base_cost:10,total_cost:10});try{const c=((e=t.env)==null?void 0:e.GEMINI_API_KEY)||is.GEMINI_API_KEY;if(!c)return t.json({success:!0,message:"Horoscope generated (Demo mode - configure GEMINI_API_KEY for real AI content)",horoscope:{title:`${a.zodiac_sign||"Your"} Daily Horoscope - Demo`,content:`This is a demo horoscope for ${a.zodiac_sign||"you"}. The stars align beautifully today, bringing opportunities for growth and positive change. Trust your intuition and embrace new experiences. Configure GEMINI_API_KEY environment variable for personalized AI-powered horoscopes.`,type:a.type,zodiac_sign:a.zodiac_sign,generated_at:new Date().toISOString()},cost:0});const l=await hr.generateZodiacInfo(a,c),u=a.analysis_type==="compatibility"?`${a.zodiac_sign} & ${a.target_sign} Compatibility Analysis`:`${a.zodiac_sign} Deep Insights & Analysis`,d=await s.saveContent({user_id:r,content_type:"zodiac_info",title:u,content:JSON.stringify(l),meta:JSON.stringify({zodiac_sign:a.zodiac_sign,analysis_type:a.analysis_type,target_sign:a.target_sign,language:a.language,generated_at:new Date().toISOString()})});return await s.deductCredits(r,10),await s.updateGenerationLogStatus(o.id,"completed",d.id.toString()),t.json({success:!0,zodiac_analysis:{title:u,...l},content_id:d.id,credits_used:10,remaining_credits:n.currentBalance-10})}catch(c){return await s.updateGenerationLogStatus(o.id,"failed"),console.error("Zodiac analysis generation error:",c),t.json({error:"Failed to generate zodiac analysis",details:c instanceof Error?c.message:"Unknown error"},500)}}catch(r){return console.error("ZodiacTome error:",r),t.json({error:"Service temporarily unavailable"},500)}});st.get("/content",tt,async t=>{try{const e=Fe(t),r=t.req.query("type"),a=parseInt(t.req.query("limit")||"20"),n=parseInt(t.req.query("offset")||"0"),o=await(await mr(t.env)).getUserContent(e,r),c=o.slice(n,n+a);return t.json({success:!0,content:c,pagination:{limit:a,offset:n,total:o.length}})}catch(e){return console.error("Get content error:",e),t.json({error:"Failed to retrieve content"},500)}});st.get("/content/:id",tt,async t=>{try{const e=Fe(t),r=parseInt(t.req.param("id")),s=(await(await mr(t.env)).getUserContent(e)).find(o=>o.id===r);return s?t.json({success:!0,content:s}):t.json({error:"Content not found"},404)}catch(e){return console.error("Get content by ID error:",e),t.json({error:"Failed to retrieve content"},500)}});st.get("/pricing",async t=>t.json({success:!0,services:{astroscope:{name:"AstroScope",description:"Personalized monthly horoscope",cost:15,features:["Personalized insights","Key dates","Multiple life areas","PDF download"]},tarotpath:{name:"TarotPath",description:"AI-generated Tarot reading",cost:20,features:["5-card spread","Detailed interpretations","Personal guidance","PDF download"]},zodiac_tome:{name:"ZodiacTome",description:"Zodiac compatibility & insights",cost:10,features:["Compatibility analysis","Deep insights","Multiple aspects","Instant results"]}},supported_languages:["en","es","de"]}));st.get("/test-gemini",async t=>{if(t.env.NODE_ENV==="production")return t.json({error:"Test endpoint not available in production"},403);try{const e=t.env.GEMINI_API_KEY;if(!e)return t.json({success:!1,error:"Gemini API key not configured",config:{api_key:"missing"}});const r=await hr.generateContent("Generate a short welcome message for AstroLuna users.",e,{maxOutputTokens:100});return t.json({success:!0,message:"Gemini API connection successful",test_response:r,config:{api_key:"configured"}})}catch(e){return t.json({success:!1,error:e instanceof Error?e.message:"Gemini connection test failed",config:{api_key:t.env.GEMINI_API_KEY?"configured":"missing"}})}});function Bu(){return i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Checkout - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
          }
          .step-active { 
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
          }
          .step-completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
          }
          .step-pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:i("a",{href:"/",children:"AstroLuna"})}),i("div",{className:"flex items-center space-x-4",children:[i("div",{className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"user-credits",children:"0"})," credits"]}),i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})]})]})})}),i("div",{className:"pt-24 pb-12 px-6",children:i("div",{className:"max-w-4xl mx-auto",children:[i("div",{className:"mb-8",children:i("div",{className:"flex items-center justify-center space-x-4",children:[i("div",{className:"flex items-center",children:[i("div",{id:"step-1",className:"step-active w-10 h-10 rounded-full flex items-center justify-center font-semibold",children:"1"}),i("span",{className:"ml-2 text-sm",children:"Package Selection"})]}),i("div",{className:"w-16 h-0.5 bg-gray-600"}),i("div",{className:"flex items-center",children:[i("div",{id:"step-2",className:"step-pending w-10 h-10 rounded-full flex items-center justify-center font-semibold",children:"2"}),i("span",{className:"ml-2 text-sm",children:"Billing Info"})]}),i("div",{className:"w-16 h-0.5 bg-gray-600"}),i("div",{className:"flex items-center",children:[i("div",{id:"step-3",className:"step-pending w-10 h-10 rounded-full flex items-center justify-center font-semibold",children:"3"}),i("span",{className:"ml-2 text-sm",children:"Payment"})]})]})}),i("div",{className:"grid lg:grid-cols-3 gap-8",children:[i("div",{className:"lg:col-span-2",children:[i("div",{id:"step-content-1",className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 mb-6",children:[i("h2",{className:"text-2xl font-bold mb-6",children:"Choose Your Credit Package"}),i("div",{className:"grid md:grid-cols-2 gap-4",id:"credit-packages"}),i("div",{className:"mt-6",children:i("button",{id:"next-to-step-2",className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all disabled:opacity-50",disabled:!0,children:"Continue to Billing Information"})})]}),i("div",{id:"step-content-2",className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 mb-6 hidden",children:[i("h2",{className:"text-2xl font-bold mb-6",children:"Billing Information"}),i("form",{id:"billing-form",className:"space-y-4",children:[i("div",{className:"grid md:grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Full Name *"}),i("input",{type:"text",name:"full_name",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Email *"}),i("input",{type:"email",name:"email",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]})]}),i("div",{className:"grid md:grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Phone *"}),i("input",{type:"tel",name:"phone",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Country *"}),i("input",{type:"text",name:"country",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]})]}),i("div",{className:"grid md:grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"State/Region *"}),i("input",{type:"text",name:"state",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"City *"}),i("input",{type:"text",name:"city",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]})]}),i("div",{className:"grid md:grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Address *"}),i("input",{type:"text",name:"address",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"ZIP Code *"}),i("input",{type:"text",name:"zip_code",required:!0,className:"w-full bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none"})]})]}),i("div",{className:"mt-6",children:i("label",{className:"flex items-center space-x-3",children:[i("input",{type:"checkbox",name:"privacy_accepted",required:!0,className:"w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"}),i("span",{className:"text-sm text-gray-300",children:["I consent to the ",i("a",{href:"/privacy",className:"text-purple-400 hover:text-purple-300 underline",children:"Privacy Policy"})," and",i("a",{href:"/terms",className:"text-purple-400 hover:text-purple-300 underline",children:" User Terms"})]})]})})]}),i("div",{className:"mt-6 flex space-x-4",children:[i("button",{id:"back-to-step-1",className:"flex-1 border border-gray-600 py-3 rounded-lg font-semibold hover:bg-gray-600/20 transition-colors",children:"Back"}),i("button",{id:"next-to-step-3",className:"flex-1 bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all",children:"Continue to Payment"})]})]}),i("div",{id:"step-content-3",className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 mb-6 hidden",children:[i("h2",{className:"text-2xl font-bold mb-6",children:"Complete Payment"}),i("div",{id:"payment-processing",className:"text-center py-8",children:[i("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-400 mb-4"}),i("p",{children:"Redirecting to secure payment..."})]}),i("div",{className:"mt-6",children:i("button",{id:"back-to-step-2",className:"border border-gray-600 py-3 px-6 rounded-lg font-semibold hover:bg-gray-600/20 transition-colors",children:"Back to Billing"})})]})]}),i("div",{className:"lg:col-span-1",children:i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 sticky top-24",children:[i("h3",{className:"text-xl font-bold mb-4",children:"Order Summary"}),i("div",{id:"order-summary",className:"space-y-4",children:i("div",{className:"text-gray-400 text-center py-8",children:"Select a package to see pricing"})}),i("div",{className:"border-t border-gray-600 pt-4 mt-4",children:[i("div",{className:"flex items-center space-x-2 mb-4",children:[i("i",{className:"fas fa-shield-alt text-green-400"}),i("span",{className:"text-sm text-gray-300",children:"Secure Payment"})]}),i("div",{className:"flex items-center space-x-2 mb-4",children:[i("i",{className:"fas fa-credit-card text-blue-400"}),i("span",{className:"text-sm text-gray-300",children:"Visa, MasterCard"})]}),i("div",{className:"flex items-center space-x-2",children:[i("i",{className:"fas fa-lock text-purple-400"}),i("span",{className:"text-sm text-gray-300",children:"SSL Encrypted"})]})]})]})})]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          // Checkout logic will be added here
          let selectedPackage = null;
          let exchangeRates = null;
          let userCurrency = 'EUR';
          
          document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const token = localStorage.getItem('auth_token');
            if (!token) {
              window.location.href = '/login';
              return;
            }
            
            loadUserProfile();
            loadCreditPackages();
            setupEventListeners();
          });
          
          async function loadUserProfile() {
            try {
              const token = localStorage.getItem('auth_token');
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                document.getElementById('user-credits').textContent = response.data.credits;
                userCurrency = response.data.user.currency || 'EUR';
                
                // Pre-fill billing form with user data
                const form = document.getElementById('billing-form');
                form.full_name.value = response.data.user.full_name || '';
                form.email.value = response.data.user.email || '';
                form.phone.value = response.data.user.phone || '';
              }
            } catch (error) {
              console.error('Failed to load profile:', error);
              localStorage.removeItem('auth_token');
              window.location.href = '/login';
            }
          }
          
          async function loadCreditPackages() {
            try {
              const response = await axios.get('/api/currency/pricing');
              if (response.data.success) {
                exchangeRates = response.data.rates;
                renderCreditPackages(response.data.pricing);
              }
            } catch (error) {
              console.error('Failed to load packages:', error);
            }
          }
          
          function renderCreditPackages(packages) {
            const container = document.getElementById('credit-packages');
            container.innerHTML = packages.map(pkg => \`
              <div class="package-option border border-gray-600 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-colors" 
                   data-credits="\${pkg.credits}" 
                   data-bonus="\${pkg.bonus_percent}"
                   data-price-eur="\${pkg.prices.EUR}"
                   data-price-usd="\${pkg.prices.USD}"
                   data-price-gbp="\${pkg.prices.GBP}">
                
                <div class="flex justify-between items-start mb-2">
                  <div>
                    <h4 class="font-bold text-lg">\${pkg.credits} Credits</h4>
                    \${pkg.bonus_percent > 0 ? \`<span class="text-green-400 text-sm">+\${pkg.bonus_percent}% Bonus</span>\` : ''}
                  </div>
                  <div class="text-right">
                    <div class="font-bold text-xl">\${pkg.prices.formatted[userCurrency]}</div>
                    <div class="text-sm text-gray-400">\${pkg.cost_per_credit[userCurrency].toFixed(4)}/credit</div>
                  </div>
                </div>
                
                \${pkg.bonus_percent > 0 ? \`
                  <div class="text-sm text-gray-300">
                    Base: \${pkg.credits} + Bonus: \${Math.floor(pkg.credits * pkg.bonus_percent / 100)} = 
                    <span class="text-green-400 font-semibold">\${pkg.credits + Math.floor(pkg.credits * pkg.bonus_percent / 100)} Total Credits</span>
                  </div>
                \` : ''}
              </div>
            \`).join('');
            
            // Add click handlers
            document.querySelectorAll('.package-option').forEach(option => {
              option.addEventListener('click', () => selectPackage(option));
            });
          }
          
          function selectPackage(option) {
            // Remove previous selection
            document.querySelectorAll('.package-option').forEach(opt => {
              opt.classList.remove('border-purple-500', 'bg-purple-500/10');
            });
            
            // Highlight selected
            option.classList.add('border-purple-500', 'bg-purple-500/10');
            
            selectedPackage = {
              credits: parseInt(option.dataset.credits),
              bonus: parseInt(option.dataset.bonus),
              prices: {
                EUR: parseFloat(option.dataset.priceEur),
                USD: parseFloat(option.dataset.priceUsd),
                GBP: parseFloat(option.dataset.priceGbp)
              }
            };
            
            updateOrderSummary();
            document.getElementById('next-to-step-2').disabled = false;
          }
          
          function updateOrderSummary() {
            if (!selectedPackage) return;
            
            const totalCredits = selectedPackage.credits + Math.floor(selectedPackage.credits * selectedPackage.bonus / 100);
            const price = selectedPackage.prices[userCurrency];
            
            document.getElementById('order-summary').innerHTML = \`
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span>Base Credits</span>
                  <span>\${selectedPackage.credits}</span>
                </div>
                \${selectedPackage.bonus > 0 ? \`
                  <div class="flex justify-between text-green-400">
                    <span>Bonus (\${selectedPackage.bonus}%)</span>
                    <span>+\${Math.floor(selectedPackage.credits * selectedPackage.bonus / 100)}</span>
                  </div>
                \` : ''}
                <div class="border-t border-gray-600 pt-3">
                  <div class="flex justify-between font-bold text-lg">
                    <span>Total Credits</span>
                    <span class="text-purple-400">\${totalCredits}</span>
                  </div>
                  <div class="flex justify-between font-bold text-xl mt-2">
                    <span>Total Price</span>
                    <span class="text-green-400">\${price.toFixed(2)} \${userCurrency}</span>
                  </div>
                </div>
              </div>
            \`;
          }
          
          function setupEventListeners() {
            // Step navigation
            document.getElementById('next-to-step-2').addEventListener('click', () => goToStep(2));
            document.getElementById('back-to-step-1').addEventListener('click', () => goToStep(1));
            document.getElementById('next-to-step-3').addEventListener('click', processPayment);
            document.getElementById('back-to-step-2').addEventListener('click', () => goToStep(2));
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', () => {
              localStorage.removeItem('auth_token');
              window.location.href = '/';
            });
          }
          
          function goToStep(step) {
            // Hide all steps
            for (let i = 1; i <= 3; i++) {
              document.getElementById(\`step-content-\${i}\`).classList.add('hidden');
              document.getElementById(\`step-\${i}\`).className = 'step-pending w-10 h-10 rounded-full flex items-center justify-center font-semibold';
            }
            
            // Show current step
            document.getElementById(\`step-content-\${step}\`).classList.remove('hidden');
            document.getElementById(\`step-\${step}\`).className = 'step-active w-10 h-10 rounded-full flex items-center justify-center font-semibold';
            
            // Mark completed steps
            for (let i = 1; i < step; i++) {
              document.getElementById(\`step-\${i}\`).className = 'step-completed w-10 h-10 rounded-full flex items-center justify-center font-semibold';
            }
          }
          
          async function processPayment() {
            if (!selectedPackage) {
              alert('Please select a credit package');
              return;
            }
            
            const form = document.getElementById('billing-form');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
              form.reportValidity();
              return;
            }
            
            if (!formData.get('privacy_accepted')) {
              alert('Please accept the privacy policy and terms');
              return;
            }
            
            goToStep(3);
            
            try {
              const paymentData = {
                credits_amount: selectedPackage.credits,
                currency: userCurrency,
                email: formData.get('email'),
                full_name: formData.get('full_name'),
                phone: formData.get('phone'),
                country: formData.get('country'),
                state: formData.get('state'),
                city: formData.get('city'),
                address: formData.get('address'),
                zip_code: formData.get('zip_code'),
                privacy_accepted: true
              };
              
              const token = localStorage.getItem('auth_token');
              const response = await axios.post('/api/payments/checkout/init', paymentData, {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success && response.data.payment_url) {
                // Redirect to payment gateway
                window.location.href = response.data.payment_url;
              } else {
                throw new Error(response.data.error || 'Payment initialization failed');
              }
              
            } catch (error) {
              console.error('Payment processing error:', error);
              let message = 'Payment processing failed';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              } else if (error.message) {
                message = error.message;
              }
              alert(\`Payment Error: \${message}\`);
              goToStep(2);
            }
          }
        `}})]})]})}const le=new Dt;le.use("*",Wd);le.use("/api/*",Zd(100,900*1e3));le.use(Jl);le.route("/api/auth",Bt);le.route("/api/currency",qt);le.route("/api/payments",nt);le.route("/api/ai",st);le.get("/api/health",t=>t.json({status:"ok",timestamp:new Date().toISOString(),service:"AstroLuna API"}));le.get("/",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"AstroLuna - AI-Powered Astrology & Tarot Readings"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
          }
          .hero-bg {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="grad"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="2" fill="white" opacity="0.8"><animate attributeName="opacity" values="0.8;0.3;0.8" dur="3s" repeatCount="indefinite"/></circle><circle cx="800" cy="300" r="1" fill="white" opacity="0.6"><animate attributeName="opacity" values="0.6;0.2;0.6" dur="4s" repeatCount="indefinite"/></circle><circle cx="300" cy="700" r="1.5" fill="white" opacity="0.7"><animate attributeName="opacity" values="0.7;0.1;0.7" dur="5s" repeatCount="indefinite"/></circle><circle cx="600" cy="150" r="1" fill="white" opacity="0.5"><animate attributeName="opacity" values="0.5;0.1;0.5" dur="6s" repeatCount="indefinite"/></circle></svg>');
            background-size: cover;
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center space-x-8",children:[i("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:"AstroLuna"}),i("div",{className:"hidden md:flex space-x-6",children:[i("a",{href:"#services",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"Services"}),i("a",{href:"/astroscope",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"AstroScope"}),i("a",{href:"/tarotpath",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"TarotPath"}),i("a",{href:"/zodiac",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"ZodiacTome"}),i("a",{href:"/pricing",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"Pricing"})]})]}),i("div",{className:"flex items-center space-x-4",children:[i("select",{id:"currency-selector",className:"bg-gray-800/50 border border-gray-600 rounded px-2 py-1 text-sm",children:[i("option",{value:"EUR",children:"€ EUR"}),i("option",{value:"USD",children:"$ USD"}),i("option",{value:"GBP",children:"£ GBP"})]}),i("select",{id:"language-selector",className:"bg-gray-800/50 border border-gray-600 rounded px-2 py-1 text-sm",children:[i("option",{value:"en",children:"English"}),i("option",{value:"es",children:"Español"}),i("option",{value:"de",children:"Deutsch"})]}),i("div",{id:"credits-display",className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"credits",children:"0"})," credits"]}),i("div",{id:"auth-buttons",children:[i("a",{href:"/login",className:"bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-2 rounded-lg hover:glow transition-all inline-block",children:"Login"}),i("a",{href:"/signup",className:"border border-purple-500 px-4 py-2 rounded-lg hover:bg-purple-500/20 transition-colors inline-block ml-2",children:"Sign Up"})]}),i("div",{id:"user-menu",className:"hidden",children:[i("button",{id:"checkout-btn",className:"bg-gradient-to-r from-green-600 to-emerald-600 px-4 py-2 rounded-lg hover:glow transition-all mr-2",children:[i("i",{className:"fas fa-plus mr-1"})," Buy Credits"]}),i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})]})]})]})})}),i("section",{className:"hero-section",children:i("div",{className:"hero-content max-w-4xl mx-auto px-6",children:[i("div",{className:"moon-icon mx-auto mb-6"}),i("h1",{className:"text-6xl md:text-7xl font-bold mb-6 cosmic-heading",children:"Discover Your Cosmic Destiny"}),i("p",{className:"text-xl md:text-2xl cosmic-text mb-8 leading-relaxed",children:"AI-powered astrology oracle that combines the wisdom of stars and Tarot cards to reveal your personalized cosmic insights"}),i("div",{className:"flex flex-col md:flex-row gap-4 justify-center",children:[i("a",{href:"/tarotpath",className:"bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-4 rounded-lg text-lg font-semibold hover:glow transition-all inline-block text-center",children:[i("i",{className:"fas fa-cards-blank mr-2"}),"Get Tarot Reading"]}),i("a",{href:"/astroscope",className:"bg-gradient-to-r from-blue-600 to-cyan-600 px-8 py-4 rounded-lg text-lg font-semibold hover:glow transition-all inline-block text-center",children:[i("i",{className:"fas fa-moon mr-2"}),"Generate Horoscope"]})]}),i("a",{href:"/zodiac",className:"inline-block mt-6 text-purple-400 hover:text-purple-300 underline",children:"Learn about zodiac signs"})]})}),i("section",{id:"services",className:"py-20 px-6",children:i("div",{className:"max-w-6xl mx-auto",children:[i("h2",{className:"text-4xl font-bold text-center mb-16 cosmic-heading",children:"What's Inside"}),i("div",{className:"grid md:grid-cols-3 gap-8",children:[i("div",{className:"astroscope-section service-section",children:i("div",{className:"service-content glass-card lunar-glow",children:[i("div",{className:"text-4xl mb-4 text-purple-400",children:i("i",{className:"fas fa-moon"})}),i("h3",{className:"text-2xl font-bold mb-4 cosmic-text",children:"AstroScope"}),i("p",{className:"text-gray-300 mb-6",children:"Personalized monthly horoscopes with key events and favorable dates based on your birth data"}),i("a",{href:"/astroscope",className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all inline-block text-center",children:"Get Started"})]})}),i("div",{className:"tarotpath-section service-section",children:i("div",{className:"service-content glass-card teal-glow",children:[i("div",{className:"text-4xl mb-4 text-pink-400",children:i("i",{className:"fas fa-cards-blank"})}),i("h3",{className:"text-2xl font-bold mb-4 cosmic-text",children:"TarotPath"}),i("p",{className:"text-gray-300 mb-6",children:"AI-generated Tarot card spreads that reveal your lunar path with interactive virtual deck"}),i("a",{href:"/tarotpath",className:"w-full bg-gradient-to-r from-pink-600 to-purple-600 py-3 rounded-lg font-semibold hover:glow transition-all inline-block text-center",children:"Get Started"})]})}),i("div",{className:"zodictome-section service-section",children:i("div",{className:"service-content glass-card lunar-glow",children:[i("div",{className:"text-4xl mb-4 text-cyan-400",children:i("i",{className:"fas fa-star-of-david"})}),i("h3",{className:"text-2xl font-bold mb-4 cosmic-text",children:"ZodiacTome"}),i("p",{className:"text-gray-300 mb-6",children:"Comprehensive zodiac knowledge base with compatibility analysis and AI-powered insights"}),i("a",{href:"/zodiac",className:"w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all inline-block text-center",children:"Get Started"})]})})]})]})}),i("section",{className:"zodiac-bg service-section",children:i("div",{className:"service-content max-w-6xl mx-auto text-center",children:[i("h2",{className:"text-4xl font-bold mb-16 cosmic-heading",children:"Explore All 12 Zodiac Signs"}),i("div",{className:"grid grid-cols-3 md:grid-cols-6 lg:grid-cols-12 gap-4 mb-12",children:[i("div",{className:"cosmic-particle",children:[i("div",{className:"zodiac-sign zodiac-aries mx-auto",title:"Aries"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♈ Aries"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 0.2s;",children:[i("div",{className:"zodiac-sign zodiac-taurus mx-auto",title:"Taurus"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♉ Taurus"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 0.4s;",children:[i("div",{className:"zodiac-sign zodiac-gemini mx-auto",title:"Gemini"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♊ Gemini"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 0.6s;",children:[i("div",{className:"zodiac-sign zodiac-cancer mx-auto",title:"Cancer"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♋ Cancer"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 0.8s;",children:[i("div",{className:"zodiac-sign zodiac-leo mx-auto",title:"Leo"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♌ Leo"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 1.0s;",children:[i("div",{className:"zodiac-sign zodiac-virgo mx-auto",title:"Virgo"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♍ Virgo"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 1.2s;",children:[i("div",{className:"zodiac-sign zodiac-libra mx-auto",title:"Libra"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♎ Libra"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 1.4s;",children:[i("div",{className:"zodiac-sign zodiac-scorpio mx-auto",title:"Scorpio"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♏ Scorpio"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 1.6s;",children:[i("div",{className:"zodiac-sign zodiac-sagittarius mx-auto",title:"Sagittarius"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♐ Sagittarius"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 1.8s;",children:[i("div",{className:"zodiac-sign zodiac-capricorn mx-auto",title:"Capricorn"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♑ Capricorn"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 2.0s;",children:[i("div",{className:"zodiac-sign zodiac-aquarius mx-auto",title:"Aquarius"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♒ Aquarius"})]}),i("div",{className:"cosmic-particle",style:"animation-delay: 2.2s;",children:[i("div",{className:"zodiac-sign zodiac-pisces mx-auto",title:"Pisces"}),i("p",{className:"cosmic-text mt-2 text-xs",children:"♓ Pisces"})]})]}),i("a",{href:"/zodiac",className:"inline-block bg-gradient-to-r from-cyan-600 to-blue-600 px-8 py-4 rounded-lg text-lg font-semibold hover:glow transition-all lunar-glow",children:[i("i",{className:"fas fa-star-of-david mr-2"}),"Explore Detailed Analysis"]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          // Initialize app
          document.addEventListener('DOMContentLoaded', function() {
            console.log('AstroLuna app initialized');
            
            // Check for existing authentication
            const token = localStorage.getItem('auth_token');
            if (token) {
              // Verify token and load user data
              loadUserProfile();
            }
            
            // Load exchange rates
            loadExchangeRates();
          });
          
          async function loadUserProfile() {
            try {
              const token = localStorage.getItem('auth_token');
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                // Update credits display
                document.getElementById('credits').textContent = response.data.credits;
                
                // Update currency selector
                const currencySelector = document.getElementById('currency-selector');
                currencySelector.value = response.data.user.currency || 'EUR';
                
                // Update language selector  
                const languageSelector = document.getElementById('language-selector');
                languageSelector.value = response.data.user.language || 'en';
                
                // Show user menu, hide auth buttons
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                
                // Setup user menu event listeners
                document.getElementById('checkout-btn').addEventListener('click', () => {
                  window.location.href = '/checkout';
                });
                
                document.getElementById('logout-btn').addEventListener('click', () => {
                  localStorage.removeItem('auth_token');
                  window.location.reload();
                });
              }
            } catch (error) {
              console.error('Failed to load profile:', error);
              localStorage.removeItem('auth_token');
              // Keep auth buttons visible for guests
            }
          }
          
          async function loadExchangeRates() {
            try {
              const response = await axios.get('/api/currency/rates');
              if (response.data.success) {
                console.log('Exchange rates loaded:', response.data.rates);
                // Store rates for pricing calculations
                window.exchangeRates = response.data.rates;
              }
            } catch (error) {
              console.error('Failed to load exchange rates:', error);
            }
          }
        `}})]})]})));le.get("/checkout",t=>t.render(i(Bu,{})));le.get("/checkout/success",t=>{const e=t.req.query("transaction_id")||"unknown",r=t.req.query("demo")==="true";return t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Payment Successful - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"})]}),i("body",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex items-center justify-center text-white",children:i("div",{className:"text-center max-w-md mx-auto p-8",children:[i("div",{className:"mb-6",children:[i("div",{className:"w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:i("i",{className:"fas fa-check text-3xl text-white"})}),i("h1",{className:"text-3xl font-bold mb-2",children:r?"Demo Payment Completed!":"Payment Successful!"}),i("p",{className:"text-gray-300",children:r?"Demo credits have been simulated":"Your credits have been added to your account"}),r&&i("div",{className:"bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3 mt-3",children:i("p",{className:"text-yellow-300 text-sm",children:[i("i",{className:"fas fa-info-circle mr-2"}),"This was a demo transaction - no real payment was processed"]})})]}),i("div",{className:"bg-black/20 backdrop-blur-md p-6 rounded-xl border border-green-500/30 mb-6",children:[i("p",{className:"text-sm text-gray-400 mb-2",children:"Transaction ID:"}),i("p",{className:"font-mono text-sm break-all",children:e})]}),i("div",{className:"space-y-3",children:[i("a",{href:"/dashboard",className:"block w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity",children:"Go to Dashboard"}),i("a",{href:"/",className:"block w-full border border-gray-600 py-3 rounded-lg font-semibold hover:bg-gray-600/20 transition-colors",children:"Back to Home"})]})]})})]}))});le.get("/checkout/cancel",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Payment Cancelled - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"})]}),i("body",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex items-center justify-center text-white",children:i("div",{className:"text-center max-w-md mx-auto p-8",children:[i("div",{className:"mb-6",children:[i("div",{className:"w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:i("i",{className:"fas fa-times text-3xl text-white"})}),i("h1",{className:"text-3xl font-bold mb-2",children:"Payment Cancelled"}),i("p",{className:"text-gray-300",children:"Your payment was cancelled. No charges were made."})]}),i("div",{className:"space-y-3",children:[i("a",{href:"/checkout",className:"block w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity",children:"Try Again"}),i("a",{href:"/",className:"block w-full border border-gray-600 py-3 rounded-lg font-semibold hover:bg-gray-600/20 transition-colors",children:"Back to Home"})]})]})})]})));le.get("/astroscope",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"AstroScope - AI Horoscope Generator"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center space-x-8",children:[i("a",{href:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:"AstroLuna"}),i("div",{className:"hidden md:flex space-x-6",children:[i("a",{href:"/astroscope",className:"text-purple-400 font-semibold",children:"AstroScope"}),i("a",{href:"/tarotpath",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"TarotPath"}),i("a",{href:"/zodiac",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"ZodiacTome"}),i("a",{href:"/dashboard",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"Dashboard"})]})]}),i("div",{className:"flex items-center space-x-4",children:[i("div",{id:"credits-display",className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"credits",children:"0"})," credits"]}),i("div",{id:"auth-buttons",children:i("a",{href:"/login",className:"bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-2 rounded-lg hover:glow transition-all inline-block",children:"Login"})}),i("div",{id:"user-menu",className:"hidden",children:i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})})]})]})})}),i("div",{className:"astroscope-bg pt-24 min-h-screen",children:i("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[i("div",{className:"text-center mb-12",children:[i("h1",{className:"text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:[i("i",{className:"fas fa-moon mr-3"}),"AstroScope"]}),i("p",{className:"text-xl text-gray-300",children:"Get personalized AI-generated horoscopes based on your birth data and current celestial positions"})]}),i("div",{className:"grid md:grid-cols-2 gap-8 mb-12",children:[i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-8",children:[i("div",{className:"text-center mb-6",children:[i("div",{className:"text-4xl text-purple-400 mb-4",children:i("i",{className:"fas fa-user-astronaut"})}),i("h3",{className:"text-2xl font-bold mb-2",children:"Personalized Reading"}),i("p",{className:"text-gray-400 mb-4",children:"Complete horoscope with birth chart analysis, favorable dates, and key cosmic events"}),i("div",{className:"text-yellow-400 font-semibold mb-4",children:[i("i",{className:"fas fa-coins mr-2"}),"15 credits"]})]}),i("form",{id:"personalizedForm",className:"space-y-4",children:[i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Birth Date"}),i("input",{type:"date",name:"birth_date",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Birth Time"}),i("input",{type:"time",name:"birth_time",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Birth Location"}),i("input",{type:"text",name:"birth_location",required:!0,placeholder:"City, Country",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Reading Period"}),i("select",{name:"period",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none",children:[i("option",{value:"daily",children:"Daily (Today)"}),i("option",{value:"weekly",children:"Weekly (7 days)"}),i("option",{value:"monthly",selected:!0,children:"Monthly (30 days)"})]})]}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all",children:"Generate Personalized Horoscope"})]})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-blue-500/30 rounded-xl p-8",children:[i("div",{className:"text-center mb-6",children:[i("div",{className:"text-4xl text-blue-400 mb-4",children:i("i",{className:"fas fa-rocket"})}),i("h3",{className:"text-2xl font-bold mb-2",children:"Quick Reading"}),i("p",{className:"text-gray-400 mb-4",children:"Fast horoscope based on your zodiac sign and current planetary positions"}),i("div",{className:"text-yellow-400 font-semibold mb-4",children:[i("i",{className:"fas fa-coins mr-2"}),"15 credits"]})]}),i("form",{id:"quickForm",className:"space-y-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Zodiac Sign"}),i("select",{name:"zodiac_sign",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none",children:[i("option",{value:"",children:"Select your sign"}),i("option",{value:"aries",children:"♈ Aries (Mar 21 - Apr 19)"}),i("option",{value:"taurus",children:"♉ Taurus (Apr 20 - May 20)"}),i("option",{value:"gemini",children:"♊ Gemini (May 21 - Jun 20)"}),i("option",{value:"cancer",children:"♋ Cancer (Jun 21 - Jul 22)"}),i("option",{value:"leo",children:"♌ Leo (Jul 23 - Aug 22)"}),i("option",{value:"virgo",children:"♍ Virgo (Aug 23 - Sep 22)"}),i("option",{value:"libra",children:"♎ Libra (Sep 23 - Oct 22)"}),i("option",{value:"scorpio",children:"♏ Scorpio (Oct 23 - Nov 21)"}),i("option",{value:"sagittarius",children:"♐ Sagittarius (Nov 22 - Dec 21)"}),i("option",{value:"capricorn",children:"♑ Capricorn (Dec 22 - Jan 19)"}),i("option",{value:"aquarius",children:"♒ Aquarius (Jan 20 - Feb 18)"}),i("option",{value:"pisces",children:"♓ Pisces (Feb 19 - Mar 20)"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Reading Period"}),i("select",{name:"period",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-purple-500 focus:outline-none",children:[i("option",{value:"daily",children:"Daily (Today)"}),i("option",{value:"weekly",children:"Weekly (7 days)"}),i("option",{value:"monthly",selected:!0,children:"Monthly (30 days)"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Focus Areas (Optional)"}),i("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[i("label",{className:"flex items-center space-x-2",children:[i("input",{type:"checkbox",name:"focus",value:"love",className:"rounded text-purple-600"}),i("span",{children:"Love & Relationships"})]}),i("label",{className:"flex items-center space-x-2",children:[i("input",{type:"checkbox",name:"focus",value:"career",className:"rounded text-purple-600"}),i("span",{children:"Career & Finance"})]}),i("label",{className:"flex items-center space-x-2",children:[i("input",{type:"checkbox",name:"focus",value:"health",className:"rounded text-purple-600"}),i("span",{children:"Health & Wellness"})]}),i("label",{className:"flex items-center space-x-2",children:[i("input",{type:"checkbox",name:"focus",value:"spiritual",className:"rounded text-purple-600"}),i("span",{children:"Spiritual Growth"})]})]})]}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 py-3 rounded-lg font-semibold hover:glow transition-all",children:"Generate Quick Horoscope"})]})]})]}),i("div",{id:"results",className:"hidden",children:i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-green-500/30 rounded-xl p-8",children:[i("div",{className:"flex items-center justify-between mb-6",children:[i("h3",{className:"text-2xl font-bold text-green-400",children:[i("i",{className:"fas fa-magic mr-2"}),"Your Horoscope"]}),i("button",{id:"saveReading",className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors",children:[i("i",{className:"fas fa-save mr-2"}),"Save to Library"]})]}),i("div",{id:"horoscopeContent",className:"prose prose-invert max-w-none"})]})}),i("div",{id:"loading",className:"hidden text-center py-12",children:[i("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-400 mb-4"}),i("p",{className:"text-gray-300",children:"The stars are aligning your cosmic reading..."})]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            
            // Setup form handlers
            document.getElementById('personalizedForm').addEventListener('submit', handlePersonalizedForm);
            document.getElementById('quickForm').addEventListener('submit', handleQuickForm);
          });
          
          async function loadUserProfile() {
            try {
              const token = localStorage.getItem('auth_token');
              if (!token) {
                document.getElementById('auth-buttons').classList.remove('hidden');
                return;
              }
              
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                document.getElementById('credits').textContent = response.data.credits;
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                
                document.getElementById('logout-btn').addEventListener('click', () => {
                  localStorage.removeItem('auth_token');
                  window.location.href = '/';
                });
              }
            } catch (error) {
              console.error('Failed to load profile:', error);
              document.getElementById('auth-buttons').classList.remove('hidden');
            }
          }
          
          async function handlePersonalizedForm(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
              alert('Please login to generate horoscopes');
              window.location.href = '/login';
              return;
            }
            
            const formData = new FormData(e.target);
            const data = {
              type: 'personalized',
              birth_date: formData.get('birth_date'),
              birth_time: formData.get('birth_time'),
              birth_location: formData.get('birth_location'),
              period: formData.get('period')
            };
            
            await generateHoroscope(data, token);
          }
          
          async function handleQuickForm(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
              alert('Please login to generate horoscopes');
              window.location.href = '/login';
              return;
            }
            
            const formData = new FormData(e.target);
            const focusAreas = Array.from(formData.getAll('focus'));
            
            const data = {
              type: 'quick',
              zodiac_sign: formData.get('zodiac_sign'),
              period: formData.get('period'),
              focus_areas: focusAreas
            };
            
            await generateHoroscope(data, token);
          }
          
          async function generateHoroscope(data, token) {
            try {
              document.getElementById('loading').classList.remove('hidden');
              document.getElementById('results').classList.add('hidden');
              
              const response = await axios.post('/api/ai/astroscope/generate', data, {
                headers: { 
                  Authorization: \`Bearer \${token}\`,
                  'Content-Type': 'application/json'
                }
              });
              
              if (response.data.success) {
                const horoscope = response.data.horoscope;
                
                // Create structured horoscope display
                let horoscopeHTML = '<div class="space-y-6">';
                horoscopeHTML += '<div class="text-center mb-6">';
                horoscopeHTML += '<h2 class="text-2xl font-bold text-purple-400 mb-2">' + horoscope.title + '</h2>';
                horoscopeHTML += '</div>';
                
                // Love & Relationships section
                if (horoscope.content.love) {
                  const loveContent = typeof horoscope.content.love === 'string' ? horoscope.content.love : 'Love energies are flowing positively this month.';
                  horoscopeHTML += '<div class="bg-pink-900/20 border border-pink-500/30 rounded-lg p-4">';
                  horoscopeHTML += '<h3 class="text-xl font-semibold text-pink-400 mb-3">';
                  horoscopeHTML += '<i class="fas fa-heart mr-2"></i>Love & Relationships</h3>';
                  horoscopeHTML += '<p class="text-gray-200 leading-relaxed">' + loveContent + '</p>';
                  horoscopeHTML += '</div>';
                }
                
                // Career & Finance section  
                if (horoscope.content.career) {
                  const careerContent = typeof horoscope.content.career === 'string' ? horoscope.content.career : 'Professional opportunities await your attention.';
                  horoscopeHTML += '<div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">';
                  horoscopeHTML += '<h3 class="text-xl font-semibold text-green-400 mb-3">';
                  horoscopeHTML += '<i class="fas fa-briefcase mr-2"></i>Career & Finance</h3>';
                  horoscopeHTML += '<p class="text-gray-200 leading-relaxed">' + careerContent + '</p>';
                  horoscopeHTML += '</div>';
                }
                
                // Health & Energy section
                if (horoscope.content.health) {
                  const healthContent = typeof horoscope.content.health === 'string' ? horoscope.content.health : 'Focus on maintaining balance in all areas of life.';
                  horoscopeHTML += '<div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">';
                  horoscopeHTML += '<h3 class="text-xl font-semibold text-blue-400 mb-3">';
                  horoscopeHTML += '<i class="fas fa-heart-pulse mr-2"></i>Health & Energy</h3>';
                  horoscopeHTML += '<p class="text-gray-200 leading-relaxed">' + healthContent + '</p>';
                  horoscopeHTML += '</div>';
                }
                
                // Personal Growth section
                if (horoscope.content.personal) {
                  const personalContent = typeof horoscope.content.personal === 'string' ? horoscope.content.personal : 'Personal growth opportunities are highlighted.';
                  horoscopeHTML += '<div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">';
                  horoscopeHTML += '<h3 class="text-xl font-semibold text-purple-400 mb-3">';
                  horoscopeHTML += '<i class="fas fa-star mr-2"></i>Personal Growth</h3>';
                  horoscopeHTML += '<p class="text-gray-200 leading-relaxed">' + personalContent + '</p>';
                  horoscopeHTML += '</div>';
                }
                
                // Key Dates section
                if (horoscope.content.keyDates && Array.isArray(horoscope.content.keyDates) && horoscope.content.keyDates.length > 0) {
                  horoscopeHTML += '<div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">';
                  horoscopeHTML += '<h3 class="text-xl font-semibold text-yellow-400 mb-3">';
                  horoscopeHTML += '<i class="fas fa-calendar-alt mr-2"></i>Key Dates</h3>';
                  horoscopeHTML += '<div class="grid grid-cols-1 md:grid-cols-2 gap-3">';
                  
                  horoscope.content.keyDates.forEach(date => {
                    if (date && typeof date === 'object') {
                      const dateText = typeof date.date === 'string' ? date.date : 'Important Date';
                      const descText = typeof date.description === 'string' ? date.description : 'A day of special significance.';
                      horoscopeHTML += '<div class="bg-gray-800/50 rounded-lg p-3">';
                      horoscopeHTML += '<div class="font-semibold text-yellow-300">' + dateText + '</div>';
                      horoscopeHTML += '<div class="text-sm text-gray-300">' + descText + '</div>';
                      horoscopeHTML += '</div>';
                    }
                  });
                  
                  horoscopeHTML += '</div></div>';
                }
                
                horoscopeHTML += '</div>';
                
                document.getElementById('horoscopeContent').innerHTML = horoscopeHTML;
                document.getElementById('results').classList.remove('hidden');
                
                // Update credits display
                document.getElementById('credits').textContent = response.data.remaining_credits || 0;
                
                // Setup save button
                document.getElementById('saveReading').onclick = () => saveToLibrary(response.data.content_id);
              } else {
                alert(response.data.error || 'Failed to generate horoscope');
              }
            } catch (error) {
              console.error('Generation error:', error);
              let message = 'Failed to generate horoscope';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              }
              alert(message);
            } finally {
              document.getElementById('loading').classList.add('hidden');
            }
          }
          
          async function saveToLibrary(readingId) {
            try {
              const token = localStorage.getItem('auth_token');
              const response = await axios.post('/api/ai/save-reading', 
                { reading_id: readingId },
                { headers: { Authorization: \`Bearer \${token}\` } }
              );
              
              if (response.data.success) {
                alert('Reading saved to your library!');
                document.getElementById('saveReading').innerHTML = 
                  '<i class="fas fa-check mr-2"></i>Saved';
                document.getElementById('saveReading').disabled = true;
              }
            } catch (error) {
              console.error('Save error:', error);
              alert('Failed to save reading');
            }
          }
        `}})]})]})));le.get("/tarotpath",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"TarotPath - AI Tarot Card Readings"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(219, 39, 119, 0.5);
          }
          .tarot-card {
            background: linear-gradient(145deg, #2a2a40, #1a1a30);
            border: 2px solid rgba(219, 39, 119, 0.3);
            transition: all 0.3s ease;
          }
          .tarot-card:hover {
            border-color: rgba(219, 39, 119, 0.6);
            transform: translateY(-5px);
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center space-x-8",children:[i("a",{href:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:"AstroLuna"}),i("div",{className:"hidden md:flex space-x-6",children:[i("a",{href:"/astroscope",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"AstroScope"}),i("a",{href:"/tarotpath",className:"text-pink-400 font-semibold",children:"TarotPath"}),i("a",{href:"/zodiac",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"ZodiacTome"}),i("a",{href:"/dashboard",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"Dashboard"})]})]}),i("div",{className:"flex items-center space-x-4",children:[i("div",{id:"credits-display",className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"credits",children:"0"})," credits"]}),i("div",{id:"auth-buttons",children:i("a",{href:"/login",className:"bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-2 rounded-lg hover:glow transition-all inline-block",children:"Login"})}),i("div",{id:"user-menu",className:"hidden",children:i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})})]})]})})}),i("div",{className:"tarotpath-bg pt-24 min-h-screen",children:i("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[i("div",{className:"text-center mb-12",children:[i("h1",{className:"text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400",children:[i("i",{className:"fas fa-cards-blank mr-3"}),"TarotPath"]}),i("p",{className:"text-xl text-gray-300",children:"Discover your lunar path through AI-generated Tarot card spreads and intuitive guidance"})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-pink-500/30 rounded-xl p-8 mb-8",children:[i("div",{className:"text-center mb-8",children:[i("h3",{className:"text-2xl font-bold mb-2",children:"5-Card Lunar Path Reading"}),i("p",{className:"text-gray-400 mb-4",children:"Explore your past, present, future, and the cosmic forces guiding your journey"}),i("div",{className:"text-yellow-400 font-semibold mb-6",children:[i("i",{className:"fas fa-coins mr-2"}),"20 credits"]})]}),i("form",{id:"tarotForm",className:"max-w-lg mx-auto space-y-6",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Your Question or Focus Area"}),i("textarea",{name:"question",rows:"3",required:!0,placeholder:"What guidance do you seek from the cards?",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-pink-500 focus:outline-none resize-none"})]}),i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Reading Type"}),i("select",{name:"reading_type",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-pink-500 focus:outline-none",children:[i("option",{value:"general",children:"General Guidance"}),i("option",{value:"love",children:"Love & Relationships"}),i("option",{value:"career",children:"Career & Goals"}),i("option",{value:"spiritual",children:"Spiritual Path"}),i("option",{value:"decision",children:"Decision Making"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Spread Layout"}),i("select",{name:"spread_type",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-pink-500 focus:outline-none",children:[i("option",{value:"lunar_path",children:"Lunar Path (5 cards)"}),i("option",{value:"celtic_cross",children:"Celtic Cross (5 cards)"}),i("option",{value:"chakra_flow",children:"Chakra Flow (5 cards)"}),i("option",{value:"elements",children:"Four Elements (5 cards)"})]})]})]}),i("div",{className:"text-center",children:i("button",{type:"submit",className:"bg-gradient-to-r from-pink-600 to-purple-600 px-8 py-4 rounded-lg font-semibold text-lg hover:glow transition-all",children:[i("i",{className:"fas fa-magic mr-2"}),"Draw Your Cards"]})})]})]}),i("div",{id:"cardSelection",className:"hidden mb-8",children:[i("div",{className:"text-center mb-6",children:[i("h3",{className:"text-2xl font-bold text-pink-400 mb-2",children:"Choose Your Cards"}),i("p",{className:"text-gray-400",children:"Focus on your question and select 5 cards from the deck"})]}),i("div",{className:"flex flex-wrap justify-center gap-2 mb-6",id:"cardDeck"}),i("div",{className:"text-center",children:[i("div",{id:"selectedCards",className:"flex justify-center gap-4 mb-4 min-h-[120px]"}),i("button",{id:"revealCards",className:"hidden bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-lg font-semibold hover:glow transition-all",children:[i("i",{className:"fas fa-eye mr-2"}),"Reveal Your Reading"]})]})]}),i("div",{id:"results",className:"hidden",children:i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-green-500/30 rounded-xl p-8",children:[i("div",{className:"flex items-center justify-between mb-6",children:[i("h3",{className:"text-2xl font-bold text-green-400",children:[i("i",{className:"fas fa-magic mr-2"}),"Your Tarot Reading"]}),i("button",{id:"saveReading",className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors",children:[i("i",{className:"fas fa-save mr-2"}),"Save to Library"]})]}),i("div",{id:"readingContent",className:"prose prose-invert max-w-none"})]})}),i("div",{id:"loading",className:"hidden text-center py-12",children:[i("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-pink-400 mb-4"}),i("p",{className:"text-gray-300",children:"The cards are revealing their wisdom..."})]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          let selectedCardIds = [];
          let readingData = {};
          
          document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            document.getElementById('tarotForm').addEventListener('submit', handleTarotForm);
          });
          
          async function loadUserProfile() {
            try {
              const token = localStorage.getItem('auth_token');
              if (!token) {
                document.getElementById('auth-buttons').classList.remove('hidden');
                return;
              }
              
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                document.getElementById('credits').textContent = response.data.credits;
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                
                document.getElementById('logout-btn').addEventListener('click', () => {
                  localStorage.removeItem('auth_token');
                  window.location.href = '/';
                });
              }
            } catch (error) {
              console.error('Failed to load profile:', error);
              document.getElementById('auth-buttons').classList.remove('hidden');
            }
          }
          
          function handleTarotForm(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
              alert('Please login to get tarot readings');
              window.location.href = '/login';
              return;
            }
            
            const formData = new FormData(e.target);
            readingData = {
              question: formData.get('question'),
              reading_type: formData.get('reading_type'),
              spread_type: formData.get('spread_type')
            };
            
            // Hide form and show card selection
            e.target.style.display = 'none';
            document.getElementById('cardSelection').classList.remove('hidden');
            
            generateVirtualDeck();
          }
          
          function generateVirtualDeck() {
            const cardDeck = document.getElementById('cardDeck');
            cardDeck.innerHTML = '';
            
            // Create 78 virtual tarot cards
            for (let i = 1; i <= 78; i++) {
              const card = document.createElement('div');
              card.className = 'tarot-card w-12 h-20 rounded-lg flex items-center justify-center cursor-pointer text-xs font-bold';
              card.textContent = i;
              card.dataset.cardId = i;
              
              card.addEventListener('click', () => selectCard(card, i));
              cardDeck.appendChild(card);
            }
          }
          
          function selectCard(cardElement, cardId) {
            if (selectedCardIds.includes(cardId) || selectedCardIds.length >= 5) return;
            
            selectedCardIds.push(cardId);
            cardElement.style.opacity = '0.3';
            cardElement.style.pointerEvents = 'none';
            
            // Add to selected cards display
            const selectedCards = document.getElementById('selectedCards');
            const selectedCard = document.createElement('div');
            selectedCard.className = 'tarot-card w-16 h-24 rounded-lg flex items-center justify-center font-bold bg-pink-600/20';
            selectedCard.textContent = cardId;
            selectedCards.appendChild(selectedCard);
            
            if (selectedCardIds.length === 5) {
              document.getElementById('revealCards').classList.remove('hidden');
              document.getElementById('revealCards').addEventListener('click', generateReading);
            }
          }
          
          async function generateReading() {
            try {
              const token = localStorage.getItem('auth_token');
              document.getElementById('loading').classList.remove('hidden');
              document.getElementById('cardSelection').style.display = 'none';
              
              const requestData = {
                ...readingData,
                selected_cards: selectedCardIds
              };
              
              const response = await axios.post('/api/ai/tarotpath/generate', requestData, {
                headers: { 
                  Authorization: \`Bearer \${token}\`,
                  'Content-Type': 'application/json'
                }
              });
              
              if (response.data.success) {
                const tarotReading = response.data.tarot_reading;
                
                // Create structured tarot reading display  
                let readingHTML = '<div class="space-y-6">';
                
                // Title section with safe handling
                readingHTML += '<div class="text-center mb-6">';
                const title = (tarotReading && tarotReading.title) ? String(tarotReading.title) : 'Your Tarot Reading';
                readingHTML += '<h2 class="text-2xl font-bold text-pink-400 mb-2">' + title + '</h2>';
                readingHTML += '</div>';
                
                // Cards section with enhanced safety
                if (tarotReading && tarotReading.cards && Array.isArray(tarotReading.cards)) {
                  readingHTML += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">';
                  
                  for (let i = 0; i < tarotReading.cards.length && i < 5; i++) {
                    const card = tarotReading.cards[i];
                    if (!card || typeof card !== 'object') continue;
                    
                    const cardColors = [
                      'border-purple-500/50 bg-purple-900/20',
                      'border-pink-500/50 bg-pink-900/20', 
                      'border-blue-500/50 bg-blue-900/20',
                      'border-green-500/50 bg-green-900/20',
                      'border-yellow-500/50 bg-yellow-900/20'
                    ];
                    
                    const cardColor = cardColors[i % cardColors.length];
                    
                    // Ultra-safe property extraction
                    let cardName = 'Tarot Card';
                    let cardPosition = 'Position ' + (i + 1);
                    let cardInterpretation = 'Card interpretation available.';
                    
                    try {
                      if (card.name) cardName = String(card.name);
                      if (card.position) cardPosition = String(card.position);  
                      if (card.interpretation) cardInterpretation = String(card.interpretation);
                    } catch (e) {
                      // Fallback values already set
                    }
                    
                    readingHTML += '<div class="' + cardColor + ' border rounded-xl p-4">';
                    readingHTML += '<div class="text-center mb-3">';
                    readingHTML += '<div class="text-2xl mb-2">🃏</div>';
                    readingHTML += '<h3 class="text-lg font-bold text-white mb-1">' + cardName + '</h3>';
                    readingHTML += '<div class="text-sm text-gray-300 font-medium">' + cardPosition + '</div>';
                    readingHTML += '</div>';
                    readingHTML += '<div class="text-sm text-gray-200 leading-relaxed">';
                    
                    // Safe interpretation display
                    const shortInterpretation = cardInterpretation.length > 300 ? 
                      cardInterpretation.substring(0, 300) + '...' : cardInterpretation;
                    readingHTML += shortInterpretation;
                    
                    readingHTML += '</div>';
                    readingHTML += '</div>';
                  }
                  
                  readingHTML += '</div>';
                }
                
                // Overall message section with enhanced safety
                if (tarotReading && tarotReading.overall) {
                  let overallMessage = '';
                  try {
                    overallMessage = String(tarotReading.overall);
                  } catch (e) {
                    overallMessage = 'Trust your intuition and embrace the guidance from the cards.';
                  }
                  
                  if (overallMessage.trim()) {
                    readingHTML += '<div class="bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-500/30 rounded-xl p-6">';
                    readingHTML += '<h3 class="text-xl font-semibold text-purple-300 mb-4">';
                    readingHTML += '<i class="fas fa-crystal-ball mr-2"></i>Overall Guidance</h3>';
                    readingHTML += '<div class="text-gray-200 leading-relaxed">';
                    
                    const shortOverall = overallMessage.length > 1000 ? 
                      overallMessage.substring(0, 1000) + '...' : overallMessage;
                    readingHTML += shortOverall;
                    
                    readingHTML += '</div></div>';
                  }
                }
                
                readingHTML += '</div>';
                
                // Safe DOM manipulation
                const contentElement = document.getElementById('readingContent');
                if (contentElement) {
                  contentElement.innerHTML = readingHTML;
                }
                
                const resultsElement = document.getElementById('results');
                if (resultsElement) {
                  resultsElement.classList.remove('hidden');
                }
                
                // Update credits display safely
                const creditsElement = document.getElementById('credits');
                if (creditsElement) {
                  const remainingCredits = response.data.remaining_credits;
                  creditsElement.textContent = (remainingCredits !== undefined) ? String(remainingCredits) : '0';
                }
                
                // Setup save button safely
                const saveButton = document.getElementById('saveReading');
                if (saveButton && response.data.content_id) {
                  saveButton.onclick = () => saveToLibrary(response.data.content_id);
                }
              } else {
                alert(response.data.error || 'Failed to generate tarot reading');
              }
            } catch (error) {
              console.error('Generation error:', error);
              let message = 'Failed to generate tarot reading';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              }
              alert(message);
            } finally {
              document.getElementById('loading').classList.add('hidden');
            }
          }
          
          async function saveToLibrary(readingId) {
            try {
              const token = localStorage.getItem('auth_token');
              const response = await axios.post('/api/ai/save-reading', 
                { reading_id: readingId },
                { headers: { Authorization: \`Bearer \${token}\` } }
              );
              
              if (response.data.success) {
                alert('Reading saved to your library!');
                document.getElementById('saveReading').innerHTML = 
                  '<i class="fas fa-check mr-2"></i>Saved';
                document.getElementById('saveReading').disabled = true;
              }
            } catch (error) {
              console.error('Save error:', error);
              alert('Failed to save reading');
            }
          }
        `}})]})]})));le.get("/zodiac",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"ZodiacTome - Zodiac Compatibility & Insights"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
          }
          .zodiac-sign {
            background: url('/static/images/backgrounds/zodiac-wheel-golden.jpg') center/cover no-repeat;
            border: 2px solid rgba(6, 182, 212, 0.3);
            transition: all 0.3s ease;
            position: relative;
          }
          .zodiac-sign::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(42, 42, 64, 0.4), rgba(26, 26, 48, 0.4));
            border-radius: inherit;
          }
          .zodiac-sign > * {
            position: relative;
            z-index: 1;
          }
          .zodiac-sign:hover {
            border-color: rgba(6, 182, 212, 0.6);
            transform: translateY(-2px);
          }
          .zodiac-sign:hover::before {
            background: linear-gradient(145deg, rgba(42, 42, 64, 0.2), rgba(26, 26, 48, 0.2));
          }
          .zodiac-sign.selected {
            border-color: #06b6d4;
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
          }
          .zodiac-sign.selected::before {
            background: linear-gradient(145deg, rgba(6, 182, 212, 0.2), rgba(6, 182, 212, 0.1));
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center space-x-8",children:[i("a",{href:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:"AstroLuna"}),i("div",{className:"hidden md:flex space-x-6",children:[i("a",{href:"/astroscope",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"AstroScope"}),i("a",{href:"/tarotpath",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"TarotPath"}),i("a",{href:"/zodiac",className:"text-cyan-400 font-semibold",children:"ZodiacTome"}),i("a",{href:"/dashboard",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"Dashboard"})]})]}),i("div",{className:"flex items-center space-x-4",children:[i("div",{id:"credits-display",className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"credits",children:"0"})," credits"]}),i("div",{id:"auth-buttons",children:i("a",{href:"/login",className:"bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-2 rounded-lg hover:glow transition-all inline-block",children:"Login"})}),i("div",{id:"user-menu",className:"hidden",children:i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})})]})]})})}),i("div",{className:"zodiac-tome-bg pt-24 min-h-screen",children:i("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[i("div",{className:"text-center mb-12",children:[i("h1",{className:"text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400",children:[i("i",{className:"fas fa-star-of-david mr-3"}),"ZodiacTome"]}),i("p",{className:"text-xl text-gray-300",children:"Comprehensive zodiac knowledge base with AI-powered compatibility analysis and cosmic insights"})]}),i("div",{className:"grid lg:grid-cols-2 gap-8 mb-12",children:[i("div",{className:"bg-gray-800/20 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-8",children:[i("div",{className:"text-center mb-6",children:[i("div",{className:"text-4xl text-cyan-400 mb-4",children:i("i",{className:"fas fa-heart"})}),i("h3",{className:"text-2xl font-bold mb-2",children:"Compatibility Analysis"}),i("p",{className:"text-gray-400 mb-4",children:"Discover cosmic compatibility between two zodiac signs with detailed insights"}),i("div",{className:"text-yellow-400 font-semibold mb-4",children:[i("i",{className:"fas fa-coins mr-2"}),"10 credits"]})]}),i("form",{id:"compatibilityForm",className:"space-y-6",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-3 text-center",children:"Select First Sign"}),i("div",{className:"grid grid-cols-4 gap-2",id:"firstSignGrid",children:[i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"aries",children:[i("div",{className:"text-2xl mb-1",children:"♈"}),i("div",{className:"text-xs",children:"Aries"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"taurus",children:[i("div",{className:"text-2xl mb-1",children:"♉"}),i("div",{className:"text-xs",children:"Taurus"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"gemini",children:[i("div",{className:"text-2xl mb-1",children:"♊"}),i("div",{className:"text-xs",children:"Gemini"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"cancer",children:[i("div",{className:"text-2xl mb-1",children:"♋"}),i("div",{className:"text-xs",children:"Cancer"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"leo",children:[i("div",{className:"text-2xl mb-1",children:"♌"}),i("div",{className:"text-xs",children:"Leo"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"virgo",children:[i("div",{className:"text-2xl mb-1",children:"♍"}),i("div",{className:"text-xs",children:"Virgo"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"libra",children:[i("div",{className:"text-2xl mb-1",children:"♎"}),i("div",{className:"text-xs",children:"Libra"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"scorpio",children:[i("div",{className:"text-2xl mb-1",children:"♏"}),i("div",{className:"text-xs",children:"Scorpio"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"sagittarius",children:[i("div",{className:"text-2xl mb-1",children:"♐"}),i("div",{className:"text-xs",children:"Sagittarius"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"capricorn",children:[i("div",{className:"text-2xl mb-1",children:"♑"}),i("div",{className:"text-xs",children:"Capricorn"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"aquarius",children:[i("div",{className:"text-2xl mb-1",children:"♒"}),i("div",{className:"text-xs",children:"Aquarius"})]}),i("div",{className:"zodiac-sign p-3 rounded-lg cursor-pointer text-center","data-sign":"pisces",children:[i("div",{className:"text-2xl mb-1",children:"♓"}),i("div",{className:"text-xs",children:"Pisces"})]})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-3 text-center",children:"Select Second Sign"}),i("div",{className:"grid grid-cols-4 gap-2",id:"secondSignGrid"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Analysis Type"}),i("select",{name:"analysis_type",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-cyan-500 focus:outline-none",children:[i("option",{value:"romantic",children:"Romantic Compatibility"}),i("option",{value:"friendship",children:"Friendship Compatibility"}),i("option",{value:"business",children:"Business Partnership"}),i("option",{value:"family",children:"Family Dynamics"}),i("option",{value:"general",children:"General Compatibility"})]})]}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-3 rounded-lg font-semibold hover:glow transition-all",children:[i("i",{className:"fas fa-heart mr-2"}),"Analyze Compatibility"]})]})]}),i("div",{className:"bg-gray-800/20 backdrop-blur-sm border border-blue-500/30 rounded-xl p-8",children:[i("div",{className:"text-center mb-6",children:[i("div",{className:"text-4xl text-blue-400 mb-4",children:i("i",{className:"fas fa-star"})}),i("h3",{className:"text-2xl font-bold mb-2",children:"Deep Zodiac Insights"}),i("p",{className:"text-gray-400 mb-4",children:"Comprehensive analysis of a single zodiac sign with AI-powered cosmic insights"}),i("div",{className:"text-yellow-400 font-semibold mb-4",children:[i("i",{className:"fas fa-coins mr-2"}),"10 credits"]})]}),i("form",{id:"insightsForm",className:"space-y-6",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-3 text-center",children:"Select Zodiac Sign"}),i("div",{className:"grid grid-cols-4 gap-2",id:"insightSignGrid"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Insight Focus"}),i("select",{name:"insight_type",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none",children:[i("option",{value:"personality",children:"Personality Traits"}),i("option",{value:"career",children:"Career & Professional Life"}),i("option",{value:"relationships",children:"Love & Relationships"}),i("option",{value:"health",children:"Health & Wellness"}),i("option",{value:"finances",children:"Money & Finances"}),i("option",{value:"spiritual",children:"Spiritual Growth"}),i("option",{value:"challenges",children:"Life Challenges & Growth"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Time Period"}),i("select",{name:"time_period",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:outline-none",children:[i("option",{value:"current",children:"Current Influences"}),i("option",{value:"monthly",children:"This Month"}),i("option",{value:"yearly",children:"This Year"}),i("option",{value:"general",children:"General Traits"})]})]}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 py-3 rounded-lg font-semibold hover:glow transition-all",children:[i("i",{className:"fas fa-magic mr-2"}),"Generate Insights"]})]})]})]}),i("div",{id:"results",className:"hidden",children:i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-green-500/30 rounded-xl p-8",children:[i("div",{className:"flex items-center justify-between mb-6",children:[i("h3",{className:"text-2xl font-bold text-green-400",children:[i("i",{className:"fas fa-magic mr-2"}),"Your Cosmic Analysis"]}),i("button",{id:"saveReading",className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors",children:[i("i",{className:"fas fa-save mr-2"}),"Save to Library"]})]}),i("div",{id:"analysisContent",className:"prose prose-invert max-w-none"})]})}),i("div",{id:"loading",className:"hidden text-center py-12",children:[i("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mb-4"}),i("p",{className:"text-gray-300",children:"The cosmic library is opening your zodiac insights..."})]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          let selectedFirstSign = null;
          let selectedSecondSign = null;
          let selectedInsightSign = null;
          
          document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            setupZodiacGrids();
            document.getElementById('compatibilityForm').addEventListener('submit', handleCompatibilityForm);
            document.getElementById('insightsForm').addEventListener('submit', handleInsightsForm);
          });
          
          function setupZodiacGrids() {
            // Setup zodiac sign grids
            const signs = [
              {sign: 'aries', symbol: '♈', name: 'Aries'},
              {sign: 'taurus', symbol: '♉', name: 'Taurus'},
              {sign: 'gemini', symbol: '♊', name: 'Gemini'},
              {sign: 'cancer', symbol: '♋', name: 'Cancer'},
              {sign: 'leo', symbol: '♌', name: 'Leo'},
              {sign: 'virgo', symbol: '♍', name: 'Virgo'},
              {sign: 'libra', symbol: '♎', name: 'Libra'},
              {sign: 'scorpio', symbol: '♏', name: 'Scorpio'},
              {sign: 'sagittarius', symbol: '♐', name: 'Sagittarius'},
              {sign: 'capricorn', symbol: '♑', name: 'Capricorn'},
              {sign: 'aquarius', symbol: '♒', name: 'Aquarius'},
              {sign: 'pisces', symbol: '♓', name: 'Pisces'}
            ];
            
            // Create second sign grid
            const secondGrid = document.getElementById('secondSignGrid');
            secondGrid.innerHTML = signs.map(s => \`
              <div class="zodiac-sign p-3 rounded-lg cursor-pointer text-center" data-sign="\${s.sign}">
                <div class="text-2xl mb-1">\${s.symbol}</div>
                <div class="text-xs">\${s.name}</div>
              </div>
            \`).join('');
            
            // Create insight sign grid
            const insightGrid = document.getElementById('insightSignGrid');
            insightGrid.innerHTML = signs.map(s => \`
              <div class="zodiac-sign p-3 rounded-lg cursor-pointer text-center" data-sign="\${s.sign}">
                <div class="text-2xl mb-1">\${s.symbol}</div>
                <div class="text-xs">\${s.name}</div>
              </div>
            \`).join('');
            
            // Setup click handlers
            setupSignSelection('firstSignGrid', (sign) => selectedFirstSign = sign);
            setupSignSelection('secondSignGrid', (sign) => selectedSecondSign = sign);
            setupSignSelection('insightSignGrid', (sign) => selectedInsightSign = sign);
          }
          
          function setupSignSelection(gridId, callback) {
            const grid = document.getElementById(gridId);
            grid.addEventListener('click', (e) => {
              const signElement = e.target.closest('.zodiac-sign');
              if (!signElement) return;
              
              // Clear previous selection in this grid
              grid.querySelectorAll('.zodiac-sign').forEach(el => el.classList.remove('selected'));
              
              // Select new sign
              signElement.classList.add('selected');
              callback(signElement.dataset.sign);
            });
          }
          
          async function loadUserProfile() {
            try {
              const token = localStorage.getItem('auth_token');
              if (!token) {
                document.getElementById('auth-buttons').classList.remove('hidden');
                return;
              }
              
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                document.getElementById('credits').textContent = response.data.credits;
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('user-menu').classList.remove('hidden');
                
                document.getElementById('logout-btn').addEventListener('click', () => {
                  localStorage.removeItem('auth_token');
                  window.location.href = '/';
                });
              }
            } catch (error) {
              console.error('Failed to load profile:', error);
              document.getElementById('auth-buttons').classList.remove('hidden');
            }
          }
          
          async function handleCompatibilityForm(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
              alert('Please login to get zodiac analysis');
              window.location.href = '/login';
              return;
            }
            
            if (!selectedFirstSign || !selectedSecondSign) {
              alert('Please select both zodiac signs');
              return;
            }
            
            const formData = new FormData(e.target);
            const data = {
              zodiac_sign: selectedFirstSign,
              analysis_type: 'compatibility',
              target_sign: selectedSecondSign,
              language: 'en'
            };
            
            await generateZodiacAnalysis(data, token);
          }
          
          async function handleInsightsForm(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
              alert('Please login to get zodiac analysis');
              window.location.href = '/login';
              return;
            }
            
            if (!selectedInsightSign) {
              alert('Please select a zodiac sign');
              return;
            }
            
            const formData = new FormData(e.target);
            const data = {
              zodiac_sign: selectedInsightSign,
              analysis_type: 'insights',
              language: 'en'
            };
            
            await generateZodiacAnalysis(data, token);
          }
          
          async function generateZodiacAnalysis(data, token) {
            try {
              document.getElementById('loading').classList.remove('hidden');
              document.getElementById('results').classList.add('hidden');
              
              const response = await axios.post('/api/ai/zodiac-tome/generate', data, {
                headers: { 
                  Authorization: \`Bearer \${token}\`,
                  'Content-Type': 'application/json'
                }
              });
              
              if (response.data.success) {
                const zodiacAnalysis = response.data.zodiac_analysis;
                
                // Create structured zodiac analysis display
                let analysisHTML = '<div class="space-y-6">';
                analysisHTML += '<div class="text-center mb-6">';
                analysisHTML += '<h2 class="text-2xl font-bold text-cyan-400 mb-2">' + zodiacAnalysis.title + '</h2>';
                analysisHTML += '</div>';
                
                // Analysis content
                if (zodiacAnalysis.insights) {
                  const insights = zodiacAnalysis.insights;
                  
                  // Full analysis section (main content)
                  if (insights.full_analysis) {
                    analysisHTML += '<div class="bg-gradient-to-r from-cyan-900/30 to-blue-900/30 border border-cyan-500/30 rounded-xl p-6 mb-6">';
                    analysisHTML += '<h3 class="text-xl font-semibold text-cyan-300 mb-4">';
                    analysisHTML += '<i class="fas fa-star-of-david mr-2"></i>Cosmic Analysis</h3>';
                    analysisHTML += '<div class="text-gray-200 leading-relaxed prose prose-invert max-w-none">';
                    analysisHTML += insights.full_analysis.substring(0, 1500);
                    if (insights.full_analysis.length > 1500) analysisHTML += '...';
                    analysisHTML += '</div></div>';
                  }
                  
                  // Individual sections if available
                  const sections = [
                    { key: 'love', title: 'Love & Relationships', icon: 'fas fa-heart', color: 'pink' },
                    { key: 'career', title: 'Career & Success', icon: 'fas fa-briefcase', color: 'green' },
                    { key: 'health', title: 'Health & Wellness', icon: 'fas fa-heart-pulse', color: 'blue' },
                    { key: 'spiritual', title: 'Spiritual Growth', icon: 'fas fa-om', color: 'purple' }
                  ];
                  
                  sections.forEach(section => {
                    if (insights[section.key] && insights[section.key].trim()) {
                      analysisHTML += '<div class="bg-' + section.color + '-900/20 border border-' + section.color + '-500/30 rounded-lg p-4">';
                      analysisHTML += '<h3 class="text-lg font-semibold text-' + section.color + '-400 mb-3">';
                      analysisHTML += '<i class="' + section.icon + ' mr-2"></i>' + section.title + '</h3>';
                      analysisHTML += '<p class="text-gray-200 leading-relaxed">' + insights[section.key] + '</p>';
                      analysisHTML += '</div>';
                    }
                  });
                  
                  // Strengths and Growth Areas
                  if (insights.strengths && insights.strengths.length > 0) {
                    analysisHTML += '<div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">';
                    analysisHTML += '<h3 class="text-lg font-semibold text-green-400 mb-3">';
                    analysisHTML += '<i class="fas fa-trophy mr-2"></i>Strengths</h3>';
                    analysisHTML += '<ul class="list-disc list-inside text-gray-200 space-y-1">';
                    insights.strengths.forEach(strength => {
                      analysisHTML += '<li>' + strength + '</li>';
                    });
                    analysisHTML += '</ul></div>';
                  }
                  
                  if (insights.growth_areas && insights.growth_areas.length > 0) {
                    analysisHTML += '<div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4">';
                    analysisHTML += '<h3 class="text-lg font-semibold text-orange-400 mb-3">';
                    analysisHTML += '<i class="fas fa-seedling mr-2"></i>Growth Areas</h3>';
                    analysisHTML += '<ul class="list-disc list-inside text-gray-200 space-y-1">';
                    insights.growth_areas.forEach(area => {
                      analysisHTML += '<li>' + area + '</li>';
                    });
                    analysisHTML += '</ul></div>';
                  }
                }
                
                analysisHTML += '</div>';
                
                document.getElementById('analysisContent').innerHTML = analysisHTML;
                document.getElementById('results').classList.remove('hidden');
                
                // Update credits display  
                document.getElementById('credits').textContent = response.data.remaining_credits || 0;
                
                // Setup save button
                document.getElementById('saveReading').onclick = () => saveToLibrary(response.data.content_id);
              } else {
                alert(response.data.error || 'Failed to generate zodiac analysis');
              }
            } catch (error) {
              console.error('Generation error:', error);
              let message = 'Failed to generate zodiac analysis';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              }
              alert(message);
            } finally {
              document.getElementById('loading').classList.add('hidden');
            }
          }
          
          async function saveToLibrary(readingId) {
            try {
              const token = localStorage.getItem('auth_token');
              const response = await axios.post('/api/ai/save-reading', 
                { reading_id: readingId },
                { headers: { Authorization: \`Bearer \${token}\` } }
              );
              
              if (response.data.success) {
                alert('Analysis saved to your library!');
                document.getElementById('saveReading').innerHTML = 
                  '<i class="fas fa-check mr-2"></i>Saved';
                document.getElementById('saveReading').disabled = true;
              }
            } catch (error) {
              console.error('Save error:', error);
              alert('Failed to save analysis');
            }
          }
        `}})]})]})));le.get("/dashboard",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Dashboard - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),i("style",{children:`
          body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
          }
          .glow { 
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
          }
        `})]}),i("body",{className:"text-white",children:[i("nav",{className:"fixed top-0 w-full z-50 bg-black/20 backdrop-blur-md border-b border-purple-500/20",children:i("div",{className:"max-w-7xl mx-auto px-6 py-4",children:i("div",{className:"flex items-center justify-between",children:[i("div",{className:"flex items-center space-x-8",children:[i("a",{href:"/",className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400",children:"AstroLuna"}),i("div",{className:"hidden md:flex space-x-6",children:[i("a",{href:"/astroscope",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"AstroScope"}),i("a",{href:"/tarotpath",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"TarotPath"}),i("a",{href:"/zodiac",className:"text-gray-300 hover:text-purple-400 transition-colors",children:"ZodiacTome"}),i("a",{href:"/dashboard",className:"text-purple-400 font-semibold",children:"Dashboard"})]})]}),i("div",{className:"flex items-center space-x-4",children:[i("div",{id:"credits-display",className:"bg-gray-800/50 px-3 py-1 rounded text-sm",children:[i("i",{className:"fas fa-coins text-yellow-400 mr-1"}),i("span",{id:"credits",children:"0"})," credits"]}),i("button",{id:"checkout-btn",className:"bg-gradient-to-r from-green-600 to-emerald-600 px-4 py-2 rounded-lg hover:glow transition-all",children:[i("i",{className:"fas fa-plus mr-1"})," Buy Credits"]}),i("button",{id:"logout-btn",className:"text-gray-300 hover:text-white",children:[i("i",{className:"fas fa-sign-out-alt mr-1"})," Logout"]})]})]})})}),i("div",{className:"dashboard-bg pt-24 min-h-screen",children:i("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[i("div",{className:"mb-8",children:[i("h1",{className:"text-4xl font-bold mb-2",children:["Welcome back, ",i("span",{id:"userName",children:"User"}),"!"]}),i("p",{className:"text-gray-400",children:"Manage your cosmic journey and explore your celestial insights"})]}),i("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 text-center",children:[i("div",{className:"text-3xl text-purple-400 mb-2",children:i("i",{className:"fas fa-coins"})}),i("div",{className:"text-2xl font-bold",id:"totalCredits",children:"0"}),i("div",{className:"text-sm text-gray-400",children:"Available Credits"})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-blue-500/30 rounded-xl p-6 text-center",children:[i("div",{className:"text-3xl text-blue-400 mb-2",children:i("i",{className:"fas fa-moon"})}),i("div",{className:"text-2xl font-bold",id:"horoscopeCount",children:"0"}),i("div",{className:"text-sm text-gray-400",children:"Horoscopes"})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-pink-500/30 rounded-xl p-6 text-center",children:[i("div",{className:"text-3xl text-pink-400 mb-2",children:i("i",{className:"fas fa-cards-blank"})}),i("div",{className:"text-2xl font-bold",id:"tarotCount",children:"0"}),i("div",{className:"text-sm text-gray-400",children:"Tarot Readings"})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-6 text-center",children:[i("div",{className:"text-3xl text-cyan-400 mb-2",children:i("i",{className:"fas fa-star"})}),i("div",{className:"text-2xl font-bold",id:"zodiacCount",children:"0"}),i("div",{className:"text-sm text-gray-400",children:"Zodiac Analysis"})]})]}),i("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[i("a",{href:"/astroscope",className:"bg-gray-800/30 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 hover:border-purple-500/60 transition-colors block",children:i("div",{className:"text-center",children:[i("div",{className:"text-4xl text-purple-400 mb-3",children:i("i",{className:"fas fa-moon"})}),i("h3",{className:"text-xl font-bold mb-2",children:"Get Horoscope"}),i("p",{className:"text-gray-400 text-sm",children:"Generate personalized cosmic insights"})]})}),i("a",{href:"/tarotpath",className:"bg-gray-800/30 backdrop-blur-sm border border-pink-500/30 rounded-xl p-6 hover:border-pink-500/60 transition-colors block",children:i("div",{className:"text-center",children:[i("div",{className:"text-4xl text-pink-400 mb-3",children:i("i",{className:"fas fa-cards-blank"})}),i("h3",{className:"text-xl font-bold mb-2",children:"Draw Tarot Cards"}),i("p",{className:"text-gray-400 text-sm",children:"Reveal your lunar path guidance"})]})}),i("a",{href:"/zodiac",className:"bg-gray-800/30 backdrop-blur-sm border border-cyan-500/30 rounded-xl p-6 hover:border-cyan-500/60 transition-colors block",children:i("div",{className:"text-center",children:[i("div",{className:"text-4xl text-cyan-400 mb-3",children:i("i",{className:"fas fa-star-of-david"})}),i("h3",{className:"text-xl font-bold mb-2",children:"Zodiac Analysis"}),i("p",{className:"text-gray-400 text-sm",children:"Explore compatibility & insights"})]})})]}),i("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-500/30 rounded-xl p-8",children:[i("div",{className:"flex items-center justify-between mb-6",children:[i("h3",{className:"text-2xl font-bold",children:"Recent Readings"}),i("button",{id:"loadMoreReadings",className:"text-purple-400 hover:text-purple-300",children:[i("i",{className:"fas fa-refresh mr-1"})," Refresh"]})]}),i("div",{id:"recentReadings",className:"space-y-4",children:i("div",{className:"text-center py-8 text-gray-400",children:[i("i",{className:"fas fa-magic text-3xl mb-4"}),i("p",{children:"Your cosmic readings will appear here"}),i("p",{className:"text-sm",children:"Start your journey by getting your first reading!"})]})})]})]})}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Setup event listeners
            document.getElementById('checkout-btn').addEventListener('click', () => {
              window.location.href = '/checkout';
            });
            
            document.getElementById('logout-btn').addEventListener('click', () => {
              localStorage.removeItem('auth_token');
              window.location.href = '/';
            });
            
            document.getElementById('loadMoreReadings').addEventListener('click', loadRecentReadings);
          });
          
          async function loadDashboard() {
            try {
              const token = localStorage.getItem('auth_token');
              if (!token) {
                window.location.href = '/login';
                return;
              }
              
              const response = await axios.get('/api/auth/profile', {
                headers: { Authorization: \`Bearer \${token}\` }
              });
              
              if (response.data.success) {
                const user = response.data.user;
                
                // Update user info
                document.getElementById('userName').textContent = user.full_name || 'User';
                document.getElementById('credits').textContent = response.data.credits;
                document.getElementById('totalCredits').textContent = response.data.credits;
                
                // Load reading statistics (mock for now)
                document.getElementById('horoscopeCount').textContent = '0';
                document.getElementById('tarotCount').textContent = '0';
                document.getElementById('zodiacCount').textContent = '0';
                
                // Load recent readings
                await loadRecentReadings();
              } else {
                window.location.href = '/login';
              }
            } catch (error) {
              console.error('Failed to load dashboard:', error);
              window.location.href = '/login';
            }
          }
          
          async function loadRecentReadings() {
            try {
              const token = localStorage.getItem('auth_token');
              
              // For now, show placeholder content
              // In a real implementation, this would fetch from API
              const recentReadings = document.getElementById('recentReadings');
              recentReadings.innerHTML = \`
                <div class="text-center py-8 text-gray-400">
                  <i class="fas fa-magic text-3xl mb-4"></i>
                  <p>Your cosmic readings will appear here</p>
                  <p class="text-sm">Start your journey by getting your first reading!</p>
                </div>
              \`;
              
            } catch (error) {
              console.error('Failed to load recent readings:', error);
            }
          }
        `}})]})]})));le.get("/login",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Login - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"})]}),i("body",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex items-center justify-center",children:[i("div",{className:"bg-black/20 backdrop-blur-md p-8 rounded-xl border border-purple-500/30 w-full max-w-md",children:[i("h1",{className:"text-3xl font-bold text-center text-white mb-8",children:"Welcome Back"}),i("form",{id:"loginForm",className:"space-y-6",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Email"}),i("input",{type:"email",name:"email",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"your@email.com"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Password"}),i("input",{type:"password",name:"password",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"••••••••"})]}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-opacity",children:"Sign In"})]}),i("div",{className:"mt-6 p-4 bg-green-900/20 border border-green-500/30 rounded-lg",children:[i("h3",{className:"text-green-400 font-semibold mb-2 text-sm",children:"🌙 Test Accounts Available:"}),i("div",{className:"text-xs text-gray-300 space-y-1",children:[i("div",{children:[i("strong",{children:"demo@astroluna.com"})," / demo123 (150 credits)"]}),i("div",{children:[i("strong",{children:"test@astroluna.com"})," / password (100 credits)"]}),i("div",{children:[i("strong",{children:"admin@astroluna.com"})," / admin123 (500 credits)"]})]})]}),i("div",{className:"mt-4 text-center",children:i("a",{href:"/forgot-password",className:"text-purple-400 hover:text-purple-300 text-sm",children:"Forgot Password?"})}),i("div",{className:"mt-2 text-center",children:[i("span",{className:"text-gray-400 text-sm",children:"Don't have an account? "}),i("a",{href:"/signup",className:"text-purple-400 hover:text-purple-300 text-sm",children:"Sign up"})]})]}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
              email: formData.get('email'),
              password: formData.get('password')
            };
            
            try {
              const response = await axios.post('/api/auth/login', data);
              
              if (response.data.success) {
                localStorage.setItem('auth_token', response.data.token);
                window.location.href = '/dashboard';
              }
            } catch (error) {
              let message = 'Login failed';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              }
              alert(message);
            }
          });
        `}})]})]})));le.get("/signup",t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"Sign Up - AstroLuna"}),i("script",{src:"https://cdn.tailwindcss.com"}),i("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"})]}),i("body",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex items-center justify-center",children:[i("div",{className:"bg-black/20 backdrop-blur-md p-8 rounded-xl border border-purple-500/30 w-full max-w-lg",children:[i("h1",{className:"text-3xl font-bold text-center text-white mb-8",children:"Join AstroLuna"}),i("form",{id:"signupForm",className:"space-y-4",children:[i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Full Name"}),i("input",{type:"text",name:"full_name",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"John Doe"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Phone"}),i("input",{type:"tel",name:"phone",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"+1234567890"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Email"}),i("input",{type:"email",name:"email",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"your@email.com"})]}),i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Password"}),i("input",{type:"password",name:"password",required:!0,minLength:"6",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"••••••••"})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Confirm Password"}),i("input",{type:"password",name:"confirm_password",required:!0,minLength:"6",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",placeholder:"••••••••"})]})]}),i("div",{className:"grid grid-cols-2 gap-4",children:[i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Language"}),i("select",{name:"language",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",children:[i("option",{value:"en",children:"English"}),i("option",{value:"es",children:"Español"}),i("option",{value:"de",children:"Deutsch"})]})]}),i("div",{children:[i("label",{className:"block text-gray-300 mb-2",children:"Currency"}),i("select",{name:"currency",className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:outline-none",children:[i("option",{value:"EUR",children:"€ EUR"}),i("option",{value:"USD",children:"$ USD"}),i("option",{value:"GBP",children:"£ GBP"})]})]})]}),i("div",{className:"mt-6",children:i("label",{className:"flex items-center space-x-3",children:[i("input",{type:"checkbox",name:"privacy_accepted",required:!0,className:"w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"}),i("span",{className:"text-sm text-gray-300",children:["I consent to the ",i("a",{href:"/privacy",className:"text-purple-400 hover:text-purple-300 underline",children:"Privacy Policy"})," and",i("a",{href:"/terms",className:"text-purple-400 hover:text-purple-300 underline",children:" User Terms"})]})]})}),i("button",{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 py-3 rounded-lg font-semibold text-white hover:opacity-90 transition-opacity",children:"Create Account"})]}),i("div",{className:"mt-6 text-center",children:[i("span",{className:"text-gray-400",children:"Already have an account? "}),i("a",{href:"/login",className:"text-purple-400 hover:text-purple-300",children:"Sign in"})]})]}),i("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),i("script",{dangerouslySetInnerHTML:{__html:`
          document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
              full_name: formData.get('full_name'),
              email: formData.get('email'),
              phone: formData.get('phone'),
              password: formData.get('password'),
              confirm_password: formData.get('confirm_password'),
              language: formData.get('language'),
              currency: formData.get('currency'),
              privacy_accepted: formData.get('privacy_accepted') === 'on'
            };
            
            // Validate password match
            if (data.password !== data.confirm_password) {
              alert('Passwords do not match');
              return;
            }
            
            try {
              const response = await axios.post('/api/auth/signup', data);
              
              if (response.data.success) {
                localStorage.setItem('auth_token', response.data.token);
                alert('Account created successfully! Welcome to AstroLuna!');
                window.location.href = '/';
              }
            } catch (error) {
              let message = 'Registration failed';
              if (error.response && error.response.data && error.response.data.error) {
                message = error.response.data.error;
              }
              alert(message);
            }
          });
        `}})]})]})));le.get("/test-checkout",t=>t.html(`
    <!DOCTYPE html>
    <html>
    <head>
        <title>Test Checkout</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
    </head>
    <body class="p-8 bg-gray-900 text-white">
        <h1 class="text-2xl mb-4">Test Checkout Process</h1>
        <div class="space-x-4 mb-4">
            <button onclick="testLogin()" class="bg-blue-600 px-4 py-2 rounded">1. Login</button>
            <button onclick="testCheckout()" class="bg-green-600 px-4 py-2 rounded">2. Open Checkout</button>
        </div>
        <div id="result" class="bg-gray-800 p-4 rounded"></div>

        <script>
            let authToken = null;
            
            async function testLogin() {
                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: 'test@example.com',
                            password: 'testpass'
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        authToken = data.token;
                        localStorage.setItem('auth_token', authToken);
                        document.getElementById('result').innerHTML = '<p class="text-green-400">✅ Login successful! Token saved. Credits: ' + data.credits + '</p>';
                    } else {
                        document.getElementById('result').innerHTML = '<p class="text-red-400">❌ Login failed: ' + data.error + '</p>';
                    }
                } catch (error) {
                    document.getElementById('result').innerHTML = '<p class="text-red-400">❌ Login error: ' + error.message + '</p>';
                }
            }
            
            async function testCheckout() {
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    document.getElementById('result').innerHTML = '<p class="text-yellow-400">❌ Please login first</p>';
                    return;
                }
                
                // Open checkout page
                window.location.href = '/checkout';
            }
        <\/script>
    </body>
    </html>
  `));le.notFound(t=>t.render(i("html",{lang:"en",children:[i("head",{children:[i("meta",{charset:"UTF-8"}),i("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),i("title",{children:"404 - Page Not Found"}),i("script",{src:"https://cdn.tailwindcss.com"})]}),i("body",{className:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex items-center justify-center text-white",children:i("div",{className:"text-center",children:[i("h1",{className:"text-6xl font-bold mb-4",children:"404"}),i("p",{className:"text-xl mb-8",children:"The stars couldn't locate this page"}),i("a",{href:"/",className:"bg-gradient-to-r from-purple-600 to-blue-600 px-6 py-3 rounded-lg hover:opacity-90 transition-opacity",children:"Return to Home"})]})})]})));const uo=new Dt,qu=Object.assign({"/src/index.tsx":le});let Tc=!1;for(const[,t]of Object.entries(qu))t&&(uo.all("*",e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),uo.notFound(e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),Tc=!0);if(!Tc)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{uo as default};
